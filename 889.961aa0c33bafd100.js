"use strict";(self.webpackChunkvna_employee_tools=self.webpackChunkvna_employee_tools||[]).push([[889],{4889:(J,F,g)=>{g.r(F),g.d(F,{MSALGuardConfigFactory:()=>l,MSALInstanceFactory:()=>t,MSALInterceptorConfigFactory:()=>a,MailModule:()=>e});var c=g(4438),s=g(177),C=g(604),v=g(9192),y=g(7554),E=g(3212);class R{static getInteractionStatusFromEvent(r,o){switch(r.eventType){case E.B.LOGIN_START:return y.T$.Login;case E.B.SSO_SILENT_START:return y.T$.SsoSilent;case E.B.ACQUIRE_TOKEN_START:if(r.interactionType===y.X8.Redirect||r.interactionType===y.X8.Popup)return y.T$.AcquireToken;break;case E.B.HANDLE_REDIRECT_START:return y.T$.HandleRedirect;case E.B.LOGOUT_START:return y.T$.Logout;case E.B.SSO_SILENT_SUCCESS:case E.B.SSO_SILENT_FAILURE:if(o&&o!==y.T$.SsoSilent)break;return y.T$.None;case E.B.LOGOUT_END:if(o&&o!==y.T$.Logout)break;return y.T$.None;case E.B.HANDLE_REDIRECT_END:if(o&&o!==y.T$.HandleRedirect)break;return y.T$.None;case E.B.LOGIN_SUCCESS:case E.B.LOGIN_FAILURE:case E.B.ACQUIRE_TOKEN_SUCCESS:case E.B.ACQUIRE_TOKEN_FAILURE:case E.B.RESTORE_FROM_BFCACHE:if(r.interactionType===y.X8.Redirect||r.interactionType===y.X8.Popup){if(o&&o!==y.T$.Login&&o!==y.T$.AcquireToken)break;return y.T$.None}}return null}}var h=g(4064),f=g(1564),D=g(1474),S=g(2030),U=g(6648),Y=g(2771),G=g(1413),T=g(4412),X=g(7673),p=g(983),A=g(6354),N=g(274),b=g(9437),O=g(5558),L=g(6697),w=g(5964);const P="@azure/msal-angular",B="3.0.17",j=new c.nKC("MSAL_INSTANCE"),$=new c.nKC("MSAL_GUARD_CONFIG"),k=new c.nKC("MSAL_INTERCEPTOR_CONFIG"),H=new c.nKC("MSAL_BROADCAST_CONFIG");let x=(()=>{class i{constructor(o,d){this.instance=o,this.location=d;const u=this.location.path(!0).split("#").pop();u&&(this.redirectHash=`#${u}`),this.instance.initializeWrapperLibrary(y.f7.Angular,B)}initialize(){return(0,U.H)(this.instance.initialize())}acquireTokenPopup(o){return(0,U.H)(this.instance.acquireTokenPopup(o))}acquireTokenRedirect(o){return(0,U.H)(this.instance.acquireTokenRedirect(o))}acquireTokenSilent(o){return(0,U.H)(this.instance.acquireTokenSilent(o))}handleRedirectObservable(o){return(0,U.H)(this.instance.initialize().then(()=>this.instance.handleRedirectPromise(o||this.redirectHash)))}loginPopup(o){return(0,U.H)(this.instance.loginPopup(o))}loginRedirect(o){return(0,U.H)(this.instance.loginRedirect(o))}logout(o){return(0,U.H)(this.instance.logout(o))}logoutRedirect(o){return(0,U.H)(this.instance.logoutRedirect(o))}logoutPopup(o){return(0,U.H)(this.instance.logoutPopup(o))}ssoSilent(o){return(0,U.H)(this.instance.ssoSilent(o))}getLogger(){return this.logger||(this.logger=this.instance.getLogger().clone(P,B)),this.logger}setLogger(o){this.logger=o.clone(P,B),this.instance.setLogger(o)}}return i.\u0275fac=function(o){return new(o||i)(c.KVO(j),c.KVO(s.aZ))},i.\u0275prov=c.jDH({token:i,factory:i.\u0275fac}),i})(),z=(()=>{class i{constructor(o,d,u){this.msalInstance=o,this.authService=d,this.msalBroadcastConfig=u,this.msalBroadcastConfig&&this.msalBroadcastConfig.eventsToReplay>0?(this.authService.getLogger().verbose(`BroadcastService - eventsToReplay set on BroadcastConfig, replaying the last ${this.msalBroadcastConfig.eventsToReplay} events`),this._msalSubject=new Y.m(this.msalBroadcastConfig.eventsToReplay)):this._msalSubject=new G.B,this.msalSubject$=this._msalSubject.asObservable(),this._inProgress=new T.t(y.T$.Startup),this.inProgress$=this._inProgress.asObservable(),this.msalInstance.addEventCallback(m=>{this._msalSubject.next(m);const I=R.getInteractionStatusFromEvent(m,this._inProgress.value);null!==I&&(this.authService.getLogger().verbose(`BroadcastService - ${m.eventType} results in setting inProgress from ${this._inProgress.value} to ${I}`),this._inProgress.next(I))})}}return i.\u0275fac=function(o){return new(o||i)(c.KVO(j),c.KVO(x),c.KVO(H,8))},i.\u0275prov=c.jDH({token:i,factory:i.\u0275fac}),i})(),W=(()=>{class i{constructor(o,d,u,m,I){this.msalGuardConfig=o,this.msalBroadcastService=d,this.authService=u,this.location=m,this.router=I,this.msalBroadcastService.inProgress$.subscribe()}parseUrl(o){return this.router.parseUrl(o)}getDestinationUrl(o){this.authService.getLogger().verbose("Guard - getting destination url");const d=document.getElementsByTagName("base"),u=this.location.normalize(d.length?d[0].href:window.location.origin),m=this.location.prepareExternalUrl(o);return m.startsWith("#")?(this.authService.getLogger().verbose("Guard - destination by hash routing"),`${u}/${m}`):`${u}${o}`}loginInteractively(o){const d="function"==typeof this.msalGuardConfig.authRequest?this.msalGuardConfig.authRequest(this.authService,o):{...this.msalGuardConfig.authRequest};if(this.msalGuardConfig.interactionType===y.X8.Popup)return this.authService.getLogger().verbose("Guard - logging in by popup"),this.authService.loginPopup(d).pipe((0,A.T)(m=>(this.authService.getLogger().verbose("Guard - login by popup successful, can activate, setting active account"),this.authService.instance.setActiveAccount(m.account),!0)));this.authService.getLogger().verbose("Guard - logging in by redirect");const u=this.getDestinationUrl(o.url);return this.authService.loginRedirect({redirectStartPage:u,...d}).pipe((0,A.T)(()=>!1))}activateHelper(o){if(this.msalGuardConfig.interactionType!==y.X8.Popup&&this.msalGuardConfig.interactionType!==y.X8.Redirect)throw new h.XX("invalid_interaction_type","Invalid interaction type provided to MSAL Guard. InteractionType.Popup or InteractionType.Redirect must be provided in the MsalGuardConfiguration");if(this.authService.getLogger().verbose("MSAL Guard activated"),!(typeof window<"u"))return this.authService.getLogger().info("Guard - window is undefined, MSAL does not support server-side token acquisition"),(0,X.of)(!0);if(f.H.hashContainsKnownProperties(window.location.hash)&&D.GZ()&&!this.authService.instance.getConfiguration().system.allowRedirectInIframe)return this.authService.getLogger().warning("Guard - redirectUri set to page with MSAL Guard. It is recommended to not set redirectUri to a page that requires authentication."),(0,X.of)(!1);this.msalGuardConfig.loginFailedRoute&&(this.loginFailedRoute=this.parseUrl(this.msalGuardConfig.loginFailedRoute));const d=this.location.path(!0);return this.authService.initialize().pipe((0,N.H)(()=>this.authService.handleRedirectObservable()),(0,N.H)(()=>{if(!this.authService.instance.getAllAccounts().length)return o?(this.authService.getLogger().verbose("Guard - no accounts retrieved, log in required to activate"),this.loginInteractively(o)):(this.authService.getLogger().verbose("Guard - no accounts retrieved, no state, cannot load"),(0,X.of)(!1));if(this.authService.getLogger().verbose("Guard - at least 1 account exists, can activate or load"),o){const u=this.includesCode(o.url),m=!!o.root&&!!o.root.fragment&&this.includesCode(`#${o.root.fragment}`),I=0===this.location.prepareExternalUrl(o.url).indexOf("#");if(u&&(m||I))return this.authService.getLogger().info("Guard - Hash contains known code response, stopping navigation."),d.indexOf("#")>-1?(0,X.of)(this.parseUrl(this.location.path())):(0,X.of)(this.parseUrl(""))}return(0,X.of)(!0)}),(0,b.W)(u=>(this.authService.getLogger().error("Guard - error while logging in, unable to activate"),this.authService.getLogger().errorPii(`Guard - error: ${u.message}`),this.loginFailedRoute&&o?(this.authService.getLogger().verbose("Guard - loginFailedRoute set, redirecting"),(0,X.of)(this.loginFailedRoute)):(0,X.of)(!1))))}includesCode(o){return o.lastIndexOf("/code")>-1&&o.lastIndexOf("/code")===o.length-5||o.indexOf("#code=")>-1||o.indexOf("&code=")>-1}canActivate(o,d){return this.authService.getLogger().verbose("Guard - canActivate"),this.activateHelper(d)}canActivateChild(o,d){return this.authService.getLogger().verbose("Guard - canActivateChild"),this.activateHelper(d)}canMatch(){return this.authService.getLogger().verbose("Guard - canLoad"),this.activateHelper()}}return i.\u0275fac=function(o){return new(o||i)(c.KVO($),c.KVO(z),c.KVO(x),c.KVO(s.aZ),c.KVO(v.Ix))},i.\u0275prov=c.jDH({token:i,factory:i.\u0275fac}),i})(),te=(()=>{class i{constructor(o,d,u,m,I){this.msalInterceptorConfig=o,this.authService=d,this.location=u,this.msalBroadcastService=m,this._document=I}intercept(o,d){if(this.msalInterceptorConfig.interactionType!==y.X8.Popup&&this.msalInterceptorConfig.interactionType!==y.X8.Redirect)throw new h.XX("invalid_interaction_type","Invalid interaction type provided to MSAL Interceptor. InteractionType.Popup, InteractionType.Redirect must be provided in the msalInterceptorConfiguration");this.authService.getLogger().verbose("MSAL Interceptor activated");const u=this.getScopesForEndpoint(o.url,o.method);if(!u||0===u.length)return this.authService.getLogger().verbose("Interceptor - no scopes for endpoint"),d.handle(o);let m;this.authService.instance.getActiveAccount()?(this.authService.getLogger().verbose("Interceptor - active account selected"),m=this.authService.instance.getActiveAccount()):(this.authService.getLogger().verbose("Interceptor - no active account, fallback to first account"),m=this.authService.instance.getAllAccounts()[0]);const I="function"==typeof this.msalInterceptorConfig.authRequest?this.msalInterceptorConfig.authRequest(this.authService,o,{account:m}):{...this.msalInterceptorConfig.authRequest,account:m};return this.authService.getLogger().info(`Interceptor - ${u.length} scopes found for endpoint`),this.authService.getLogger().infoPii(`Interceptor - [${u}] scopes found for ${o.url}`),this.acquireToken(I,u,m).pipe((0,O.n)(K=>{this.authService.getLogger().verbose("Interceptor - setting authorization headers");const Q=o.headers.set("Authorization",`Bearer ${K.accessToken}`),ee=o.clone({headers:Q});return d.handle(ee)}))}acquireToken(o,d,u){return this.authService.acquireTokenSilent({...o,scopes:d,account:u}).pipe((0,b.W)(()=>(this.authService.getLogger().error("Interceptor - acquireTokenSilent rejected with error. Invoking interaction to resolve."),this.msalBroadcastService.inProgress$.pipe((0,L.s)(1),(0,O.n)(m=>m===y.T$.None?this.acquireTokenInteractively(o,d):this.msalBroadcastService.inProgress$.pipe((0,w.p)(I=>I===y.T$.None),(0,L.s)(1),(0,O.n)(()=>this.acquireToken(o,d,u))))))),(0,O.n)(m=>m.accessToken?(0,X.of)(m):(this.authService.getLogger().error("Interceptor - acquireTokenSilent resolved with null access token. Known issue with B2C tenants, invoking interaction to resolve."),this.msalBroadcastService.inProgress$.pipe((0,w.p)(I=>I===y.T$.None),(0,L.s)(1),(0,O.n)(()=>this.acquireTokenInteractively(o,d))))))}acquireTokenInteractively(o,d){if(this.msalInterceptorConfig.interactionType===y.X8.Popup)return this.authService.getLogger().verbose("Interceptor - error acquiring token silently, acquiring by popup"),this.authService.acquireTokenPopup({...o,scopes:d});this.authService.getLogger().verbose("Interceptor - error acquiring token silently, acquiring by redirect");const u=window.location.href;return this.authService.acquireTokenRedirect({...o,scopes:d,redirectStartPage:u}),p.w}getScopesForEndpoint(o,d){this.authService.getLogger().verbose("Interceptor - getting scopes for endpoint");const u=this.location.normalize(o),m=Array.from(this.msalInterceptorConfig.protectedResourceMap.keys()),I=this.matchResourcesToEndpoint(m,u);return I.absoluteResources.length>0?this.matchScopesToEndpoint(this.msalInterceptorConfig.protectedResourceMap,I.absoluteResources,d):I.relativeResources.length>0?this.matchScopesToEndpoint(this.msalInterceptorConfig.protectedResourceMap,I.relativeResources,d):null}matchResourcesToEndpoint(o,d){const u={absoluteResources:[],relativeResources:[]};return o.forEach(m=>{const I=this.location.normalize(m);S.$.matchPattern(I,d)&&u.absoluteResources.push(m);const K=this.getAbsoluteUrl(m),Q=new f.H(K).getUrlComponents(),ee=this.getAbsoluteUrl(d),ae=new f.H(ee).getUrlComponents(),he=Q.QueryString?`${Q.AbsolutePath}?${Q.QueryString}`:this.location.normalize(Q.AbsolutePath);Q.HostNameAndPort===ae.HostNameAndPort&&S.$.matchPattern(he,ee)&&""!==he&&"/*"!==he&&u.relativeResources.push(m)}),u}getAbsoluteUrl(o){const d=this._document.createElement("a");return d.href=o,d.href}matchScopesToEndpoint(o,d,u){const m=[];return d.forEach(I=>{const K=[],Q=o.get(I);null!==Q?(Q.forEach(ee=>{if("string"==typeof ee)K.push(ee);else{const ae=u.toLowerCase();ee.httpMethod.toLowerCase()===ae&&(null===ee.scopes?m.push(null):ee.scopes.forEach(be=>{K.push(be)}))}}),K.length>0&&m.push(K)):m.push(null)}),m.length>0?(m.length>1&&this.authService.getLogger().warning("Interceptor - More than 1 matching scopes for endpoint found."),m[0]):null}}return i.\u0275fac=function(o){return new(o||i)(c.KVO(k),c.KVO(x),c.KVO(s.aZ),c.KVO(z),c.KVO(s.qQ))},i.\u0275prov=c.jDH({token:i,factory:i.\u0275fac}),i})(),ne=(()=>{class i{constructor(o){this.authService=o}ngOnInit(){this.authService.getLogger().verbose("MsalRedirectComponent activated"),this.authService.handleRedirectObservable().subscribe()}}return i.\u0275fac=function(o){return new(o||i)(c.rXU(x))},i.\u0275cmp=c.VBU({type:i,selectors:[["app-redirect"]],decls:0,vars:0,template:function(o,d){},encapsulation:2}),i})();var q=g(467),_=g(8173),pe=g(5189),fe=g(7306);class ue{static loggerCallback(r,o){switch(r){case _.$.Error:return void console.error(o);case _.$.Info:return void console.info(o);case _.$.Verbose:return void console.debug(o);case _.$.Warning:return void console.warn(o);default:return void console.log(o)}}constructor(r){let o;this.browserEnvironment=typeof window<"u",this.config=(0,pe.tD)(r,this.browserEnvironment);try{o=window[y.Al.SessionStorage]}catch{}const d=o?.getItem(y.L$),u=o?.getItem(y.P3)?.toLowerCase(),m="true"===u||"false"!==u&&void 0,I={...this.config.system.loggerOptions},K=d&&Object.keys(_.$).includes(d)?_.$[d]:void 0;K&&(I.loggerCallback=ue.loggerCallback,I.logLevel=K),void 0!==m&&(I.piiLoggingEnabled=m),this.logger=new _.V(I,fe.U,fe.r),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}let ge=(()=>{class i extends ue{getModuleName(){return i.MODULE_NAME}getId(){return i.ID}initialize(){var o=this;return(0,q.A)(function*(){return o.available=typeof window<"u",o.available})()}}return i.MODULE_NAME="",i.ID="StandardOperatingContext",i})();function le(){return(le=(0,q.A)(function*(i){const r=new ge(i);return yield r.initialize(),(yield Promise.resolve().then(g.bind(g,7836))).StandardController.createController(r)})).apply(this,arguments)}var xe=g(7836);class Ke{static createPublicClientApplication(r){return(0,q.A)(function*(){const o=yield function ce(i){return le.apply(this,arguments)}(r);return new Ke(r,o)})()}constructor(r,o){if(o)this.controller=o;else{const d=new ge(r);this.controller=new xe.StandardController(d)}}initialize(){var r=this;return(0,q.A)(function*(){return r.controller.initialize()})()}acquireTokenPopup(r){var o=this;return(0,q.A)(function*(){return o.controller.acquireTokenPopup(r)})()}acquireTokenRedirect(r){return this.controller.acquireTokenRedirect(r)}acquireTokenSilent(r){return this.controller.acquireTokenSilent(r)}acquireTokenByCode(r){return this.controller.acquireTokenByCode(r)}addEventCallback(r){return this.controller.addEventCallback(r)}removeEventCallback(r){return this.controller.removeEventCallback(r)}addPerformanceCallback(r){return this.controller.addPerformanceCallback(r)}removePerformanceCallback(r){return this.controller.removePerformanceCallback(r)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(r){return this.controller.getAccount(r)}getAccountByHomeId(r){return this.controller.getAccountByHomeId(r)}getAccountByLocalId(r){return this.controller.getAccountByLocalId(r)}getAccountByUsername(r){return this.controller.getAccountByUsername(r)}getAllAccounts(r){return this.controller.getAllAccounts(r)}handleRedirectPromise(r){return this.controller.handleRedirectPromise(r)}loginPopup(r){return this.controller.loginPopup(r)}loginRedirect(r){return this.controller.loginRedirect(r)}logout(r){return this.controller.logout(r)}logoutRedirect(r){return this.controller.logoutRedirect(r)}logoutPopup(r){return this.controller.logoutPopup(r)}ssoSilent(r){return this.controller.ssoSilent(r)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(r){this.controller.setLogger(r)}setActiveAccount(r){this.controller.setActiveAccount(r)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(r,o){return this.controller.initializeWrapperLibrary(r,o)}setNavigationClient(r){this.controller.setNavigationClient(r)}getConfiguration(){return this.controller.getConfiguration()}hydrateCache(r,o){var d=this;return(0,q.A)(function*(){return d.controller.hydrateCache(r,o)})()}clearCache(r){return this.controller.clearCache(r)}}var oe=g(1626),Z=g(5911),Xe=g(8834),Me=g(728),se=function(i){return i.GET="GET",i.PATCH="PATCH",i.POST="POST",i.PUT="PUT",i.DELETE="DELETE",i}(se||{}),ie=g(1635);const we=new Set(["graph.microsoft.com","graph.microsoft.us","dod-graph.microsoft.us","graph.microsoft.de","microsoftgraph.chinacloudapi.cn","canary.graph.microsoft.com"]);class Ae extends Error{static setGraphClientError(r){let o;return r instanceof Error?o=r:(o=new Ae,o.customError=r),o}constructor(r){super(r),Object.setPrototypeOf(this,Ae.prototype)}}const ht=["$select","$expand","$orderby","$filter","$top","$skip","$skipToken","$count"],Ge=i=>{const r=i&&i.constructor&&i.constructor.name;if("Buffer"===r||"Blob"===r||"File"===r||"FormData"===r||"string"==typeof i)return i;if("ArrayBuffer"===r)i=Buffer.from(i);else if("Int8Array"===r||"Int16Array"===r||"Int32Array"===r||"Uint8Array"===r||"Uint16Array"===r||"Uint32Array"===r||"Uint8ClampedArray"===r||"Float32Array"===r||"Float64Array"===r||"DataView"===r)i=Buffer.from(i.buffer);else try{i=JSON.stringify(i)}catch{throw new Error("Unable to stringify the content")}return i},Oe=i=>ye(i),me=(i,r)=>(r.forEach(o=>Mt(o)),ye(i,r)),ye=(i,r=we)=>{if(-1!==(i=i.toLowerCase()).indexOf("https://")){const o=(i=i.replace("https://","")).indexOf(":"),d=i.indexOf("/");let u="";if(-1!==d)return-1!==o&&o<d?(u=i.substring(0,o),r.has(u)):(u=i.substring(0,d),r.has(u))}return!1},Mt=i=>{if(-1!==i.indexOf("/"))throw new Ae("Please add only hosts or hostnames to the CustomHosts config. If the url is `http://example.com:3000/`, host is `example:3000`")};class Ce{constructor(r=[]){this.middlewareOptions=new Map;for(const o of r)this.middlewareOptions.set(o.constructor,o)}getMiddlewareOptions(r){return this.middlewareOptions.get(r)}setMiddlewareOptions(r,o){this.middlewareOptions.set(r,o)}}const gt=(i,r,o)=>{let d=null;if(typeof Request<"u"&&i instanceof Request)d=i.headers.get(o);else if(typeof r<"u"&&void 0!==r.headers)if(typeof Headers<"u"&&r.headers instanceof Headers)d=r.headers.get(o);else if(r.headers instanceof Array){const u=r.headers;for(let m=0,I=u.length;m<I;m++)if(u[m][0]===o){d=u[m][1];break}}else void 0!==r.headers[o]&&(d=r.headers[o]);return d},We=(i,r,o,d)=>{if(typeof Request<"u"&&i instanceof Request)i.headers.set(o,d);else if(typeof r<"u")if(void 0===r.headers)r.headers=new Headers({[o]:d});else if(typeof Headers<"u"&&r.headers instanceof Headers)r.headers.set(o,d);else if(r.headers instanceof Array){let u=0;const m=r.headers.length;for(;u<m;u++){const I=r.headers[u];if(I[0]===o){I[1]=d;break}}u===m&&r.headers.push([o,d])}else Object.assign(r.headers,{[o]:d})},pt=(i,r,o,d)=>{typeof Request<"u"&&i instanceof Request?i.headers.append(o,d):typeof r<"u"&&(void 0===r.headers?r.headers=new Headers({[o]:d}):typeof Headers<"u"&&r.headers instanceof Headers?r.headers.append(o,d):r.headers instanceof Array?r.headers.push([o,d]):void 0===r.headers?r.headers={[o]:d}:void 0===r.headers[o]?r.headers[o]=d:r.headers[o]+=`, ${d}`)};class rt{constructor(r,o){this.authenticationProvider=r,this.authenticationProviderOptions=o}}var $e=function(i){return i[i.NONE=0]="NONE",i[i.REDIRECT_HANDLER_ENABLED=1]="REDIRECT_HANDLER_ENABLED",i[i.RETRY_HANDLER_ENABLED=2]="RETRY_HANDLER_ENABLED",i[i.AUTHENTICATION_HANDLER_ENABLED=4]="AUTHENTICATION_HANDLER_ENABLED",i}($e||{});class _e{constructor(){this.featureUsage=$e.NONE}static updateFeatureUsageFlag(r,o){let d;r.middlewareControl instanceof Ce?d=r.middlewareControl.getMiddlewareOptions(_e):r.middlewareControl=new Ce,typeof d>"u"&&(d=new _e,r.middlewareControl.setMiddlewareOptions(_e,d)),d.setFeatureUsage(o)}setFeatureUsage(r){this.featureUsage=this.featureUsage|r}getFeatureUsage(){return this.featureUsage.toString(16)}}let ot=(()=>{class i{constructor(o){this.authenticationProvider=o}execute(o){return(0,ie.sH)(this,void 0,void 0,function*(){const d="string"==typeof o.request?o.request:o.request.url;if(Oe(d)||o.customHosts&&me(d,o.customHosts)){let u,m,I;o.middlewareControl instanceof Ce&&(u=o.middlewareControl.getMiddlewareOptions(rt)),u&&(m=u.authenticationProvider,I=u.authenticationProviderOptions),m||(m=this.authenticationProvider);const Q=`Bearer ${yield m.getAccessToken(I)}`;pt(o.request,o.options,i.AUTHORIZATION_HEADER,Q),_e.updateFeatureUsageFlag(o,$e.AUTHENTICATION_HANDLER_ENABLED)}else o.options.headers&&delete o.options.headers[i.AUTHORIZATION_HEADER];return yield this.nextMiddleware.execute(o)})}setNext(o){this.nextMiddleware=o}}return i.AUTHORIZATION_HEADER="Authorization",i})(),Ve=(()=>{class i{constructor(o=i.DEFAULT_DELAY,d=i.DEFAULT_MAX_RETRIES,u=i.defaultShouldRetry){if(o>i.MAX_DELAY&&d>i.MAX_MAX_RETRIES){const m=new Error(`Delay and MaxRetries should not be more than ${i.MAX_DELAY} and ${i.MAX_MAX_RETRIES}`);throw m.name="MaxLimitExceeded",m}if(o>i.MAX_DELAY){const m=new Error(`Delay should not be more than ${i.MAX_DELAY}`);throw m.name="MaxLimitExceeded",m}if(d>i.MAX_MAX_RETRIES){const m=new Error(`MaxRetries should not be more than ${i.MAX_MAX_RETRIES}`);throw m.name="MaxLimitExceeded",m}if(o<0&&d<0){const m=new Error("Delay and MaxRetries should not be negative");throw m.name="MinExpectationNotMet",m}if(o<0){const m=new Error("Delay should not be negative");throw m.name="MinExpectationNotMet",m}if(d<0){const m=new Error("MaxRetries should not be negative");throw m.name="MinExpectationNotMet",m}this.delay=Math.min(o,i.MAX_DELAY),this.maxRetries=Math.min(d,i.MAX_MAX_RETRIES),this.shouldRetry=u}getMaxDelay(){return i.MAX_DELAY}}return i.DEFAULT_DELAY=3,i.DEFAULT_MAX_RETRIES=3,i.MAX_DELAY=180,i.MAX_MAX_RETRIES=10,i.defaultShouldRetry=()=>!0,i})(),Qe=(()=>{class i{constructor(o=new Ve){this.options=o}isRetry(o){return-1!==i.RETRY_STATUS_CODES.indexOf(o.status)}isBuffered(o,d){const u="string"==typeof o?d.method:o.method;return!((u===se.PUT||u===se.PATCH||u===se.POST)&&"application/octet-stream"===gt(o,d,"Content-Type"))}getDelay(o,d,u){const m=()=>Number(Math.random().toFixed(3)),I=void 0!==o.headers?o.headers.get(i.RETRY_AFTER_HEADER):null;let K;return K=null!==I?Number.isNaN(Number(I))?Math.round((new Date(I).getTime()-Date.now())/1e3):Number(I):d>=2?this.getExponentialBackOffTime(d)+u+m():u+m(),Math.min(K,this.options.getMaxDelay()+m())}getExponentialBackOffTime(o){return Math.round(.5*(Math.pow(2,o)-1))}sleep(o){return(0,ie.sH)(this,void 0,void 0,function*(){const d=1e3*o;return new Promise(u=>setTimeout(u,d))})}getOptions(o){let d;return o.middlewareControl instanceof Ce&&(d=o.middlewareControl.getMiddlewareOptions(this.options.constructor)),typeof d>"u"&&(d=Object.assign(new Ve,this.options)),d}executeWithRetry(o,d,u){return(0,ie.sH)(this,void 0,void 0,function*(){if(yield this.nextMiddleware.execute(o),d<u.maxRetries&&this.isRetry(o.response)&&this.isBuffered(o.request,o.options)&&u.shouldRetry(u.delay,d,o.request,o.options,o.response)){++d,We(o.request,o.options,i.RETRY_ATTEMPT_HEADER,d.toString());const m=this.getDelay(o.response,d,u.delay);return yield this.sleep(m),yield this.executeWithRetry(o,d,u)}})}execute(o){return(0,ie.sH)(this,void 0,void 0,function*(){const u=this.getOptions(o);return _e.updateFeatureUsageFlag(o,$e.RETRY_HANDLER_ENABLED),yield this.executeWithRetry(o,0,u)})}setNext(o){this.nextMiddleware=o}}return i.RETRY_STATUS_CODES=[429,503,504],i.RETRY_ATTEMPT_HEADER="Retry-Attempt",i.RETRY_AFTER_HEADER="Retry-After",i})(),je=(()=>{class i{constructor(o=i.DEFAULT_MAX_REDIRECTS,d=i.defaultShouldRedirect){if(o>i.MAX_MAX_REDIRECTS){const u=new Error(`MaxRedirects should not be more than ${i.MAX_MAX_REDIRECTS}`);throw u.name="MaxLimitExceeded",u}if(o<0){const u=new Error("MaxRedirects should not be negative");throw u.name="MinExpectationNotMet",u}this.maxRedirects=o,this.shouldRedirect=d}}return i.DEFAULT_MAX_REDIRECTS=5,i.MAX_MAX_REDIRECTS=20,i.defaultShouldRedirect=()=>!0,i})(),ve=(()=>{class i{constructor(o=new je){this.options=o}isRedirect(o){return-1!==i.REDIRECT_STATUS_CODES.indexOf(o.status)}hasLocationHeader(o){return o.headers.has(i.LOCATION_HEADER)}getLocationHeader(o){return o.headers.get(i.LOCATION_HEADER)}isRelativeURL(o){return-1===o.indexOf("://")}shouldDropAuthorizationHeader(o,d){const u=/^[A-Za-z].+?:\/\/.+?(?=\/|$)/,m=u.exec(o);let I,K;null!==m&&(I=m[0]);const Q=u.exec(d);return null!==Q&&(K=Q[0]),typeof I<"u"&&typeof K<"u"&&I!==K}updateRequestUrl(o,d){return(0,ie.sH)(this,void 0,void 0,function*(){d.request="string"==typeof d.request?o:yield((i,r)=>(0,ie.sH)(void 0,void 0,void 0,function*(){const o=r.headers.get("Content-Type")?yield r.blob():yield Promise.resolve(void 0),{method:d,headers:u,referrer:m,referrerPolicy:I,mode:K,credentials:Q,cache:ee,redirect:ae,integrity:he,keepalive:be,signal:He}=r;return new Request(i,{method:d,headers:u,body:o,referrer:m,referrerPolicy:I,mode:K,credentials:Q,cache:ee,redirect:ae,integrity:he,keepalive:be,signal:He})}))(o,d.request)})}getOptions(o){let d;return o.middlewareControl instanceof Ce&&(d=o.middlewareControl.getMiddlewareOptions(je)),typeof d>"u"&&(d=Object.assign(new je,this.options)),d}executeWithRedirect(o,d,u){return(0,ie.sH)(this,void 0,void 0,function*(){yield this.nextMiddleware.execute(o);const m=o.response;if(d<u.maxRedirects&&this.isRedirect(m)&&this.hasLocationHeader(m)&&u.shouldRedirect(m)){if(++d,m.status===i.STATUS_CODE_SEE_OTHER)o.options.method=se.GET,delete o.options.body;else{const I=this.getLocationHeader(m);!this.isRelativeURL(I)&&this.shouldDropAuthorizationHeader(m.url,I)&&delete o.options.headers[i.AUTHORIZATION_HEADER],yield this.updateRequestUrl(I,o)}yield this.executeWithRedirect(o,d,u)}})}execute(o){return(0,ie.sH)(this,void 0,void 0,function*(){const u=this.getOptions(o);return o.options.redirect=i.MANUAL_REDIRECT,_e.updateFeatureUsageFlag(o,$e.REDIRECT_HANDLER_ENABLED),yield this.executeWithRedirect(o,0,u)})}setNext(o){this.nextMiddleware=o}}return i.REDIRECT_STATUS_CODES=[301,302,303,307,308],i.STATUS_CODE_SEE_OTHER=303,i.LOCATION_HEADER="Location",i.AUTHORIZATION_HEADER="Authorization",i.MANUAL_REDIRECT="manual",i})(),Ot=(()=>{class i{execute(o){return(0,ie.sH)(this,void 0,void 0,function*(){const d="string"==typeof o.request?o.request:o.request.url;if(Oe(d)||o.customHosts&&me(d,o.customHosts)){let u=gt(o.request,o.options,i.CLIENT_REQUEST_ID_HEADER);u||(u=(()=>{let i="";for(let r=0;r<32;r++)(8===r||12===r||16===r||20===r)&&(i+="-"),i+=Math.floor(16*Math.random()).toString(16);return i})(),We(o.request,o.options,i.CLIENT_REQUEST_ID_HEADER,u));let I,m=`${i.PRODUCT_NAME}/3.0.7`;if(o.middlewareControl instanceof Ce&&(I=o.middlewareControl.getMiddlewareOptions(_e)),I){const K=I.getFeatureUsage();m+=` (${i.FEATURE_USAGE_STRING}=${K})`}pt(o.request,o.options,i.SDK_VERSION_HEADER,m)}else delete o.options.headers[i.CLIENT_REQUEST_ID_HEADER],delete o.options.headers[i.SDK_VERSION_HEADER];return yield this.nextMiddleware.execute(o)})}setNext(o){this.nextMiddleware=o}}return i.CLIENT_REQUEST_ID_HEADER="client-request-id",i.SDK_VERSION_HEADER="SdkVersion",i.PRODUCT_NAME="graph-js",i.FEATURE_USAGE_STRING="featureUsage",i})();var Ie=function(i){return i.ARRAYBUFFER="arraybuffer",i.BLOB="blob",i.DOCUMENT="document",i.JSON="json",i.RAW="raw",i.STREAM="stream",i.TEXT="text",i}(Ie||{}),Je=function(i){return i.TEXT_HTML="text/html",i.TEXT_XML="text/xml",i.APPLICATION_XML="application/xml",i.APPLICATION_XHTML="application/xhtml+xml",i}(Je||{}),ke=function(i){return i.TEXT_PLAIN="text/plain",i.APPLICATION_JSON="application/json",i}(ke||{}),Ze=function(i){return i.DOCUMENT="^(text\\/(html|xml))|(application\\/(xml|xhtml\\+xml))$",i.IMAGE="^image\\/.+",i}(Ze||{});class qe{static parseDocumentResponse(r,o){return typeof DOMParser<"u"?new Promise((d,u)=>{r.text().then(m=>{try{const K=(new DOMParser).parseFromString(m,o);d(K)}catch(I){u(I)}})}):Promise.resolve(r.body)}static convertResponse(r,o){return(0,ie.sH)(this,void 0,void 0,function*(){if(204===r.status)return Promise.resolve();let d;const u=r.headers.get("Content-type");switch(o){case Ie.ARRAYBUFFER:d=yield r.arrayBuffer();break;case Ie.BLOB:d=yield r.blob();break;case Ie.DOCUMENT:d=yield qe.parseDocumentResponse(r,Je.TEXT_XML);break;case Ie.JSON:d=yield r.json();break;case Ie.STREAM:d=yield Promise.resolve(r.body);break;case Ie.TEXT:d=yield r.text();break;default:if(null!==u){const m=u.split(";")[0];d=new RegExp(Ze.DOCUMENT).test(m)?yield qe.parseDocumentResponse(r,m):new RegExp(Ze.IMAGE).test(m)?r.blob():m===ke.TEXT_PLAIN?yield r.text():m===ke.APPLICATION_JSON?yield r.json():Promise.resolve(r.body)}else d=Promise.resolve(r.body)}return d})}static getResponse(r,o,d){return(0,ie.sH)(this,void 0,void 0,function*(){if(o===Ie.RAW)return Promise.resolve(r);{const u=yield qe.convertResponse(r,o);if(!r.ok)throw u;if("function"!=typeof d)return u;d(null,u)}})}}class Nt{constructor(r){this.provider=r}getAccessToken(){return(0,ie.sH)(this,void 0,void 0,function*(){return new Promise((r,o)=>{this.provider((d,u)=>(0,ie.sH)(this,void 0,void 0,function*(){if(u)r(u);else{d||(d=new Ae("Access token is undefined or empty.\t\t\t\t\t\tPlease provide a valid token.\t\t\t\t\t\tFor more help - https://github.com/microsoftgraph/msgraph-sdk-javascript/blob/dev/docs/CustomAuthenticationProvider.md"));const m=yield Ae.setGraphClientError(d);o(m)}}))})})}}class Ye extends Error{constructor(r=-1,o,d){super(o||d&&d.message),Object.setPrototypeOf(this,Ye.prototype),this.statusCode=r,this.code=null,this.requestId=null,this.date=new Date,this.body=null,this.stack=d?d.stack:this.stack}}class et{static constructError(r,o,d){const u=new Ye(o,"",r);return void 0!==r.name&&(u.code=r.name),u.body=r.toString(),u.date=new Date,u.headers=d?.headers,u}static constructErrorFromResponse(r,o,d){const u=r.error,m=new Ye(o,u.message);return m.code=u.code,void 0!==u.innerError&&(m.requestId=u.innerError["request-id"],m.date=new Date(u.innerError.date)),m.body=JSON.stringify(u),m.headers=d?.headers,m}static getError(r=null,o=-1,d,u){return(0,ie.sH)(this,void 0,void 0,function*(){let m;if(r&&r.error?m=et.constructErrorFromResponse(r,o,u):r instanceof Error?m=et.constructError(r,o,u):(m=new Ye(o),m.body=r),"function"!=typeof d)return m;d(m,null)})}}class Dt{constructor(r,o,d){this.parsePath=u=>{if(-1!==u.indexOf("https://")){const I=(u=u.replace("https://","")).indexOf("/");-1!==I&&(this.urlComponents.host="https://"+u.substring(0,I),u=u.substring(I+1,u.length));const K=u.indexOf("/");-1!==K&&(this.urlComponents.version=u.substring(0,K),u=u.substring(K+1,u.length))}"/"===u.charAt(0)&&(u=u.substr(1));const m=u.indexOf("?");if(-1===m)this.urlComponents.path=u;else{this.urlComponents.path=u.substr(0,m);const I=u.substring(m+1,u.length).split("&");for(const K of I)this.parseQueryParameter(K)}},this.httpClient=r,this.config=o,this.urlComponents={host:this.config.baseUrl,version:this.config.defaultVersion,oDataQueryParams:{},otherURLQueryParams:{},otherURLQueryOptions:[]},this._headers={},this._options={},this._middlewareOptions=[],this.parsePath(d)}addCsvQueryParameter(r,o,d){this.urlComponents.oDataQueryParams[r]=this.urlComponents.oDataQueryParams[r]?this.urlComponents.oDataQueryParams[r]+",":"";let u=[];d.length>1&&"string"==typeof o?u=Array.prototype.slice.call(d):"string"==typeof o?u.push(o):u=u.concat(o),this.urlComponents.oDataQueryParams[r]+=u.join(",")}buildFullUrl(){const r=(i=>{const r=m=>m.replace(/\/+$/,""),o=m=>m.replace(/^\/+/,"");return Array.prototype.slice.call([this.urlComponents.host,this.urlComponents.version,this.urlComponents.path]).reduce((m,I)=>[r(m),o(I)].join("/"))})()+this.createQueryString();return this.config.debugLogging&&console.log(r),r}createQueryString(){const r=this.urlComponents,o=[];if(0!==Object.keys(r.oDataQueryParams).length)for(const d in r.oDataQueryParams)Object.prototype.hasOwnProperty.call(r.oDataQueryParams,d)&&o.push(d+"="+r.oDataQueryParams[d]);if(0!==Object.keys(r.otherURLQueryParams).length)for(const d in r.otherURLQueryParams)Object.prototype.hasOwnProperty.call(r.otherURLQueryParams,d)&&o.push(d+"="+r.otherURLQueryParams[d]);if(0!==r.otherURLQueryOptions.length)for(const d of r.otherURLQueryOptions)o.push(d);return o.length>0?"?"+o.join("&"):""}parseQueryParameter(r){if("string"==typeof r)if("?"===r.charAt(0)&&(r=r.substring(1)),-1!==r.indexOf("&")){const o=r.split("&");for(const d of o)this.parseQueryParamenterString(d)}else this.parseQueryParamenterString(r);else if(r.constructor===Object)for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&this.setURLComponentsQueryParamater(o,r[o]);return this}parseQueryParamenterString(r){if(this.isValidQueryKeyValuePair(r)){const o=r.indexOf("="),d=r.substring(0,o),u=r.substring(o+1);this.setURLComponentsQueryParamater(d,u)}else this.urlComponents.otherURLQueryOptions.push(r)}setURLComponentsQueryParamater(r,o){if(-1!==ht.indexOf(r)){const d=this.urlComponents.oDataQueryParams[r];this.urlComponents.oDataQueryParams[r]=!d||"$expand"!==r&&"$select"!==r&&"$orderby"!==r?o:d+","+o}else this.urlComponents.otherURLQueryParams[r]=o}isValidQueryKeyValuePair(r){const o=r.indexOf("=");return!(-1===o||-1!==r.indexOf("(")&&r.indexOf("(")<o)}updateRequestOptions(r){const o=Object.assign({},r.headers);if(void 0!==this.config.fetchOptions){const d=Object.assign({},this.config.fetchOptions);Object.assign(r,d),void 0!==typeof this.config.fetchOptions.headers&&(r.headers=Object.assign({},this.config.fetchOptions.headers))}Object.assign(r,this._options),void 0!==r.headers&&Object.assign(o,r.headers),Object.assign(o,this._headers),r.headers=o}send(r,o,d){var u;return(0,ie.sH)(this,void 0,void 0,function*(){let m;const I=new Ce(this._middlewareOptions);this.updateRequestOptions(o);const K=null===(u=this.config)||void 0===u?void 0:u.customHosts;try{return m=(yield this.httpClient.sendRequest({request:r,options:o,middlewareControl:I,customHosts:K})).response,yield qe.getResponse(m,this._responseType,d)}catch(Q){if(Q instanceof Ae)throw Q;let ee;throw m&&(ee=m.status),yield et.getError(Q,ee,d,m)}})}setHeaderContentType(){if(!this._headers)return void this.header("Content-Type","application/json");const r=Object.keys(this._headers);for(const o of r)if("content-type"===o.toLowerCase())return;this.header("Content-Type","application/json")}header(r,o){return this._headers[r]=o,this}headers(r){for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&(this._headers[o]=r[o]);return this}option(r,o){return this._options[r]=o,this}options(r){for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&(this._options[o]=r[o]);return this}middlewareOptions(r){return this._middlewareOptions=r,this}version(r){return this.urlComponents.version=r,this}responseType(r){return this._responseType=r,this}select(r){return this.addCsvQueryParameter("$select",r,arguments),this}expand(r){return this.addCsvQueryParameter("$expand",r,arguments),this}orderby(r){return this.addCsvQueryParameter("$orderby",r,arguments),this}filter(r){return this.urlComponents.oDataQueryParams.$filter=r,this}search(r){return this.urlComponents.oDataQueryParams.$search=r,this}top(r){return this.urlComponents.oDataQueryParams.$top=r,this}skip(r){return this.urlComponents.oDataQueryParams.$skip=r,this}skipToken(r){return this.urlComponents.oDataQueryParams.$skipToken=r,this}count(r=!0){return this.urlComponents.oDataQueryParams.$count=r.toString(),this}query(r){return this.parseQueryParameter(r)}get(r){return(0,ie.sH)(this,void 0,void 0,function*(){const o=this.buildFullUrl(),d={method:se.GET};return yield this.send(o,d,r)})}post(r,o){return(0,ie.sH)(this,void 0,void 0,function*(){const d=this.buildFullUrl(),u={method:se.POST,body:Ge(r)};return"FormData"===(r&&r.constructor&&r.constructor.name)?u.headers={}:(this.setHeaderContentType(),u.headers=this._headers),yield this.send(d,u,o)})}create(r,o){return(0,ie.sH)(this,void 0,void 0,function*(){return yield this.post(r,o)})}put(r,o){return(0,ie.sH)(this,void 0,void 0,function*(){const d=this.buildFullUrl();this.setHeaderContentType();const u={method:se.PUT,body:Ge(r)};return yield this.send(d,u,o)})}patch(r,o){return(0,ie.sH)(this,void 0,void 0,function*(){const d=this.buildFullUrl();this.setHeaderContentType();const u={method:se.PATCH,body:Ge(r)};return yield this.send(d,u,o)})}update(r,o){return(0,ie.sH)(this,void 0,void 0,function*(){return yield this.patch(r,o)})}delete(r){return(0,ie.sH)(this,void 0,void 0,function*(){const o=this.buildFullUrl(),d={method:se.DELETE};return yield this.send(o,d,r)})}del(r){return(0,ie.sH)(this,void 0,void 0,function*(){return yield this.delete(r)})}getStream(r){return(0,ie.sH)(this,void 0,void 0,function*(){const o=this.buildFullUrl(),d={method:se.GET};return this.responseType(Ie.STREAM),yield this.send(o,d,r)})}putStream(r,o){return(0,ie.sH)(this,void 0,void 0,function*(){const d=this.buildFullUrl(),u={method:se.PUT,headers:{"Content-Type":"application/octet-stream"},body:r};return yield this.send(d,u,o)})}}class Tt{constructor(...r){if(!r||!r.length){const o=new Error;throw o.name="InvalidMiddlewareChain",o.message="Please provide a default middleware chain or custom middleware chain",o}this.setMiddleware(...r)}setMiddleware(...r){r.length>1?this.parseMiddleWareArray(r):this.middleware=r[0]}parseMiddleWareArray(r){r.forEach((o,d)=>{d<r.length-1&&o.setNext(r[d+1])}),this.middleware=r[0]}sendRequest(r){return(0,ie.sH)(this,void 0,void 0,function*(){if("string"==typeof r.request&&void 0===r.options){const o=new Error;throw o.name="InvalidRequestOptions",o.message="Unable to execute the middleware, Please provide valid options for a request",o}return yield this.middleware.execute(r),r})}}class Se{execute(r){return(0,ie.sH)(this,void 0,void 0,function*(){r.response=yield fetch(r.request,r.options)})}}class ze{static createWithAuthenticationProvider(r){const o=new ot(r),d=new Qe(new Ve),u=new Ot,m=new Se;if(o.setNext(d),"object"==typeof process){const I=new ve(new je);d.setNext(I),I.setNext(u)}else d.setNext(u);return u.setNext(m),ze.createWithMiddleware(o)}static createWithMiddleware(...r){return new Tt(...r)}}class Le{static init(r){const o={};for(const d in r)Object.prototype.hasOwnProperty.call(r,d)&&(o[d]="authProvider"===d?new Nt(r[d]):r[d]);return Le.initWithMiddleware(o)}static initWithMiddleware(r){return new Le(r)}constructor(r){this.config={baseUrl:"https://graph.microsoft.com/",debugLogging:!1,defaultVersion:"v1.0"},(()=>{if(typeof Promise>"u"&&typeof fetch>"u"){const i=new Error("Library cannot function without Promise and fetch. So, please provide polyfill for them.");throw i.name="PolyFillNotAvailable",i}if(typeof Promise>"u"){const i=new Error("Library cannot function without Promise. So, please provide polyfill for it.");throw i.name="PolyFillNotAvailable",i}if(typeof fetch>"u"){const i=new Error("Library cannot function without fetch. So, please provide polyfill for it.");throw i.name="PolyFillNotAvailable",i}})();for(const d in r)Object.prototype.hasOwnProperty.call(r,d)&&(this.config[d]=r[d]);let o;if(void 0!==r.authProvider&&void 0!==r.middleware){const d=new Error;throw d.name="AmbiguityInInitialization",d.message="Unable to Create Client, Please provide either authentication provider for default middleware chain or custom middleware chain not both",d}if(void 0!==r.authProvider)o=ze.createWithAuthenticationProvider(r.authProvider);else{if(void 0===r.middleware){const d=new Error;throw d.name="InvalidMiddlewareChain",d.message="Unable to Create Client, Please provide either authentication provider for default middleware chain or custom middleware chain",d}o=new Tt(...[].concat(r.middleware))}this.httpClient=o}api(r){return new Dt(this.httpClient,this.config,r)}}var Lt=g(9350),yt=g(7707);let Ne=(()=>{class i{constructor(o){this.msalService=o}getGraphClient(){if(!this.client){const o=this.msalService.instance.getAllAccounts();let d;if(o.length>0){d=o[0];const u={scopes:["openid","profile","User.Read","email","Mail.Read","Mail.ReadWrite","Mail.ReadBasic"],account:d};let I={authProvider:{getAccessToken:K=>function it(i,r){const o="object"==typeof r;return new Promise((d,u)=>{const m=new yt.Ms({next:I=>{d(I),m.unsubscribe()},error:u,complete:()=>{o?d(r.defaultValue):u(new Lt.G)}});i.subscribe(m)})}(this.msalService.acquireTokenSilent(u)).then(Q=>Q.accessToken)}};this.client=Le.initWithMiddleware(I)}}return this.client}static#e=this.\u0275fac=function(d){return new(d||i)(c.KVO(x))};static#t=this.\u0275prov=c.jDH({token:i,factory:i.\u0275fac})}return i})();var Ee=g(9631),De=g(9417),Be=g(2102),at=g(9213),Bt=g(6977);let vt=(()=>{class i{constructor(o,d,u){this.msalGuardConfig=o,this.authService=d,this.msalBroadcastService=u,this.isIframe=!1,this.loginDisplay=!1,this._destroying$=new G.B}ngOnInit(){this.authService.instance.initialize().then(()=>{this.authService.handleRedirectObservable().subscribe(),this.isIframe=window!==window.parent&&!window.opener,this.authService.instance.enableAccountStorageEvents(),this.msalBroadcastService.inProgress$.pipe((0,w.p)(o=>o===y.T$.None),(0,Bt.Q)(this._destroying$)).subscribe(()=>{this.checkAndSetActiveAccount()})})}checkAndSetActiveAccount(){if(!this.authService.instance.getActiveAccount()&&this.authService.instance.getAllAccounts().length>0){let d=this.authService.instance.getAllAccounts();this.authService.instance.setActiveAccount(d[0])}}loginRedirect(){this.msalGuardConfig.authRequest?this.authService.loginRedirect({...this.msalGuardConfig.authRequest}):this.authService.loginRedirect()}ngOnDestroy(){this._destroying$.next(void 0),this._destroying$.complete()}static#e=this.\u0275fac=function(d){return new(d||i)(c.rXU($),c.rXU(x),c.rXU(z))};static#t=this.\u0275cmp=c.VBU({type:i,selectors:[["app-ms-login"]],decls:4,vars:0,consts:[[3,"click"]],template:function(d,u){1&d&&(c.j41(0,"p"),c.EFF(1," ms-login works! "),c.j41(2,"button",0),c.bIt("click",function(){return u.loginRedirect()}),c.EFF(3,"Login"),c.k0s()())}})}return i})();var _t=g(5596),Te=g(4069);function Ht(i,r){1&i&&(c.j41(0,"th",23),c.EFF(1," Id "),c.k0s())}function st(i,r){if(1&i&&(c.j41(0,"td",24),c.EFF(1),c.k0s()),2&i){const o=r.$implicit;c.R7$(),c.SpI(" ",o.id," ")}}function Ft(i,r){1&i&&(c.j41(0,"th",23),c.EFF(1," Assigned "),c.k0s())}function ct(i,r){if(1&i&&(c.j41(0,"td",25)(1,"p",26),c.EFF(2),c.k0s(),c.j41(3,"p",27),c.EFF(4),c.k0s()()),2&i){const o=r.$implicit;c.R7$(2),c.JRh(o.name),c.R7$(2),c.JRh(o.work)}}function xt(i,r){1&i&&(c.j41(0,"th",23),c.EFF(1," Project "),c.k0s())}function Kt(i,r){if(1&i&&(c.j41(0,"td",25)(1,"p",28),c.EFF(2),c.k0s()()),2&i){const o=r.$implicit;c.R7$(2),c.JRh(o.project)}}function It(i,r){1&i&&(c.j41(0,"th",23),c.EFF(1," Priority "),c.k0s())}function Gt(i,r){if(1&i&&(c.j41(0,"td",25)(1,"span"),c.EFF(2),c.k0s()()),2&i){const o=r.$implicit;c.R7$(),c.ZvI("badge ",o.badge," rounded-pill"),c.R7$(),c.JRh(o.priority)}}function $t(i,r){1&i&&(c.j41(0,"th",23),c.EFF(1," Budget "),c.k0s())}function jt(i,r){if(1&i&&(c.j41(0,"td",25)(1,"p",26),c.EFF(2),c.k0s()()),2&i){const o=r.$implicit;c.R7$(2),c.JRh(o.budget)}}function qt(i,r){1&i&&c.nrm(0,"tr",29)}function Yt(i,r){1&i&&c.nrm(0,"tr",30)}const zt=[{id:1,name:"Deep Javiya",work:"Frontend Devloper",project:"Flexy Angular",priority:"Low",badge:"badge-info",budget:"$3.9k"},{id:2,name:"Nirav Joshi",work:"Project Manager",project:"Hosting Press HTML",priority:"Medium",badge:"badge-primary",budget:"$24.5k"},{id:3,name:"Sunil Joshi",work:"Web Designer",project:"Elite Admin",priority:"High",badge:"badge-danger",budget:"$12.8k"},{id:4,name:"Maruti Makwana",work:"Backend Devloper",project:"Material Pro",priority:"Critical",badge:"badge-success",budget:"$2.4k"}];let Re=(()=>{class i{constructor(o){this.graphService=o,this.displayedColumns=["id","assigned","name","priority","budget"],this.dataSource=zt,this.mailSearchCriteria={subject:"",senderEmail:""}}ngOnInit(){}search(){this.graphService.getGraphClient().api("/me/mailFolders/SentItems/messages").filter(`sentDateTime ge 2024-01-01  and contains(Subject, '${this.mailSearchCriteria.subject}') and contains(from/emailAddress/address,'${this.mailSearchCriteria.senderEmail}')`).select("subject,sender").top(20).orderby(["sentDateTime desc"]).get().then(d=>console.log(d))}static#e=this.\u0275fac=function(d){return new(d||i)(c.rXU(Ne))};static#t=this.\u0275cmp=c.VBU({type:i,selectors:[["app-mailbox"]],decls:38,vars:5,consts:[[1,"card"],[1,"card-body"],[1,"w-100","d-flex","justify-content-center","align-items-center"],[1,"w-100"],["appearance","outline",1,"fs-16","w-auto"],["matInput","","type","text","placeholder","Enter subject",3,"ngModelChange","ngModel"],["appearance","outline",1,"fs-16","w-auto","mx-3"],["matInput","","type","email","placeholder","Enter sender email",3,"ngModelChange","ngModel"],["mat-icon-button","",3,"click"],["aria-label","icon-button with a search icon"],[1,"mb-56"],[1,"table-responsive"],["mat-table","",1,"text-nowrap","w-100",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","class","fw-medium",4,"matCellDef"],["matColumnDef","assigned"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","priority"],["matColumnDef","budget"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",1,"fw-medium"],["mat-cell",""],[1,"mb-0","fw-medium"],[1,"mb-0","fw-normal","op-5"],[1,"mb-0","fw-medium","op-5"],["mat-header-row",""],["mat-row",""]],template:function(d,u){1&d&&(c.j41(0,"div",0)(1,"div",1)(2,"mat-card",2)(3,"mat-card-content",3)(4,"mat-form-field",4)(5,"mat-label"),c.EFF(6,"Subject"),c.k0s(),c.j41(7,"input",5),c.mxI("ngModelChange",function(I){return c.DH7(u.mailSearchCriteria.subject,I)||(u.mailSearchCriteria.subject=I),I}),c.k0s()(),c.j41(8,"mat-form-field",6)(9,"mat-label"),c.EFF(10,"Sender Email"),c.k0s(),c.j41(11,"input",7),c.mxI("ngModelChange",function(I){return c.DH7(u.mailSearchCriteria.senderEmail,I)||(u.mailSearchCriteria.senderEmail=I),I}),c.k0s()(),c.j41(12,"button",8),c.bIt("click",function(){return u.search()}),c.j41(13,"mat-icon",9),c.EFF(14,"search"),c.k0s()()()()()(),c.j41(15,"mat-card",3)(16,"mat-card-content")(17,"h4",10),c.EFF(18,"Inbox"),c.k0s(),c.j41(19,"div",11)(20,"table",12),c.qex(21,13),c.DNE(22,Ht,2,0,"th",14)(23,st,2,1,"td",15),c.bVm(),c.qex(24,16),c.DNE(25,Ft,2,0,"th",14)(26,ct,5,2,"td",17),c.bVm(),c.qex(27,18),c.DNE(28,xt,2,0,"th",14)(29,Kt,3,1,"td",17),c.bVm(),c.qex(30,19),c.DNE(31,It,2,0,"th",14)(32,Gt,3,4,"td",17),c.bVm(),c.qex(33,20),c.DNE(34,$t,2,0,"th",14)(35,jt,3,1,"td",17),c.bVm(),c.DNE(36,qt,1,0,"tr",21)(37,Yt,1,0,"tr",22),c.k0s()()()()),2&d&&(c.R7$(7),c.R50("ngModel",u.mailSearchCriteria.subject),c.R7$(4),c.R50("ngModel",u.mailSearchCriteria.senderEmail),c.R7$(9),c.Y8G("dataSource",u.dataSource),c.R7$(16),c.Y8G("matHeaderRowDef",u.displayedColumns),c.R7$(),c.Y8G("matRowDefColumns",u.displayedColumns))},dependencies:[Ee.fg,Be.rl,Be.nJ,De.me,De.BC,De.vS,at.An,Xe.iY,_t.RN,_t.m2,Te.Zl,Te.tL,Te.ji,Te.cC,Te.YV,Te.iL,Te.KS,Te.$R,Te.YZ,Te.NB],styles:[".table-responsive[_ngcontent-%COMP%]{overflow-x:auto}td.mat-cell[_ngcontent-%COMP%]{padding:16px}th.mat-header-cell[_ngcontent-%COMP%]:first-of-type, td.mat-cell[_ngcontent-%COMP%]:first-of-type, td.mat-footer-cell[_ngcontent-%COMP%]:first-of-type{padding:16px}th.mat-header-cell[_ngcontent-%COMP%]{padding:16px}.mat-header-cell[_ngcontent-%COMP%]{font-size:14px}"]})}return i})();var lt=g(4791),Xt=g(4160);const M=[{path:"",component:C.H,children:[{path:"mailbox",component:Re,canActivate:[W]},{path:"ms-login",component:vt}]}];let e=(()=>{class i{static#e=this.\u0275fac=function(d){return new(d||i)};static#t=this.\u0275mod=c.$C({type:i,bootstrap:[C.H,ne]});static#n=this.\u0275inj=c.G2t({providers:[(0,v.lh)(M),(0,c.oKB)(Xe.Hl,Z.s5),(0,Me.pg)(),(0,oe.$R)((0,oe.Sx)(),(0,oe.ZZ)()),{provide:oe.a7,useClass:te,multi:!0},{provide:j,useFactory:t},{provide:$,useFactory:l},{provide:k,useFactory:a},x,W,z,Ne],imports:[s.MD,v.iI.forChild(M),Z.s5,Ee.fS,De.YN,De.X1,Be.RG,at.m_,lt.E,Xt.J]})}return i})();function t(){return new Ke({auth:{clientId:"047bcd51-4b13-487e-9899-fbddd7690f1d",authority:"https://login.microsoftonline.com/e8c68ddc-2298-43d0-8b43-48f719b469d1/oauth2/v2.0/authorize",redirectUri:"/mail/ms-login",postLogoutRedirectUri:"/logout"},cache:{cacheLocation:y.Al.LocalStorage,storeAuthStateInCookie:n},system:{allowNativeBroker:!1,loggerOptions:{loggerCallback:(i,r,o)=>{},piiLoggingEnabled:!1}}})}const n=window.navigator.userAgent.indexOf("MSIE ")>-1||window.navigator.userAgent.indexOf("Trident/")>-1;function a(){return{interactionType:y.X8.Redirect,protectedResourceMap:new Map([["https://graph.microsoft.com/v1.0/me",["user.read"]],["https://graph.microsoft.com/v1.0/me/messages",["openid","profile","User.Read","email","Mail.Read","Mail.ReadWrite","Mail.ReadBasic"]]])}}function l(){return{interactionType:y.X8.Redirect,authRequest:{scopes:["openid","https://graph.microsoft.com/mail.send","user.read","profile","email","Mail.Read","Mail.ReadWrite","Mail.ReadBasic"]},loginFailedRoute:"/login-failed"}}},8390:(J,F,g)=>{g.d(F,{X:()=>c});class c{constructor(){this.cache=new Map}getItem(C){return this.cache.get(C)||null}setItem(C,v){this.cache.set(C,v)}removeItem(C){this.cache.delete(C)}getKeys(){const C=[];return this.cache.forEach((v,y)=>{C.push(y)}),C}containsKey(C){return this.cache.has(C)}clear(){this.cache.clear()}}},5189:(J,F,g)=>{g.d(F,{YH:()=>O,tD:()=>P});var c=g(7635),s=g(2729),C=g(4719),v=g(8173),y=g(6964),E=g(3986),R=g(7172);const h={sendGetRequestAsync:()=>Promise.reject((0,E.SB)(R.R9)),sendPostRequestAsync:()=>Promise.reject((0,E.SB)(R.R9))};var f=g(4561);class D{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class S{generateId(){return"callback-id"}startMeasurement(j,$){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:f.hU.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:j,startTimeMs:Date.now(),correlationId:$||""},measurement:new D}}startPerformanceMeasurement(){return new D}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}var U=g(7806),Y=g(5424),G=g(7554);class T{navigateInternal(j,$){return T.defaultNavigateWindow(j,$)}navigateExternal(j,$){return T.defaultNavigateWindow(j,$)}static defaultNavigateWindow(j,$){return $.noHistory?window.location.replace(j):window.location.assign(j),new Promise(k=>{setTimeout(()=>{k(!0)},$.timeout)})}}var X=g(467),p=g(6810),A=g(6588);class N{sendGetRequestAsync(j,$){var k=this;return(0,X.A)(function*(){let H;try{H=yield fetch(j,{method:G.CC.GET,headers:k.getFetchHeaders($)})}catch{throw window.navigator.onLine?(0,p.bD)(A.Zw):(0,p.bD)(A.l7)}try{return{headers:k.getHeaderDict(H.headers),body:yield H.json(),status:H.status}}catch{throw(0,p.bD)(A.db)}})()}sendPostRequestAsync(j,$){var k=this;return(0,X.A)(function*(){const H=$&&$.body||c.YM.EMPTY_STRING;let x;try{x=yield fetch(j,{method:G.CC.POST,headers:k.getFetchHeaders($),body:H})}catch{throw window.navigator.onLine?(0,p.bD)(A.zv):(0,p.bD)(A.l7)}try{return{headers:k.getHeaderDict(x.headers),body:yield x.json(),status:x.status}}catch{throw(0,p.bD)(A.db)}})()}getFetchHeaders(j){const $=new Headers;if(!j||!j.headers)return $;const k=j.headers;return Object.keys(k).forEach(H=>{$.append(H,k[H])}),$}getHeaderDict(j){const $={};return j.forEach((k,H)=>{$[H]=k}),$}}const b=6e4,O=1e4,L=3e4,w=2e3;function P({auth:B,cache:j,system:$,telemetry:k},H){const x={clientId:c.YM.EMPTY_STRING,authority:`${c.YM.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:c.YM.EMPTY_STRING,authorityMetadata:c.YM.EMPTY_STRING,redirectUri:c.YM.EMPTY_STRING,postLogoutRedirectUri:c.YM.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:s.e.AAD,OIDCOptions:{serverResponseType:c.zL.FRAGMENT,defaultScopes:[c.YM.OPENID_SCOPE,c.YM.PROFILE_SCOPE,c.YM.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:C._.None,tenant:c.YM.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1},z={cacheLocation:G.Al.SessionStorage,temporaryCacheLocation:G.Al.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!(!j||j.cacheLocation!==G.Al.LocalStorage),claimsBasedCachingEnabled:!1},W={loggerCallback:()=>{},logLevel:v.$.Info,piiLoggingEnabled:!1},ne={...{...y.J1,loggerOptions:W,networkClient:H?new N:h,navigationClient:new T,loadFrameTimeout:0,windowHashTimeout:$?.loadFrameTimeout||b,iframeHashTimeout:$?.loadFrameTimeout||O,navigateFrameWait:0,redirectNavigationTimeout:L,asyncPopups:!1,allowRedirectInIframe:!1,allowNativeBroker:!1,nativeBrokerHandshakeTimeout:$?.nativeBrokerHandshakeTimeout||w,pollIntervalMilliseconds:G.Q1.DEFAULT_POLL_INTERVAL_MS},...$,loggerOptions:$?.loggerOptions||W},re={application:{appName:c.YM.EMPTY_STRING,appVersion:c.YM.EMPTY_STRING},client:new S};if(B?.protocolMode!==s.e.OIDC&&B?.OIDCOptions&&new v.V(ne.loggerOptions).warning(JSON.stringify((0,U.aD)(Y.bg))),B?.protocolMode&&B.protocolMode!==s.e.AAD&&ne?.allowNativeBroker)throw(0,U.aD)(Y.J6);return{auth:{...x,...B,OIDCOptions:{...x.OIDCOptions,...B?.OIDCOptions}},cache:{...z,...j},system:ne,telemetry:{...re,...k}}}},7836:(J,F,g)=>{g.r(F),g.d(F,{StandardController:()=>lt});var c=g(467),s=g(6888),C=g(2506),v=g(6211),E=g(1564),R=g(3986),h=g(7635),f=g(2144),D=g(7806),S=g(2729),U=g(4719),T=g(4561);const X=(M,e,t,n,a)=>(...l)=>{t.trace(`Executing function ${e}`);const i=n?.startMeasurement(e,a);if(a){const r=e+"CallCount";n?.incrementFields({[r]:1},a)}try{const r=M(...l);return i?.end({success:!0}),t.trace(`Returning result from ${e}`),r}catch(r){t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(r))}catch{t.trace("Unable to print error message.")}throw i?.end({success:!1},r),r}},p=(M,e,t,n,a)=>(...l)=>{t.trace(`Executing function ${e}`);const i=n?.startMeasurement(e,a);if(a){const r=e+"CallCount";n?.incrementFields({[r]:1},a)}return n?.setPreQueueTime(e,a),M(...l).then(r=>(t.trace(`Returning result from ${e}`),i?.end({success:!0}),r)).catch(r=>{t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(r))}catch{t.trace("Unable to print error message.")}throw i?.end({success:!1},r),r})};let A=(()=>{class M{constructor(t,n,a,l){this.networkInterface=t,this.logger=n,this.performanceClient=a,this.correlationId=l}detectRegion(t,n){var a=this;return(0,c.A)(function*(){a.performanceClient?.addQueueMeasurement(T.MX.RegionDiscoveryDetectRegion,a.correlationId);let l=t;if(l)n.region_source=h.jZ.ENVIRONMENT_VARIABLE;else{const i=M.IMDS_OPTIONS;try{const r=yield p(a.getRegionFromIMDS.bind(a),T.MX.RegionDiscoveryGetRegionFromIMDS,a.logger,a.performanceClient,a.correlationId)(h.YM.IMDS_VERSION,i);if(r.status===h.Kk.httpSuccess&&(l=r.body,n.region_source=h.jZ.IMDS),r.status===h.Kk.httpBadRequest){const o=yield p(a.getCurrentVersion.bind(a),T.MX.RegionDiscoveryGetCurrentVersion,a.logger,a.performanceClient,a.correlationId)(i);if(!o)return n.region_source=h.jZ.FAILED_AUTO_DETECTION,null;const d=yield p(a.getRegionFromIMDS.bind(a),T.MX.RegionDiscoveryGetRegionFromIMDS,a.logger,a.performanceClient,a.correlationId)(o,i);d.status===h.Kk.httpSuccess&&(l=d.body,n.region_source=h.jZ.IMDS)}}catch{return n.region_source=h.jZ.FAILED_AUTO_DETECTION,null}}return l||(n.region_source=h.jZ.FAILED_AUTO_DETECTION),l||null})()}getRegionFromIMDS(t,n){var a=this;return(0,c.A)(function*(){return a.performanceClient?.addQueueMeasurement(T.MX.RegionDiscoveryGetRegionFromIMDS,a.correlationId),a.networkInterface.sendGetRequestAsync(`${h.YM.IMDS_ENDPOINT}?api-version=${t}&format=text`,n,h.YM.IMDS_TIMEOUT)})()}getCurrentVersion(t){var n=this;return(0,c.A)(function*(){n.performanceClient?.addQueueMeasurement(T.MX.RegionDiscoveryGetCurrentVersion,n.correlationId);try{const a=yield n.networkInterface.sendGetRequestAsync(`${h.YM.IMDS_ENDPOINT}?format=json`,t);return a.status===h.Kk.httpBadRequest&&a.body&&a.body["newest-versions"]&&a.body["newest-versions"].length>0?a.body["newest-versions"][0]:null}catch{return null}})()}}return M.IMDS_OPTIONS={headers:{Metadata:"true"}},M})();var N=g(3461),b=g(2376),O=g(7172),L=g(5424);class w{constructor(e,t,n,a,l,i,r,o){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=n,this.authorityOptions=a,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=l,this.performanceClient=r,this.correlationId=i,this.managedIdentity=o||!1,this.regionDiscovery=new A(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(h.YM.CIAM_AUTH_URL))return v.I.Ciam;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case h.YM.ADFS:return v.I.Adfs;case h.YM.DSTS:return v.I.Dsts}return v.I.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new E.H(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw(0,R.SB)(O.s1)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw(0,R.SB)(O.s1)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw(0,R.SB)(O.s1)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw(0,R.SB)(O.yX);return this.replacePath(this.metadata.end_session_endpoint)}throw(0,R.SB)(O.s1)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw(0,R.SB)(O.s1)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw(0,R.SB)(O.s1)}canReplaceTenant(e){return 1===e.PathSegments.length&&!w.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===v.I.Default&&this.protocolMode===S.e.AAD}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const a=new E.H(this.metadata.canonical_authority).getUrlComponents(),l=a.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((r,o)=>{let d=l[o];if(0===o&&this.canReplaceTenant(a)){const u=new E.H(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];d!==u&&(this.logger.verbose(`Replacing tenant domain name ${d} with id ${u}`),d=u)}r!==d&&(t=t.replace(`/${d}/`,`/${r}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===v.I.Adfs||this.protocolMode!==S.e.AAD&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}resolveEndpointsAsync(){var e=this;return(0,c.A)(function*(){e.performanceClient?.addQueueMeasurement(T.MX.AuthorityResolveEndpointsAsync,e.correlationId);const t=e.getCurrentMetadataEntity(),n=yield p(e.updateCloudDiscoveryMetadata.bind(e),T.MX.AuthorityUpdateCloudDiscoveryMetadata,e.logger,e.performanceClient,e.correlationId)(t);e.canonicalAuthority=e.canonicalAuthority.replace(e.hostnameAndPort,t.preferred_network);const a=yield p(e.updateEndpointMetadata.bind(e),T.MX.AuthorityUpdateEndpointMetadata,e.logger,e.performanceClient,e.correlationId)(t);e.updateCachedMetadata(t,n,{source:a}),e.performanceClient?.addFields({cloudDiscoverySource:n,authorityEndpointSource:a},e.correlationId)})()}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:(0,b.p7)(),jwks_uri:""}),e}updateCachedMetadata(e,t,n){t!==h.E_.CACHE&&n?.source!==h.E_.CACHE&&(e.expiresAt=(0,b.p7)(),e.canonical_authority=this.canonicalAuthority);const a=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(a,e),this.metadata=e}updateEndpointMetadata(e){var t=this;return(0,c.A)(function*(){t.performanceClient?.addQueueMeasurement(T.MX.AuthorityUpdateEndpointMetadata,t.correlationId);const n=t.updateEndpointMetadataFromLocalSources(e);if(n){if(n.source===h.E_.HARDCODED_VALUES&&t.authorityOptions.azureRegionConfiguration?.azureRegion&&n.metadata){const l=yield p(t.updateMetadataWithRegionalInformation.bind(t),T.MX.AuthorityUpdateMetadataWithRegionalInformation,t.logger,t.performanceClient,t.correlationId)(n.metadata);(0,b.br)(e,l,!1),e.canonical_authority=t.canonicalAuthority}return n.source}let a=yield p(t.getEndpointMetadataFromNetwork.bind(t),T.MX.AuthorityGetEndpointMetadataFromNetwork,t.logger,t.performanceClient,t.correlationId)();if(a)return t.authorityOptions.azureRegionConfiguration?.azureRegion&&(a=yield p(t.updateMetadataWithRegionalInformation.bind(t),T.MX.AuthorityUpdateMetadataWithRegionalInformation,t.logger,t.performanceClient,t.correlationId)(a)),(0,b.br)(e,a,!0),h.E_.NETWORK;throw(0,R.SB)(O.Ej,t.defaultOpenIdConfigurationEndpoint)})()}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),(0,b.br)(e,t,!1),{source:h.E_.CONFIG};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{const a=this.getEndpointMetadataFromHardcodedValues();if(a)return(0,b.br)(e,a,!1),{source:h.E_.HARDCODED_VALUES,metadata:a};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}const n=(0,b.gl)(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!n?(this.logger.verbose("Found endpoint metadata in the cache."),{source:h.E_.CACHE}):(n&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new E.H(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw(0,D.aD)(L.uk)}return null}getEndpointMetadataFromNetwork(){var e=this;return(0,c.A)(function*(){e.performanceClient?.addQueueMeasurement(T.MX.AuthorityGetEndpointMetadataFromNetwork,e.correlationId);const t={},n=e.defaultOpenIdConfigurationEndpoint;e.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${n}`);try{const a=yield e.networkInterface.sendGetRequestAsync(n,t);return function y(M){return M.hasOwnProperty("authorization_endpoint")&&M.hasOwnProperty("token_endpoint")&&M.hasOwnProperty("issuer")&&M.hasOwnProperty("jwks_uri")}(a.body)?a.body:(e.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(a){return e.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${a}`),null}})()}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in f.FI?f.FI[this.hostnameAndPort]:null}updateMetadataWithRegionalInformation(e){var t=this;return(0,c.A)(function*(){t.performanceClient?.addQueueMeasurement(T.MX.AuthorityUpdateMetadataWithRegionalInformation,t.correlationId);const n=t.authorityOptions.azureRegionConfiguration?.azureRegion;if(n){if(n!==h.YM.AZURE_REGION_AUTO_DISCOVER_FLAG)return t.regionDiscoveryMetadata.region_outcome=h._2.CONFIGURED_NO_AUTO_DETECTION,t.regionDiscoveryMetadata.region_used=n,w.replaceWithRegionalInformation(e,n);const a=yield p(t.regionDiscovery.detectRegion.bind(t.regionDiscovery),T.MX.RegionDiscoveryDetectRegion,t.logger,t.performanceClient,t.correlationId)(t.authorityOptions.azureRegionConfiguration?.environmentRegion,t.regionDiscoveryMetadata);if(a)return t.regionDiscoveryMetadata.region_outcome=h._2.AUTO_DETECTION_REQUESTED_SUCCESSFUL,t.regionDiscoveryMetadata.region_used=a,w.replaceWithRegionalInformation(e,a);t.regionDiscoveryMetadata.region_outcome=h._2.AUTO_DETECTION_REQUESTED_FAILED}return e})()}updateCloudDiscoveryMetadata(e){var t=this;return(0,c.A)(function*(){t.performanceClient?.addQueueMeasurement(T.MX.AuthorityUpdateCloudDiscoveryMetadata,t.correlationId);const n=t.updateCloudDiscoveryMetadataFromLocalSources(e);if(n)return n;const a=yield p(t.getCloudDiscoveryMetadataFromNetwork.bind(t),T.MX.AuthorityGetCloudDiscoveryMetadataFromNetwork,t.logger,t.performanceClient,t.correlationId)();if(a)return(0,b.Ir)(e,a,!0),h.E_.NETWORK;throw(0,D.aD)(L.E0)})()}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||h.YM.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||h.YM.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||h.YM.NOT_APPLICABLE}`);const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),(0,b.Ir)(e,t,!1),h.E_.CONFIG;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{const a=(0,f.hD)(this.hostnameAndPort);if(a)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),(0,b.Ir)(e,a,!1),h.E_.HARDCODED_VALUES;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}const n=(0,b.gl)(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!n?(this.logger.verbose("Found cloud discovery metadata in the cache."),h.E_.CACHE):(n&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===v.I.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),w.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");const e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=(0,f.ao)(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),(0,D.aD)(L.a_)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),w.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}getCloudDiscoveryMetadataFromNetwork(){var e=this;return(0,c.A)(function*(){e.performanceClient?.addQueueMeasurement(T.MX.AuthorityGetCloudDiscoveryMetadataFromNetwork,e.correlationId);const t=`${h.YM.AAD_INSTANCE_DISCOVERY_ENDPT}${e.canonicalAuthority}oauth2/v2.0/authorize`,n={};let a=null;try{const l=yield e.networkInterface.sendGetRequestAsync(t,n);let i,r;if(function Y(M){return M.hasOwnProperty("tenant_discovery_endpoint")&&M.hasOwnProperty("metadata")}(l.body))i=l.body,r=i.metadata,e.logger.verbosePii(`tenant_discovery_endpoint is: ${i.tenant_discovery_endpoint}`);else{if(!function G(M){return M.hasOwnProperty("error")&&M.hasOwnProperty("error_description")}(l.body))return e.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;if(e.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${l.status}`),i=l.body,i.error===h.YM.INVALID_INSTANCE)return e.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;e.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${i.error}`),e.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${i.error_description}`),e.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),r=[]}e.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),a=(0,f.ao)(r,e.hostnameAndPort)}catch(l){return e.logger.error(l instanceof N.lR?`There was a network error while attempting to get the cloud discovery instance metadata.\nError: ${l.errorCode}\nError Description: ${l.errorMessage}`:`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.\nError: ${l.name}\nError Description: ${l.message}`),null}return a||(e.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),e.logger.verbose("Creating custom Authority for custom domain scenario."),a=w.createCloudDiscoveryMetadataFromHost(e.hostnameAndPort)),a})()}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>t&&E.H.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let n;return t&&t.azureCloudInstance!==U._.None&&(n=`${t.azureCloudInstance}/${t.tenant?t.tenant:h.YM.DEFAULT_COMMON_TENANT}/`),n||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return h.YM.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw(0,R.SB)(O.s1)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return f.Jr.has(e)}static isPublicCloudAuthority(e){return h.YM.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,n){const a=new E.H(e);a.validateAsUri();const l=a.getUrlComponents();let i=`${t}.${l.HostNameAndPort}`;this.isPublicCloudAuthority(l.HostNameAndPort)&&(i=`${t}.${h.YM.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);const r=E.H.constructAuthorityUriFromObject({...a.getUrlComponents(),HostNameAndPort:i}).urlString;return n?`${r}?${n}`:r}static replaceWithRegionalInformation(e,t){const n={...e};return n.authorization_endpoint=w.buildRegionalAuthorityString(n.authorization_endpoint,t),n.token_endpoint=w.buildRegionalAuthorityString(n.token_endpoint,t),n.end_session_endpoint&&(n.end_session_endpoint=w.buildRegionalAuthorityString(n.end_session_endpoint,t)),n}static transformCIAMAuthority(e){let t=e;const a=new E.H(e).getUrlComponents();return 0===a.PathSegments.length&&a.HostNameAndPort.endsWith(h.YM.CIAM_AUTH_URL)&&(t=`${t}${a.HostNameAndPort.split(".")[0]}${h.YM.AAD_TENANT_DOMAIN_SUFFIX}`),t}}function B(M){return M.endsWith(h.YM.FORWARD_SLASH)?M:`${M}${h.YM.FORWARD_SLASH}`}w.reservedTenantDomains=new Set(["{tenant}","{tenantid}",h.v2.COMMON,h.v2.CONSUMERS,h.v2.ORGANIZATIONS]);var $=g(194),k=g(1175),H=g(6564),x=g(8864),z=g(2030);class W{static setRequestState(e,t,n){const a=W.generateLibraryState(e,n);return t?`${a}${h.YM.RESOURCE_DELIM}${t}`:a}static generateLibraryState(e,t){if(!e)throw(0,R.SB)(O.oL);const n={id:e.createNewGuid()};t&&(n.meta=t);const a=JSON.stringify(n);return e.base64Encode(a)}static parseRequestState(e,t){if(!e)throw(0,R.SB)(O.oL);if(!t)throw(0,R.SB)(O.f$);try{const n=t.split(h.YM.RESOURCE_DELIM),a=n[0],l=n.length>1?n.slice(1).join(h.YM.RESOURCE_DELIM):h.YM.EMPTY_STRING,i=e.base64Decode(a),r=JSON.parse(i);return{userRequestState:l||h.YM.EMPTY_STRING,libraryState:r}}catch{throw(0,R.SB)(O.f$)}}}var ne=g(2895);class re{constructor(e,t,n,a,l){this.account=e||null,this.idToken=t||null,this.accessToken=n||null,this.refreshToken=a||null,this.appMetadata=l||null}}var de=g(6987),q=g(6810),_=g(7554),pe=g(4064),fe=g(3578);class ue{constructor(e){this.validateWindowStorage(e),this.windowStorage=window[e]}validateWindowStorage(e){if(e!==_.Al.LocalStorage&&e!==_.Al.SessionStorage||!window[e])throw(0,pe.jz)(fe.xz)}getItem(e){return this.windowStorage.getItem(e)}setItem(e,t){this.windowStorage.setItem(e,t)}removeItem(e){this.windowStorage.removeItem(e)}getKeys(){return Object.keys(this.windowStorage)}containsKey(e){return this.windowStorage.hasOwnProperty(e)}}var ge=g(8390);function ce(M,e){if(!e)return null;try{return W.parseRequestState(M,e).libraryState.meta}catch{throw(0,R.SB)(O.f$)}}var le=g(379),Fe=g(8576),V=g(6588);class xe extends x.G{constructor(e,t,n,a,l,i){super(e,n,a,l),this.COOKIE_LIFE_MULTIPLIER=864e5,this.cacheConfig=t,this.logger=a,this.internalStorage=new ge.X,this.browserStorage=this.setupBrowserStorage(this.cacheConfig.cacheLocation),this.temporaryCacheStorage=this.setupTemporaryCacheStorage(this.cacheConfig.temporaryCacheLocation,this.cacheConfig.cacheLocation),t.cacheMigrationEnabled&&(this.migrateCacheEntries(),this.createKeyMaps()),this.performanceClient=i}setupBrowserStorage(e){switch(e){case _.Al.LocalStorage:case _.Al.SessionStorage:try{return new ue(e)}catch(t){this.logger.verbose(t);break}}return this.cacheConfig.cacheLocation=_.Al.MemoryStorage,new ge.X}setupTemporaryCacheStorage(e,t){switch(t){case _.Al.LocalStorage:case _.Al.SessionStorage:try{return new ue(e||_.Al.SessionStorage)}catch(n){return this.logger.verbose(n),this.internalStorage}default:return this.internalStorage}}migrateCacheEntries(){const t=`${h.YM.CACHE_PREFIX}.${h.Gd.CLIENT_INFO}`,n=`${h.YM.CACHE_PREFIX}.${h.Gd.ERROR}`,a=`${h.YM.CACHE_PREFIX}.${h.Gd.ERROR_DESC}`,d=[this.browserStorage.getItem(`${h.YM.CACHE_PREFIX}.${h.Gd.ID_TOKEN}`),this.browserStorage.getItem(t),this.browserStorage.getItem(n),this.browserStorage.getItem(a)];[h.Gd.ID_TOKEN,h.Gd.CLIENT_INFO,h.Gd.ERROR,h.Gd.ERROR_DESC].forEach((m,I)=>{const K=d[I];K&&this.setTemporaryCache(m,K,!0)})}createKeyMaps(){this.logger.trace("BrowserCacheManager - createKeyMaps called.");const e=this.getItem(_.dh.ACCOUNT_KEYS),t=this.getItem(`${_.dh.TOKEN_KEYS}.${this.clientId}`);e&&t?this.logger.verbose("BrowserCacheManager:createKeyMaps - account and token key maps already exist, skipping migration."):this.browserStorage.getKeys().forEach(a=>{if(this.isCredentialKey(a)){const l=this.getItem(a);if(l){const i=this.validateAndParseJson(l);if(i&&i.hasOwnProperty("credentialType"))switch(i.credentialType){case h.aG.ID_TOKEN:if(b.Kx(i)){this.logger.trace("BrowserCacheManager:createKeyMaps - idToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - idToken with key: ${a} found, saving key to token key map`);const o=this.updateCredentialCacheKey(a,i);return void this.addTokenKey(o,h.aG.ID_TOKEN)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching idToken schema with value containing idToken credentialType field but value failed IdTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed idToken validation on key: ${a}`);break;case h.aG.ACCESS_TOKEN:case h.aG.ACCESS_TOKEN_WITH_AUTH_SCHEME:if(b.dj(i)){this.logger.trace("BrowserCacheManager:createKeyMaps - accessToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - accessToken with key: ${a} found, saving key to token key map`);const o=this.updateCredentialCacheKey(a,i);return void this.addTokenKey(o,h.aG.ACCESS_TOKEN)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching accessToken schema with value containing accessToken credentialType field but value failed AccessTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed accessToken validation on key: ${a}`);break;case h.aG.REFRESH_TOKEN:if(b.WB(i)){this.logger.trace("BrowserCacheManager:createKeyMaps - refreshToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - refreshToken with key: ${a} found, saving key to token key map`);const o=this.updateCredentialCacheKey(a,i);return void this.addTokenKey(o,h.aG.REFRESH_TOKEN)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching refreshToken schema with value containing refreshToken credentialType field but value failed RefreshTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed refreshToken validation on key: ${a}`)}}}if(this.isAccountKey(a)){const l=this.getItem(a);if(l){const i=this.validateAndParseJson(l);i&&k.d.isAccountEntity(i)&&(this.logger.trace("BrowserCacheManager:createKeyMaps - account found, saving key to account key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - account with key: ${a} found, saving key to account key map`),this.addAccountKeyToMap(a))}}})}validateAndParseJson(e){try{const t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch{return null}}getItem(e){return this.browserStorage.getItem(e)}setItem(e,t){this.browserStorage.setItem(e,t)}getAccount(e,t){this.logger.trace("BrowserCacheManager.getAccount called");const n=this.getCachedAccountEntity(e);return this.updateOutdatedCachedAccount(e,n,t)}getCachedAccountEntity(e){const t=this.getItem(e);if(!t)return this.removeAccountKeyFromMap(e),null;const n=this.validateAndParseJson(t);return n&&k.d.isAccountEntity(n)?x.G.toObject(new k.d,n):(this.removeAccountKeyFromMap(e),null)}setAccount(e){this.logger.trace("BrowserCacheManager.setAccount called");const t=e.generateAccountKey();this.setItem(t,JSON.stringify(e)),this.addAccountKeyToMap(t)}getAccountKeys(){this.logger.trace("BrowserCacheManager.getAccountKeys called");const e=this.getItem(_.dh.ACCOUNT_KEYS);return e?JSON.parse(e):(this.logger.verbose("BrowserCacheManager.getAccountKeys - No account keys found"),[])}addAccountKeyToMap(e){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);const t=this.getAccountKeys();-1===t.indexOf(e)?(t.push(e),this.setItem(_.dh.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added")):this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map")}removeAccountKeyFromMap(e){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);const t=this.getAccountKeys(),n=t.indexOf(e);n>-1?(t.splice(n,1),this.setItem(_.dh.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}removeAccount(e){var t=()=>super.removeAccount,n=this;return(0,c.A)(function*(){t().call(n,e),n.removeAccountKeyFromMap(e)})()}removeOutdatedAccount(e){this.removeItem(e),this.removeAccountKeyFromMap(e)}removeIdToken(e){super.removeIdToken(e),this.removeTokenKey(e,h.aG.ID_TOKEN)}removeAccessToken(e){var t=()=>super.removeAccessToken,n=this;return(0,c.A)(function*(){t().call(n,e),n.removeTokenKey(e,h.aG.ACCESS_TOKEN)})()}removeRefreshToken(e){super.removeRefreshToken(e),this.removeTokenKey(e,h.aG.REFRESH_TOKEN)}getTokenKeys(){this.logger.trace("BrowserCacheManager.getTokenKeys called");const e=this.getItem(`${_.dh.TOKEN_KEYS}.${this.clientId}`);if(e){const t=this.validateAndParseJson(e);if(t&&t.hasOwnProperty("idToken")&&t.hasOwnProperty("accessToken")&&t.hasOwnProperty("refreshToken"))return t;this.logger.error("BrowserCacheManager.getTokenKeys - Token keys found but in an unknown format. Returning empty key map.")}else this.logger.verbose("BrowserCacheManager.getTokenKeys - No token keys found");return{idToken:[],accessToken:[],refreshToken:[]}}addTokenKey(e,t){this.logger.trace("BrowserCacheManager addTokenKey called");const n=this.getTokenKeys();switch(t){case h.aG.ID_TOKEN:-1===n.idToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),n.idToken.push(e));break;case h.aG.ACCESS_TOKEN:-1===n.accessToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - accessToken added to map"),n.accessToken.push(e));break;case h.aG.REFRESH_TOKEN:-1===n.refreshToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),n.refreshToken.push(e));break;default:throw this.logger.error(`BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: ${t}`),(0,R.SB)(O.Zj)}this.setItem(`${_.dh.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(n))}removeTokenKey(e,t){this.logger.trace("BrowserCacheManager removeTokenKey called");const n=this.getTokenKeys();switch(t){case h.aG.ID_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: ${e} from map`);const a=n.idToken.indexOf(e);a>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),n.idToken.splice(a,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case h.aG.ACCESS_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: ${e} from map`);const l=n.accessToken.indexOf(e);l>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),n.accessToken.splice(l,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case h.aG.REFRESH_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: ${e} from map`);const i=n.refreshToken.indexOf(e);i>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),n.refreshToken.splice(i,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:throw this.logger.error(`BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: ${t}`),(0,R.SB)(O.Zj)}this.setItem(`${_.dh.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(n))}getIdTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,h.aG.ID_TOKEN),null;const n=this.validateAndParseJson(t);return n&&b.Kx(n)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),n):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,h.aG.ID_TOKEN),null)}setIdTokenCredential(e){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");const t=b.og(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,h.aG.ID_TOKEN)}getAccessTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,h.aG.ACCESS_TOKEN),null;const n=this.validateAndParseJson(t);return n&&b.dj(n)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),n):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,h.aG.ACCESS_TOKEN),null)}setAccessTokenCredential(e){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");const t=b.og(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,h.aG.ACCESS_TOKEN)}getRefreshTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,h.aG.REFRESH_TOKEN),null;const n=this.validateAndParseJson(t);return n&&b.WB(n)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),n):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,h.aG.REFRESH_TOKEN),null)}setRefreshTokenCredential(e){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");const t=b.og(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,h.aG.REFRESH_TOKEN)}getAppMetadata(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&b.ki(e,n)?(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),n):(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null)}setAppMetadata(e){this.logger.trace("BrowserCacheManager.setAppMetadata called");const t=b.JP(e);this.setItem(t,JSON.stringify(e))}getServerTelemetry(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&b.ur(e,n)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),n):(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null)}setServerTelemetry(e,t){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t))}getAuthorityMetadata(e){const t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&b.ey(e,n)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),n):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(t=>this.isAuthorityMetadata(t))}setWrapperMetadata(e,t){this.internalStorage.setItem(_.H3.WRAPPER_SKU,e),this.internalStorage.setItem(_.H3.WRAPPER_VER,t)}getWrapperMetadata(){return[this.internalStorage.getItem(_.H3.WRAPPER_SKU)||h.YM.EMPTY_STRING,this.internalStorage.getItem(_.H3.WRAPPER_VER)||h.YM.EMPTY_STRING]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(){const e=this.generateCacheKey(h.Gd.ACTIVE_ACCOUNT_FILTERS),t=this.getItem(e);if(!t){this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters cache schema found, looking for legacy schema");const a=this.generateCacheKey(h.Gd.ACTIVE_ACCOUNT),l=this.getItem(a);if(!l)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null;const i=this.getAccountInfoFilteredBy({localAccountId:l});return i?(this.logger.trace("BrowserCacheManager.getActiveAccount: Legacy active account cache schema found"),this.logger.trace("BrowserCacheManager.getActiveAccount: Adding active account filters cache schema"),this.setActiveAccount(i),i):null}const n=this.validateAndParseJson(t);return n?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:n.homeAccountId,localAccountId:n.localAccountId,tenantId:n.tenantId})):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e){const t=this.generateCacheKey(h.Gd.ACTIVE_ACCOUNT_FILTERS),n=this.generateCacheKey(h.Gd.ACTIVE_ACCOUNT);e?(this.logger.verbose("setActiveAccount: Active account set"),this.browserStorage.setItem(t,JSON.stringify({homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId})),this.browserStorage.setItem(n,e.localAccountId)):(this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(t),this.browserStorage.removeItem(n))}getThrottlingCache(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&b.r1(e,n)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),n):(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null)}setThrottlingCache(e,t){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t))}getTemporaryCache(e,t){const n=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){const l=this.getItemCookie(n);if(l)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),l}const a=this.temporaryCacheStorage.getItem(n);if(!a){if(this.cacheConfig.cacheLocation===_.Al.LocalStorage){const l=this.browserStorage.getItem(n);if(l)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),l}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),a}setTemporaryCache(e,t,n){const a=n?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(a,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.setItemCookie(a,t))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.clearItemCookie(e))}getKeys(){return this.browserStorage.getKeys()}clear(){var e=this;return(0,c.A)(function*(){yield e.removeAllAccounts(),e.removeAppMetadata(),e.temporaryCacheStorage.getKeys().forEach(t=>{(-1!==t.indexOf(h.YM.CACHE_PREFIX)||-1!==t.indexOf(e.clientId))&&e.removeTemporaryItem(t)}),e.browserStorage.getKeys().forEach(t=>{(-1!==t.indexOf(h.YM.CACHE_PREFIX)||-1!==t.indexOf(e.clientId))&&e.browserStorage.removeItem(t)}),e.internalStorage.clear()})()}clearTokensAndKeysWithClaims(e){var t=this;return(0,c.A)(function*(){e.addQueueMeasurement(T.MX.ClearTokensAndKeysWithClaims);const n=t.getTokenKeys(),a=[];n.accessToken.forEach(l=>{const i=t.getAccessTokenCredential(l);i?.requestedClaimsHash&&l.includes(i.requestedClaimsHash.toLowerCase())&&a.push(t.removeAccessToken(l))}),yield Promise.all(a),a.length>0&&t.logger.warning(`${a.length} access tokens with claims in the cache keys have been removed from the cache.`)})()}setItemCookie(e,t,n){let a=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=Lax;`;n&&(a+=`expires=${this.getCookieExpirationTime(n)};`),this.cacheConfig.secureCookies&&(a+="Secure;"),document.cookie=a}getItemCookie(e){const t=`${encodeURIComponent(e)}=`,n=document.cookie.split(";");for(let a=0;a<n.length;a++){let l=n[a];for(;" "===l.charAt(0);)l=l.substring(1);if(0===l.indexOf(t))return decodeURIComponent(l.substring(t.length,l.length))}return h.YM.EMPTY_STRING}clearMsalCookies(){const e=`${h.YM.CACHE_PREFIX}.${this.clientId}`;document.cookie.split(";").forEach(n=>{for(;" "===n.charAt(0);)n=n.substring(1);if(0===n.indexOf(e)){const a=n.split("=")[0];this.clearItemCookie(a)}})}clearItemCookie(e){this.setItemCookie(e,h.YM.EMPTY_STRING,-1)}getCookieExpirationTime(e){return new Date((new Date).getTime()+e*this.COOKIE_LIFE_MULTIPLIER).toUTCString()}generateCacheKey(e){return this.validateAndParseJson(e)?JSON.stringify(e):z.$.startsWith(e,h.YM.CACHE_PREFIX)||z.$.startsWith(e,h.Gd.ADAL_ID_TOKEN)?e:`${h.YM.CACHE_PREFIX}.${this.clientId}.${e}`}generateAuthorityKey(e){const{libraryState:{id:t}}=W.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${_._p.AUTHORITY}.${t}`)}generateNonceKey(e){const{libraryState:{id:t}}=W.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${_._p.NONCE_IDTOKEN}.${t}`)}generateStateKey(e){const{libraryState:{id:t}}=W.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${_._p.REQUEST_STATE}.${t}`)}getCachedAuthority(e){const t=this.generateStateKey(e),n=this.getTemporaryCache(t);if(!n)return null;const a=this.generateAuthorityKey(n);return this.getTemporaryCache(a)}updateCacheEntries(e,t,n,a,l){this.logger.trace("BrowserCacheManager.updateCacheEntries called");const i=this.generateStateKey(e);this.setTemporaryCache(i,e,!1);const r=this.generateNonceKey(e);this.setTemporaryCache(r,t,!1);const o=this.generateAuthorityKey(e);this.setTemporaryCache(o,n,!1),l?this.setTemporaryCache(_._p.CCS_CREDENTIAL,JSON.stringify({credential:l.homeAccountId,type:"home_account_id"}),!0):a&&this.setTemporaryCache(_._p.CCS_CREDENTIAL,JSON.stringify({credential:a,type:"UPN"}),!0)}resetRequestCache(e){this.logger.trace("BrowserCacheManager.resetRequestCache called"),e&&(this.temporaryCacheStorage.getKeys().forEach(t=>{-1!==t.indexOf(e)&&this.removeTemporaryItem(t)}),this.removeTemporaryItem(this.generateStateKey(e)),this.removeTemporaryItem(this.generateNonceKey(e)),this.removeTemporaryItem(this.generateAuthorityKey(e))),this.removeTemporaryItem(this.generateCacheKey(_._p.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey(_._p.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey(_._p.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey(_._p.CORRELATION_ID)),this.removeTemporaryItem(this.generateCacheKey(_._p.CCS_CREDENTIAL)),this.removeTemporaryItem(this.generateCacheKey(_._p.NATIVE_REQUEST)),this.setInteractionInProgress(!1)}cleanRequestByState(e){if(this.logger.trace("BrowserCacheManager.cleanRequestByState called"),e){const t=this.generateStateKey(e),n=this.temporaryCacheStorage.getItem(t);this.logger.infoPii(`BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: ${n}`),this.resetRequestCache(n||h.YM.EMPTY_STRING)}this.clearMsalCookies()}cleanRequestByInteractionType(e){this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.temporaryCacheStorage.getKeys().forEach(t=>{if(-1===t.indexOf(_._p.REQUEST_STATE))return;const n=this.temporaryCacheStorage.getItem(t);if(!n)return;const a=ce(this.cryptoImpl,n);a&&a.interactionType===e&&(this.logger.infoPii(`BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: ${n}`),this.resetRequestCache(n))}),this.clearMsalCookies(),this.setInteractionInProgress(!1)}cacheCodeRequest(e){this.logger.trace("BrowserCacheManager.cacheCodeRequest called");const t=(0,Fe.KA)(JSON.stringify(e));this.setTemporaryCache(_._p.REQUEST_PARAMS,t,!0)}getCachedRequest(e){this.logger.trace("BrowserCacheManager.getCachedRequest called");const t=this.getTemporaryCache(_._p.REQUEST_PARAMS,!0);if(!t)throw(0,q.bD)(V.y6);let n;try{n=JSON.parse((0,le.u)(t))}catch(a){throw this.logger.errorPii(`Attempted to parse: ${t}`),this.logger.error(`Parsing cached token request threw with error: ${a}`),(0,q.bD)(V.ot)}if(this.removeTemporaryItem(this.generateCacheKey(_._p.REQUEST_PARAMS)),!n.authority){const a=this.generateAuthorityKey(e),l=this.getTemporaryCache(a);if(!l)throw(0,q.bD)(V.Ne);n.authority=l}return n}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");const e=this.getTemporaryCache(_._p.NATIVE_REQUEST,!0);return e?this.validateAndParseJson(e)||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null):(this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null)}isInteractionInProgress(e){const t=this.getInteractionInProgress();return e?t===this.clientId:!!t}getInteractionInProgress(){return this.getTemporaryCache(`${h.YM.CACHE_PREFIX}.${_._p.INTERACTION_STATUS_KEY}`,!1)}setInteractionInProgress(e){const t=`${h.YM.CACHE_PREFIX}.${_._p.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())throw(0,q.bD)(V.b);this.setTemporaryCache(t,this.clientId,!1)}else!e&&this.getInteractionInProgress()===this.clientId&&this.removeTemporaryItem(t)}getLegacyLoginHint(){const e=this.getTemporaryCache(h.Gd.ADAL_ID_TOKEN);e&&(this.browserStorage.removeItem(h.Gd.ADAL_ID_TOKEN),this.logger.verbose("Cached ADAL id token retrieved."));const t=this.getTemporaryCache(h.Gd.ID_TOKEN,!0);t&&(this.browserStorage.removeItem(this.generateCacheKey(h.Gd.ID_TOKEN)),this.logger.verbose("Cached MSAL.js v1 id token retrieved"));const n=t||e;if(n){const a=ne.My(n,le.u);if(a.preferred_username)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 preferred_username as loginHint"),a.preferred_username;if(a.upn)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 upn as loginHint"),a.upn;this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, however, no account hint claim found. Enable preferred_username or upn id token claim to get SSO.")}return null}updateCredentialCacheKey(e,t){const n=b.og(t);if(e!==n){const a=this.getItem(e);if(a)return this.browserStorage.removeItem(e),this.setItem(n,a),this.logger.verbose(`Updated an outdated ${t.credentialType} cache key`),n;this.logger.error(`Attempted to update an outdated ${t.credentialType} cache key but no item matching the outdated key was found in storage`)}return e}hydrateCache(e,t){var n=this;return(0,c.A)(function*(){const a=b.c_(e.account?.homeAccountId,e.account?.environment,e.idToken,n.clientId,e.tenantId);let l;t.claims&&(l=yield n.cryptoImpl.hashString(t.claims));const i=b.Np(e.account?.homeAccountId,e.account.environment,e.accessToken,n.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?.getTime()||0,e.extExpiresOn?.getTime()||0,le.u,void 0,e.tokenType,void 0,t.sshKid,t.claims,l),r=new re(void 0,a,i);return n.saveCacheRecord(r)})()}saveCacheRecord(e,t,n){var a=()=>super.saveCacheRecord,l=this;return(0,c.A)(function*(){try{yield a().call(l,e,t,n)}catch(i){if(i instanceof de.xA&&l.performanceClient&&n)try{const r=l.getTokenKeys();l.performanceClient.addFields({cacheRtCount:r.refreshToken.length,cacheIdCount:r.idToken.length,cacheAtCount:r.accessToken.length},n)}catch{}throw i}})()}}var oe=g(1474),Z=g(3212),Xe=g(1036),Me=g(6708);class se{static generateThrottlingStorageKey(e){return`${h.Xw.THROTTLING_PREFIX}.${JSON.stringify(e)}`}static preProcess(e,t){const n=se.generateThrottlingStorageKey(t),a=e.getThrottlingCache(n);if(a){if(a.throttleTime<Date.now())return void e.removeItem(n);throw new Me.g(a.errorCodes?.join(" ")||h.YM.EMPTY_STRING,a.errorMessage,a.subError)}}static postProcess(e,t,n){if(se.checkResponseStatus(n)||se.checkResponseForRetryAfter(n)){const a={throttleTime:se.calculateThrottleTime(parseInt(n.headers[h.OK.RETRY_AFTER])),error:n.body.error,errorCodes:n.body.error_codes,errorMessage:n.body.error_description,subError:n.body.suberror};e.setThrottlingCache(se.generateThrottlingStorageKey(t),a)}}static checkResponseStatus(e){return 429===e.status||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return!!e.headers&&e.headers.hasOwnProperty(h.OK.RETRY_AFTER)&&(e.status<200||e.status>=300)}static calculateThrottleTime(e){const t=e<=0?0:e,n=Date.now()/1e3;return Math.floor(1e3*Math.min(n+(t||h.Xw.DEFAULT_THROTTLE_TIME_SECONDS),n+h.Xw.DEFAULT_MAX_THROTTLE_TIME_SECONDS))}static removeThrottle(e,t,n,a){const i=this.generateThrottlingStorageKey({clientId:t,authority:n.authority,scopes:n.scopes,homeAccountIdentifier:a,claims:n.claims,authenticationScheme:n.authenticationScheme,resourceRequestMethod:n.resourceRequestMethod,resourceRequestUri:n.resourceRequestUri,shrClaims:n.shrClaims,sshKid:n.sshKid});e.removeItem(i)}}var tt=g(6964);class ie{constructor(e,t){this.networkClient=e,this.cacheManager=t}sendPostRequest(e,t,n){var a=this;return(0,c.A)(function*(){let l;se.preProcess(a.cacheManager,e);try{l=yield a.networkClient.sendPostRequestAsync(t,n)}catch(i){throw i instanceof N.lR?i:(0,R.SB)(O.x6)}return se.postProcess(a.cacheManager,e,l),l})()}}var Rt=g(8173),ut=g(4481),we=g(7388),Ae=g(845);function ht(M,e,t,n,a,l,i){return nt.apply(this,arguments)}function nt(){return(nt=(0,c.A)(function*(M,e,t,n,a,l,i){i?.addQueueMeasurement(T.MX.AuthorityFactoryCreateDiscoveredInstance,l);const r=w.transformCIAMAuthority(B(M)),o=new w(r,e,t,n,a,l,i);try{return yield p(o.resolveEndpointsAsync.bind(o),T.MX.AuthorityResolveEndpointsAsync,a,i,l)(),o}catch{throw(0,R.SB)(O.s1)}})).apply(this,arguments)}class Ge{constructor(e,t){this.config=(0,tt.GF)(e),this.logger=new Rt.V(this.config.loggerOptions,ut.U,ut.r),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.networkManager=new ie(this.networkClient,this.cacheManager),this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){const t={};if(t[h.OK.CONTENT_TYPE]=h.YM.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case"home_account_id":try{const n=(0,we.Z)(e.credential);t[h.OK.CCS_HEADER]=`Oid:${n.uid}@${n.utid}`}catch(n){this.logger.verbose("Could not parse home account ID for CCS Header: "+n)}break;case"UPN":t[h.OK.CCS_HEADER]=`UPN: ${e.credential}`}return t}executePostToTokenEndpoint(e,t,n,a,l,i){var r=this;return(0,c.A)(function*(){i&&r.performanceClient?.addQueueMeasurement(i,l);const o=yield r.networkManager.sendPostRequest(a,e,{body:t,headers:n});return r.performanceClient?.addFields({refreshTokenSize:o.body.refresh_token?.length||0,httpVerToken:o.headers?.[h.OK.X_MS_HTTP_VERSION]||""},l),r.config.serverTelemetryManager&&o.status<500&&429!==o.status&&r.config.serverTelemetryManager.clearTelemetryCache(),o})()}updateAuthority(e,t){var n=this;return(0,c.A)(function*(){n.performanceClient?.addQueueMeasurement(T.MX.UpdateTokenEndpointAuthority,t);const a=`https://${e}/${n.authority.tenant}/`,l=yield ht(a,n.networkClient,n.cacheManager,n.authority.options,n.logger,t,n.performanceClient);n.authority=l})()}createTokenQueryParameters(e){const t=new Ae.W;return e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.createQueryString()}}var Oe=g(1586),me=g(6812),ye=g(6134);class Ce{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}generateCnf(e,t){var n=this;return(0,c.A)(function*(){n.performanceClient?.addQueueMeasurement(T.MX.PopTokenGenerateCnf,e.correlationId);const a=yield p(n.generateKid.bind(n),T.MX.PopTokenGenerateCnf,t,n.performanceClient,e.correlationId)(e),l=n.cryptoUtils.base64Encode(JSON.stringify(a));return{kid:a.kid,reqCnfString:l,reqCnfHash:yield n.cryptoUtils.hashString(l)}})()}generateKid(e){var t=this;return(0,c.A)(function*(){return t.performanceClient?.addQueueMeasurement(T.MX.PopTokenGenerateKid,e.correlationId),{kid:yield t.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:"sw"}})()}signPopToken(e,t,n){var a=this;return(0,c.A)(function*(){return a.signPayload(e,t,n)})()}signPayload(e,t,n,a){var l=this;return(0,c.A)(function*(){const{resourceRequestMethod:i,resourceRequestUri:r,shrClaims:o,shrNonce:d,shrOptions:u}=n,I=(r?new E.H(r):void 0)?.getUrlComponents();return l.cryptoUtils.signJwt({at:e,ts:(0,ye._C)(),m:i?.toUpperCase(),u:I?.HostNameAndPort,nonce:d||l.cryptoUtils.createNewGuid(),p:I?.AbsolutePath,q:I?.QueryString?[[],I.QueryString]:void 0,client_claims:o||void 0,...a},t,u,n.correlationId)})()}}class wt{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}var gt=g(8266),We=g(495);class Pe{constructor(e,t,n,a,l,i,r){this.clientId=e,this.cacheStorage=t,this.cryptoObj=n,this.logger=a,this.serializableCache=l,this.persistencePlugin=i,this.performanceClient=r}validateServerAuthorizationCodeResponse(e,t){if(!e.state||!t)throw(0,R.SB)(O.tQ,e.state?"Cached State":"Server State");let n,a;try{n=decodeURIComponent(e.state)}catch{throw(0,R.SB)(O.f$,e.state)}try{a=decodeURIComponent(t)}catch{throw(0,R.SB)(O.f$,e.state)}if(n!==a)throw(0,R.SB)(O.Cl);if(e.error||e.error_description||e.suberror){const l=function pt(M){const t=M.error_uri?.lastIndexOf("code=");return t&&t>=0?M.error_uri?.substring(t+5):void 0}(e);throw(0,$.a)(e.error,e.error_description,e.suberror)?new $.CB(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",l):new Me.g(e.error||"",e.error_description,e.suberror,l)}}validateTokenResponse(e,t){if(e.error||e.error_description||e.suberror){const n=`${e.error_codes} - [${e.timestamp}]: ${e.error_description} - Correlation ID: ${e.correlation_id} - Trace ID: ${e.trace_id}`,a=e.error_codes?.length?e.error_codes[0]:void 0,l=new Me.g(e.error,n,e.suberror,a);if(t&&e.status&&e.status>=h.t3.SERVER_ERROR_RANGE_START&&e.status<=h.t3.SERVER_ERROR_RANGE_END)return void this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.\n${l}`);if(t&&e.status&&e.status>=h.t3.CLIENT_ERROR_RANGE_START&&e.status<=h.t3.CLIENT_ERROR_RANGE_END)return void this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.\n${l}`);throw(0,$.a)(e.error,e.error_description,e.suberror)?new $.CB(e.error,e.error_description,e.suberror,e.timestamp||h.YM.EMPTY_STRING,e.trace_id||h.YM.EMPTY_STRING,e.correlation_id||h.YM.EMPTY_STRING,e.claims||h.YM.EMPTY_STRING,a):l}}handleServerTokenResponse(e,t,n,a,l,i,r,o,d){var u=this;return(0,c.A)(function*(){let m,I;if(u.performanceClient?.addQueueMeasurement(T.MX.HandleServerTokenResponse,e.correlation_id),e.id_token){if(m=(0,ne.My)(e.id_token||h.YM.EMPTY_STRING,u.cryptoObj.base64Decode),l&&l.nonce&&m.nonce!==l.nonce)throw(0,R.SB)(O.aQ);if(a.maxAge||0===a.maxAge){const ee=m.auth_time;if(!ee)throw(0,R.SB)(O.n3);(0,ne.al)(ee,a.maxAge)}}u.homeAccountIdentifier=k.d.generateHomeAccountId(e.client_info||h.YM.EMPTY_STRING,t.authorityType,u.logger,u.cryptoObj,m),l&&l.state&&(I=W.parseRequestState(u.cryptoObj,l.state)),e.key_id=e.key_id||a.sshKid||void 0;const K=u.generateCacheRecord(e,t,n,a,m,i,l);let Q;try{if(u.persistencePlugin&&u.serializableCache&&(u.logger.verbose("Persistence enabled, calling beforeCacheAccess"),Q=new wt(u.serializableCache,!0),yield u.persistencePlugin.beforeCacheAccess(Q)),r&&!o&&K.account){const ee=K.account.generateAccountKey();if(!u.cacheStorage.getAccount(ee,u.logger))return u.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),yield Pe.generateAuthenticationResult(u.cryptoObj,t,K,!1,a,m,I,void 0,d)}yield u.cacheStorage.saveCacheRecord(K,a.storeInCache,a.correlationId)}finally{u.persistencePlugin&&u.serializableCache&&Q&&(u.logger.verbose("Persistence enabled, calling afterCacheAccess"),yield u.persistencePlugin.afterCacheAccess(Q))}return Pe.generateAuthenticationResult(u.cryptoObj,t,K,!1,a,m,I,e,d)})()}generateCacheRecord(e,t,n,a,l,i,r){const o=t.getPreferredCache();if(!o)throw(0,R.SB)(O.l3);const d=(0,gt.r)(l);let u,m;e.id_token&&l&&(u=(0,b.c_)(this.homeAccountIdentifier,o,e.id_token,this.clientId,d||""),m=rt(this.cacheStorage,t,this.homeAccountIdentifier,l,this.cryptoObj.base64Decode,e.client_info,o,d,r,void 0,this.logger));let I=null;if(e.access_token){const ee=e.scope?me.l.fromString(e.scope):new me.l(a.scopes||[]),ae=("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0,he=("string"==typeof e.ext_expires_in?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,be=("string"==typeof e.refresh_in?parseInt(e.refresh_in,10):e.refresh_in)||void 0,He=n+ae,dt=He+he,St=be&&be>0?n+be:void 0;I=(0,b.Np)(this.homeAccountIdentifier,o,e.access_token,this.clientId,d||t.tenant||"",ee.printScopes(),He,dt,this.cryptoObj.base64Decode,St,e.token_type,i,e.key_id,a.claims,a.requestedClaimsHash)}let K=null;if(e.refresh_token){let ee;e.refresh_token_expires_in&&(ee=n+("string"==typeof e.refresh_token_expires_in?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in)),K=(0,b.Mg)(this.homeAccountIdentifier,o,e.refresh_token,this.clientId,e.foci,i,ee)}let Q=null;return e.foci&&(Q={clientId:this.clientId,environment:o,familyId:e.foci}),new re(m,u,I,K,Q)}static generateAuthenticationResult(e,t,n,a,l,i,r,o,d){return(0,c.A)(function*(){let K,Q,u=h.YM.EMPTY_STRING,m=[],I=null,ee=h.YM.EMPTY_STRING;if(n.accessToken){if(n.accessToken.tokenType===h.IO.POP){const He=new Ce(e),{secret:dt,keyId:St}=n.accessToken;if(!St)throw(0,R.SB)(O.fo);u=yield He.signPopToken(dt,St,l)}else u=n.accessToken.secret;m=me.l.fromString(n.accessToken.target).asArray(),I=new Date(1e3*Number(n.accessToken.expiresOn)),K=new Date(1e3*Number(n.accessToken.extendedExpiresOn)),n.accessToken.refreshOn&&(Q=new Date(1e3*Number(n.accessToken.refreshOn)))}n.appMetadata&&(ee=n.appMetadata.familyId===h.hB?h.hB:"");const ae=i?.oid||i?.sub||"",he=i?.tid||"";o?.spa_accountid&&n.account&&(n.account.nativeAccountId=o?.spa_accountid);const be=n.account?(0,We.o9)(n.account.getAccountInfo(),void 0,i,n.idToken?.secret):null;return{authority:t.canonicalAuthority,uniqueId:ae,tenantId:he,scopes:m,account:be,idToken:n?.idToken?.secret||"",idTokenClaims:i||{},accessToken:u,fromCache:a,expiresOn:I,extExpiresOn:K,refreshOn:Q,correlationId:l.correlationId,requestId:d||h.YM.EMPTY_STRING,familyId:ee,tokenType:n.accessToken?.tokenType||h.YM.EMPTY_STRING,state:r?r.userRequestState:h.YM.EMPTY_STRING,cloudGraphHostName:n.account?.cloudGraphHostName||h.YM.EMPTY_STRING,msGraphHost:n.account?.msGraphHost||h.YM.EMPTY_STRING,code:o?.spa_code,fromNativeBroker:!1}})()}}function rt(M,e,t,n,a,l,i,r,o,d,u){u?.verbose("setCachedAccount called");const I=M.getAccountKeys().find(ae=>ae.startsWith(t));let K=null;I&&(K=M.getAccount(I,u));const Q=K||k.d.createAccount({homeAccountId:t,idTokenClaims:n,clientInfo:l,environment:i,cloudGraphHostName:o?.cloud_graph_host_name,msGraphHost:o?.msgraph_host,nativeAccountId:d},e,a),ee=Q.tenantProfiles||[];if(r&&!ee.find(ae=>ae.tenantId===r)){const ae=(0,We.bi)(t,n);ee.push(ae)}return Q.tenantProfiles=ee,Q}var $e=g(5503);function _e(M,e,t){return ot.apply(this,arguments)}function ot(){return(ot=(0,c.A)(function*(M,e,t){return"string"==typeof M?M:M({clientId:e,tokenEndpoint:t})})).apply(this,arguments)}class Ve extends Ge{constructor(e,t){super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=this.config.authOptions.authority.options.OIDCOptions?.defaultScopes}getAuthCodeUrl(e){var t=this;return(0,c.A)(function*(){t.performanceClient?.addQueueMeasurement(T.MX.GetAuthCodeUrl,e.correlationId);const n=yield p(t.createAuthCodeUrlQueryString.bind(t),T.MX.AuthClientCreateQueryString,t.logger,t.performanceClient,e.correlationId)(e);return E.H.appendQueryString(t.authority.authorizationEndpoint,n)})()}acquireToken(e,t){var n=this;return(0,c.A)(function*(){if(n.performanceClient?.addQueueMeasurement(T.MX.AuthClientAcquireToken,e.correlationId),!e.code)throw(0,R.SB)(O.$P);const a=(0,ye._C)(),l=yield p(n.executeTokenRequest.bind(n),T.MX.AuthClientExecuteTokenRequest,n.logger,n.performanceClient,e.correlationId)(n.authority,e),i=l.headers?.[h.OK.X_MS_REQUEST_ID],r=new Pe(n.config.authOptions.clientId,n.cacheManager,n.cryptoUtils,n.logger,n.config.serializableCache,n.config.persistencePlugin,n.performanceClient);return r.validateTokenResponse(l.body),p(r.handleServerTokenResponse.bind(r),T.MX.HandleServerTokenResponse,n.logger,n.performanceClient,e.correlationId)(l.body,n.authority,a,e,t,void 0,void 0,void 0,i)})()}handleFragmentResponse(e,t){if(new Pe(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,null,null).validateServerAuthorizationCodeResponse(e,t),!e.code)throw(0,R.SB)(O.Re);return e}getLogoutUri(e){if(!e)throw(0,D.aD)(L.pi);const t=this.createLogoutUrlQueryString(e);return E.H.appendQueryString(this.authority.endSessionEndpoint,t)}executeTokenRequest(e,t){var n=this;return(0,c.A)(function*(){n.performanceClient?.addQueueMeasurement(T.MX.AuthClientExecuteTokenRequest,t.correlationId);const a=n.createTokenQueryParameters(t),l=E.H.appendQueryString(e.tokenEndpoint,a),i=yield p(n.createTokenRequestBody.bind(n),T.MX.AuthClientCreateTokenRequestBody,n.logger,n.performanceClient,t.correlationId)(t);let r;if(t.clientInfo)try{const u=(0,we.k)(t.clientInfo,n.cryptoUtils.base64Decode);r={credential:`${u.uid}${h.LR.CLIENT_INFO_SEPARATOR}${u.utid}`,type:"home_account_id"}}catch(u){n.logger.verbose("Could not parse client info for CCS Header: "+u)}const o=n.createTokenRequestHeaders(r||t.ccsCredential),d={clientId:t.tokenBodyParameters?.clientId||n.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid};return p(n.executePostToTokenEndpoint.bind(n),T.MX.AuthorizationCodeClientExecutePostToTokenEndpoint,n.logger,n.performanceClient,t.correlationId)(l,i,o,d,t.correlationId,T.MX.AuthorizationCodeClientExecutePostToTokenEndpoint)})()}createTokenRequestBody(e){var t=this;return(0,c.A)(function*(){t.performanceClient?.addQueueMeasurement(T.MX.AuthClientCreateTokenRequestBody,e.correlationId);const n=new Ae.W;if(n.addClientId(e.tokenBodyParameters?.[Oe.U6]||t.config.authOptions.clientId),t.includeRedirectUri?n.addRedirectUri(e.redirectUri):$e.M.validateRedirectUri(e.redirectUri),n.addScopes(e.scopes,!0,t.oidcDefaultScopes),n.addAuthorizationCode(e.code),n.addLibraryInfo(t.config.libraryInfo),n.addApplicationTelemetry(t.config.telemetry.application),n.addThrottling(),t.serverTelemetryManager&&!(0,tt.hf)(t.config)&&n.addServerTelemetry(t.serverTelemetryManager),e.codeVerifier&&n.addCodeVerifier(e.codeVerifier),t.config.clientCredentials.clientSecret&&n.addClientSecret(t.config.clientCredentials.clientSecret),t.config.clientCredentials.clientAssertion){const i=t.config.clientCredentials.clientAssertion;n.addClientAssertion(yield _e(i.assertion,t.config.authOptions.clientId,e.resourceRequestUri)),n.addClientAssertionType(i.assertionType)}if(n.addGrantType(h.$x.AUTHORIZATION_CODE_GRANT),n.addClientInfo(),e.authenticationScheme===h.IO.POP){const i=new Ce(t.cryptoUtils,t.performanceClient),r=yield p(i.generateCnf.bind(i),T.MX.PopTokenGenerateCnf,t.logger,t.performanceClient,e.correlationId)(e,t.logger);n.addPopToken(r.reqCnfString)}else if(e.authenticationScheme===h.IO.SSH){if(!e.sshJwk)throw(0,D.aD)(L.LX);n.addSshJwk(e.sshJwk)}const a=e.correlationId||t.config.cryptoInterface.createNewGuid();let l;if(n.addCorrelationId(a),(!z.$.isEmptyObj(e.claims)||t.config.authOptions.clientCapabilities&&t.config.authOptions.clientCapabilities.length>0)&&n.addClaims(e.claims,t.config.authOptions.clientCapabilities),e.clientInfo)try{const i=(0,we.k)(e.clientInfo,t.cryptoUtils.base64Decode);l={credential:`${i.uid}${h.LR.CLIENT_INFO_SEPARATOR}${i.utid}`,type:"home_account_id"}}catch(i){t.logger.verbose("Could not parse client info for CCS Header: "+i)}else l=e.ccsCredential;if(t.config.systemOptions.preventCorsPreflight&&l)switch(l.type){case"home_account_id":try{const i=(0,we.Z)(l.credential);n.addCcsOid(i)}catch(i){t.logger.verbose("Could not parse home account ID for CCS Header: "+i)}break;case"UPN":n.addCcsUpn(l.credential)}return e.tokenBodyParameters&&n.addExtraQueryParameters(e.tokenBodyParameters),e.enableSpaAuthorizationCode&&(!e.tokenBodyParameters||!e.tokenBodyParameters[Oe.ir])&&n.addExtraQueryParameters({[Oe.ir]:"1"}),n.createQueryString()})()}createAuthCodeUrlQueryString(e){var t=this;return(0,c.A)(function*(){t.performanceClient?.addQueueMeasurement(T.MX.AuthClientCreateQueryString,e.correlationId);const n=new Ae.W;n.addClientId(e.extraQueryParameters?.[Oe.U6]||t.config.authOptions.clientId);const a=[...e.scopes||[],...e.extraScopesToConsent||[]];n.addScopes(a,!0,t.oidcDefaultScopes),n.addRedirectUri(e.redirectUri);const l=e.correlationId||t.config.cryptoInterface.createNewGuid();if(n.addCorrelationId(l),n.addResponseMode(e.responseMode),n.addResponseTypeCode(),n.addLibraryInfo(t.config.libraryInfo),(0,tt.hf)(t.config)||n.addApplicationTelemetry(t.config.telemetry.application),n.addClientInfo(),e.codeChallenge&&e.codeChallengeMethod&&n.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.prompt&&n.addPrompt(e.prompt),e.domainHint&&n.addDomainHint(e.domainHint),e.prompt!==h._M.SELECT_ACCOUNT)if(e.sid&&e.prompt===h._M.NONE)t.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),n.addSid(e.sid);else if(e.account){const i=t.extractAccountSid(e.account);let r=t.extractLoginHint(e.account);if(r&&e.domainHint&&(t.logger.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),r=null),r){t.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),n.addLoginHint(r);try{const o=(0,we.Z)(e.account.homeAccountId);n.addCcsOid(o)}catch{t.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(i&&e.prompt===h._M.NONE){t.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),n.addSid(i);try{const o=(0,we.Z)(e.account.homeAccountId);n.addCcsOid(o)}catch{t.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)t.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),n.addLoginHint(e.loginHint),n.addCcsUpn(e.loginHint);else if(e.account.username){t.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),n.addLoginHint(e.account.username);try{const o=(0,we.Z)(e.account.homeAccountId);n.addCcsOid(o)}catch{t.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(t.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),n.addLoginHint(e.loginHint),n.addCcsUpn(e.loginHint));else t.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");if(e.nonce&&n.addNonce(e.nonce),e.state&&n.addState(e.state),(e.claims||t.config.authOptions.clientCapabilities&&t.config.authOptions.clientCapabilities.length>0)&&n.addClaims(e.claims,t.config.authOptions.clientCapabilities),e.extraQueryParameters&&n.addExtraQueryParameters(e.extraQueryParameters),e.nativeBroker&&(n.addNativeBroker(),e.authenticationScheme===h.IO.POP)){const i=new Ce(t.cryptoUtils),r=yield p(i.generateCnf.bind(i),T.MX.PopTokenGenerateCnf,t.logger,t.performanceClient,e.correlationId)(e,t.logger);n.addPopToken(r.reqCnfHash)}return n.createQueryString()})()}createLogoutUrlQueryString(e){const t=new Ae.W;return e.postLogoutRedirectUri&&t.addPostLogoutRedirectUri(e.postLogoutRedirectUri),e.correlationId&&t.addCorrelationId(e.correlationId),e.idTokenHint&&t.addIdTokenHint(e.idTokenHint),e.state&&t.addState(e.state),e.logoutHint&&t.addLogoutHint(e.logoutHint),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters),t.createQueryString()}extractAccountSid(e){return e.idTokenClaims?.sid||null}extractLoginHint(e){return e.idTokenClaims?.login_hint||null}}class Qe{constructor(e,t){this.cacheOutcome=h.Rv.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||h.YM.EMPTY_STRING,this.wrapperVer=e.wrapperVer||h.YM.EMPTY_STRING,this.telemetryCacheKey=h.gT.CACHE_KEY+h.LR.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){const e=`${this.apiId}${h.gT.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer].join(h.gT.VALUE_SEPARATOR),a=[e,this.getRegionDiscoveryFields()].join(h.gT.VALUE_SEPARATOR);return[h.gT.SCHEMA_VERSION,a,t].join(h.gT.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=Qe.maxErrorsToSend(e),n=e.failedRequests.slice(0,2*t).join(h.gT.VALUE_SEPARATOR),a=e.errors.slice(0,t).join(h.gT.VALUE_SEPARATOR),l=e.errors.length,r=[l,t<l?h.gT.OVERFLOW_TRUE:h.gT.OVERFLOW_FALSE].join(h.gT.VALUE_SEPARATOR);return[h.gT.SCHEMA_VERSION,e.cacheHits,n,a,r].join(h.gT.CATEGORY_SEPARATOR)}cacheFailedRequest(e){const t=this.getLastRequests();t.errors.length>=h.gT.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?t.errors.push(e instanceof N.lR?e.subError?e.subError:e.errorCode?e.errorCode:e.toString():e.toString()):t.errors.push(h.gT.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e),e.cacheHits}getLastRequests(){return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||{failedRequests:[],errors:[],cacheHits:0}}clearTelemetryCache(){const e=this.getLastRequests(),t=Qe.maxErrorsToSend(e);if(t===e.errors.length)this.cacheManager.removeItem(this.telemetryCacheKey);else{const a={failedRequests:e.failedRequests.slice(2*t),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,a)}}static maxErrorsToSend(e){let t,n=0,a=0;const l=e.errors.length;for(t=0;t<l;t++){const r=e.failedRequests[2*t+1]||h.YM.EMPTY_STRING,o=e.errors[t]||h.YM.EMPTY_STRING;if(a+=(e.failedRequests[2*t]||h.YM.EMPTY_STRING).toString().length+r.toString().length+o.length+3,!(a<h.gT.MAX_LAST_HEADER_BYTES))break;n+=1}return n}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||h.YM.EMPTY_STRING),e.push(this.regionSource||h.YM.EMPTY_STRING),e.push(this.regionOutcome||h.YM.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}}var je=g(7306),ve=g(1510);class ft{constructor(e,t,n,a,l,i,r,o,d){this.config=e,this.browserStorage=t,this.browserCrypto=n,this.networkClient=this.config.system.networkClient,this.eventHandler=l,this.navigationClient=i,this.nativeMessageHandler=o,this.correlationId=d||(0,ve.Oy)(),this.logger=a.clone(_.Q1.MSAL_SKU,je.r,this.correlationId),this.performanceClient=r}clearCacheOnLogout(e){var t=this;return(0,c.A)(function*(){if(e){k.d.accountInfoIsEqual(e,t.browserStorage.getActiveAccount(),!1)&&(t.logger.verbose("Setting active account to null"),t.browserStorage.setActiveAccount(null));try{yield t.browserStorage.removeAccount(k.d.generateAccountCacheKey(e)),t.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch{t.logger.error("Account provided in logout request was not found. Local cache unchanged.")}}else try{t.logger.verbose("No account provided in logout request, clearing all cache items.",t.correlationId),yield t.browserStorage.clear(),yield t.browserCrypto.clearKeystore()}catch{t.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}})()}getRedirectUri(e){this.logger.verbose("getRedirectUri called");const t=e||this.config.auth.redirectUri||(0,oe.Uu)();return E.H.getAbsoluteUrl(t,(0,oe.Uu)())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");const n={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new Qe(n,this.browserStorage)}getDiscoveredAuthority(e,t,n){var a=this;return(0,c.A)(function*(){a.performanceClient.addQueueMeasurement(T.MX.StandardInteractionClientGetDiscoveredAuthority,a.correlationId);const l={protocolMode:a.config.auth.protocolMode,OIDCOptions:a.config.auth.OIDCOptions,knownAuthorities:a.config.auth.knownAuthorities,cloudDiscoveryMetadata:a.config.auth.cloudDiscoveryMetadata,authorityMetadata:a.config.auth.authorityMetadata,skipAuthorityMetadataCache:a.config.auth.skipAuthorityMetadataCache},r=w.generateAuthority(e||a.config.auth.authority,t||a.config.auth.azureCloudOptions),o=yield p(ht,T.MX.AuthorityFactoryCreateDiscoveredInstance,a.logger,a.performanceClient,a.correlationId)(r,a.config.system.networkClient,a.browserStorage,l,a.logger,a.correlationId,a.performanceClient);if(n&&!o.isAlias(n.environment))throw(0,D.aD)(L.K3);return o})()}}const Ot=32;function kt(M,e,t){return mt.apply(this,arguments)}function mt(){return(mt=(0,c.A)(function*(M,e,t){M.addQueueMeasurement(T.MX.GeneratePkceCodes,t);const n=X(bt,T.MX.GenerateCodeVerifier,e,M,t)(M,e,t);return{verifier:n,challenge:yield p(Wt,T.MX.GenerateCodeChallengeFromVerifier,e,M,t)(n,M,e,t)}})).apply(this,arguments)}function bt(M,e,t){try{const n=new Uint8Array(Ot);return X(ve.UY,T.MX.GetRandomValues,e,M,t)(n),(0,Fe.dB)(n)}catch{throw(0,q.bD)(V.p5)}}function Wt(M,e,t,n){return Ct.apply(this,arguments)}function Ct(){return(Ct=(0,c.A)(function*(M,e,t,n){e.addQueueMeasurement(T.MX.GenerateCodeChallengeFromVerifier,n);try{const a=yield p(ve.sI,T.MX.Sha256Digest,t,e,n)(M,e,n);return(0,Fe.dB)(new Uint8Array(a))}catch{throw(0,q.bD)(V.p5)}})).apply(this,arguments)}function At(M,e,t,n){return Et.apply(this,arguments)}function Et(){return(Et=(0,c.A)(function*(M,e,t,n){t.addQueueMeasurement(T.MX.InitializeBaseRequest,M.correlationId);const a=M.authority||e.auth.authority,l=[...M&&M.scopes||[]],i={...M,correlationId:M.correlationId,authority:a,scopes:l};if(i.authenticationScheme){if(i.authenticationScheme===h.IO.SSH){if(!M.sshJwk)throw(0,D.aD)(L.LX);if(!M.sshKid)throw(0,D.aD)(L.rB)}n.verbose(`Authentication Scheme set to "${i.authenticationScheme}" as configured in Auth request`)}else i.authenticationScheme=h.IO.BEARER,n.verbose('Authentication Scheme wasn\'t explicitly set in request, defaulting to "Bearer" request');return e.cache.claimsBasedCachingEnabled&&M.claims&&!z.$.isEmptyObj(M.claims)&&(i.requestedClaimsHash=yield(0,ve.YZ)(M.claims)),i})).apply(this,arguments)}function Ie(M,e,t,n,a){return Je.apply(this,arguments)}function Je(){return(Je=(0,c.A)(function*(M,e,t,n,a){n.addQueueMeasurement(T.MX.InitializeSilentRequest,M.correlationId);const l=yield p(At,T.MX.InitializeBaseRequest,a,n,M.correlationId)(M,t,n,a);return{...M,...l,account:e,forceRefresh:M.forceRefresh||!1}})).apply(this,arguments)}class ke extends ft{initializeAuthorizationCodeRequest(e){var t=this;return(0,c.A)(function*(){t.performanceClient.addQueueMeasurement(T.MX.StandardInteractionClientInitializeAuthorizationCodeRequest,t.correlationId);const n=yield p(kt,T.MX.GeneratePkceCodes,t.logger,t.performanceClient,t.correlationId)(t.performanceClient,t.logger,t.correlationId),a={...e,redirectUri:e.redirectUri,code:h.YM.EMPTY_STRING,codeVerifier:n.verifier};return e.codeChallenge=n.challenge,e.codeChallengeMethod=h.YM.S256_CODE_CHALLENGE_METHOD,a})()}initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e?.correlationId);const t={correlationId:this.correlationId||(0,ve.Oy)(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){const n=this.getLogoutHintFromIdTokenClaims(e.account);n&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=n)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return e&&null===e.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId):e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=E.H.getAbsoluteUrl(e.postLogoutRedirectUri,(0,oe.Uu)())):null===this.config.auth.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=E.H.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,(0,oe.Uu)())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=E.H.getAbsoluteUrl((0,oe.Uu)(),(0,oe.Uu)())),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}createAuthCodeClient(e,t,n,a){var l=this;return(0,c.A)(function*(){l.performanceClient.addQueueMeasurement(T.MX.StandardInteractionClientCreateAuthCodeClient,l.correlationId);const i=yield p(l.getClientConfiguration.bind(l),T.MX.StandardInteractionClientGetClientConfiguration,l.logger,l.performanceClient,l.correlationId)(e,t,n,a);return new Ve(i,l.performanceClient)})()}getClientConfiguration(e,t,n,a){var l=this;return(0,c.A)(function*(){l.performanceClient.addQueueMeasurement(T.MX.StandardInteractionClientGetClientConfiguration,l.correlationId);const i=yield p(l.getDiscoveredAuthority.bind(l),T.MX.StandardInteractionClientGetDiscoveredAuthority,l.logger,l.performanceClient,l.correlationId)(t,n,a),r=l.config.system.loggerOptions;return{authOptions:{clientId:l.config.auth.clientId,authority:i,clientCapabilities:l.config.auth.clientCapabilities},systemOptions:{tokenRenewalOffsetSeconds:l.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:r.loggerCallback,piiLoggingEnabled:r.piiLoggingEnabled,logLevel:r.logLevel,correlationId:l.correlationId},cacheOptions:{claimsBasedCachingEnabled:l.config.cache.claimsBasedCachingEnabled},cryptoInterface:l.browserCrypto,networkInterface:l.networkClient,storageInterface:l.browserStorage,serverTelemetryManager:e,libraryInfo:{sku:_.Q1.MSAL_SKU,version:je.r,cpu:h.YM.EMPTY_STRING,os:h.YM.EMPTY_STRING},telemetry:l.config.telemetry}})()}initializeAuthorizationRequest(e,t){var n=this;return(0,c.A)(function*(){n.performanceClient.addQueueMeasurement(T.MX.StandardInteractionClientInitializeAuthorizationRequest,n.correlationId);const a=n.getRedirectUri(e.redirectUri),i=W.setRequestState(n.browserCrypto,e&&e.state||h.YM.EMPTY_STRING,{interactionType:t}),o={...yield p(At,T.MX.InitializeBaseRequest,n.logger,n.performanceClient,n.correlationId)({...e,correlationId:n.correlationId},n.config,n.performanceClient,n.logger),redirectUri:a,state:i,nonce:e.nonce||(0,ve.Oy)(),responseMode:n.config.auth.OIDCOptions.serverResponseType},d=e.account||n.browserStorage.getActiveAccount();if(d&&(n.logger.verbose("Setting validated request account",n.correlationId),n.logger.verbosePii(`Setting validated request account: ${d.homeAccountId}`,n.correlationId),o.account=d),!o.loginHint&&!d){const u=n.browserStorage.getLegacyLoginHint();u&&(o.loginHint=u)}return o})()}}var Ze=g(6213);const Pt="user_switch",Tt={[Pt]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class Se extends N.lR{constructor(e,t,n){super(e,t),Object.setPrototypeOf(this,Se.prototype),this.name="NativeAuthError",this.ext=n}}function Ue(M){return!!(M.ext&&M.ext.status&&("PERSISTENT_ERROR"===M.ext.status||"DISABLED"===M.ext.status)||M.ext&&M.ext.error&&-2147186943===M.ext.error)||"ContentError"===M.errorCode}function ze(M,e,t){if(t&&t.status)switch(t.status){case"ACCOUNT_UNAVAILABLE":return(0,$.IE)(H.B);case"USER_INTERACTION_REQUIRED":return new $.CB(M,e);case"USER_CANCEL":return(0,q.bD)(V.fN);case"NO_NETWORK":return(0,q.bD)(V.l7)}return new Se(M,Tt[M]||e,t)}class Le extends Ge{constructor(e,t){super(e,t)}acquireToken(e){var t=this;return(0,c.A)(function*(){t.performanceClient?.addQueueMeasurement(T.MX.RefreshTokenClientAcquireToken,e.correlationId);const n=(0,ye._C)(),a=yield p(t.executeTokenRequest.bind(t),T.MX.RefreshTokenClientExecuteTokenRequest,t.logger,t.performanceClient,e.correlationId)(e,t.authority),l=a.headers?.[h.OK.X_MS_REQUEST_ID],i=new Pe(t.config.authOptions.clientId,t.cacheManager,t.cryptoUtils,t.logger,t.config.serializableCache,t.config.persistencePlugin);return i.validateTokenResponse(a.body),p(i.handleServerTokenResponse.bind(i),T.MX.HandleServerTokenResponse,t.logger,t.performanceClient,e.correlationId)(a.body,t.authority,n,e,void 0,void 0,!0,e.forceCache,l)})()}acquireTokenByRefreshToken(e){var t=this;return(0,c.A)(function*(){if(!e)throw(0,D.aD)(L.Ub);if(t.performanceClient?.addQueueMeasurement(T.MX.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw(0,R.SB)(O.C2);if(t.cacheManager.isAppMetadataFOCI(e.account.environment))try{return yield p(t.acquireTokenWithCachedRefreshToken.bind(t),T.MX.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.logger,t.performanceClient,e.correlationId)(e,!0)}catch(a){if(a instanceof $.CB&&a.errorCode===H.oF||a instanceof Me.g&&a.errorCode===h.I.INVALID_GRANT_ERROR&&a.subError===h.I.CLIENT_MISMATCH_ERROR)return p(t.acquireTokenWithCachedRefreshToken.bind(t),T.MX.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.logger,t.performanceClient,e.correlationId)(e,!1);throw a}return p(t.acquireTokenWithCachedRefreshToken.bind(t),T.MX.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.logger,t.performanceClient,e.correlationId)(e,!1)})()}acquireTokenWithCachedRefreshToken(e,t){var n=this;return(0,c.A)(function*(){n.performanceClient?.addQueueMeasurement(T.MX.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);const a=X(n.cacheManager.getRefreshToken.bind(n.cacheManager),T.MX.CacheManagerGetRefreshToken,n.logger,n.performanceClient,e.correlationId)(e.account,t,void 0,n.performanceClient,e.correlationId);if(!a)throw(0,$.IE)(H.oF);if(a.expiresOn&&(0,ye.Hm)(a.expiresOn,e.refreshTokenExpirationOffsetSeconds||300))throw(0,$.IE)(H.AG);const l={...e,refreshToken:a.secret,authenticationScheme:e.authenticationScheme||h.IO.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:"home_account_id"}};try{return yield p(n.acquireToken.bind(n),T.MX.RefreshTokenClientAcquireToken,n.logger,n.performanceClient,e.correlationId)(l)}catch(i){if(i instanceof $.CB&&i.subError===H.j9){n.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");const r=(0,b.og)(a);n.cacheManager.removeRefreshToken(r)}throw i}})()}executeTokenRequest(e,t){var n=this;return(0,c.A)(function*(){n.performanceClient?.addQueueMeasurement(T.MX.RefreshTokenClientExecuteTokenRequest,e.correlationId);const a=n.createTokenQueryParameters(e),l=E.H.appendQueryString(t.tokenEndpoint,a),i=yield p(n.createTokenRequestBody.bind(n),T.MX.RefreshTokenClientCreateTokenRequestBody,n.logger,n.performanceClient,e.correlationId)(e),r=n.createTokenRequestHeaders(e.ccsCredential),o={clientId:e.tokenBodyParameters?.clientId||n.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid};return p(n.executePostToTokenEndpoint.bind(n),T.MX.RefreshTokenClientExecutePostToTokenEndpoint,n.logger,n.performanceClient,e.correlationId)(l,i,r,o,e.correlationId,T.MX.RefreshTokenClientExecutePostToTokenEndpoint)})()}createTokenRequestBody(e){var t=this;return(0,c.A)(function*(){t.performanceClient?.addQueueMeasurement(T.MX.RefreshTokenClientCreateTokenRequestBody,e.correlationId);const n=e.correlationId,a=new Ae.W;if(a.addClientId(e.tokenBodyParameters?.[Oe.U6]||t.config.authOptions.clientId),e.redirectUri&&a.addRedirectUri(e.redirectUri),a.addScopes(e.scopes,!0,t.config.authOptions.authority.options.OIDCOptions?.defaultScopes),a.addGrantType(h.$x.REFRESH_TOKEN_GRANT),a.addClientInfo(),a.addLibraryInfo(t.config.libraryInfo),a.addApplicationTelemetry(t.config.telemetry.application),a.addThrottling(),t.serverTelemetryManager&&!(0,tt.hf)(t.config)&&a.addServerTelemetry(t.serverTelemetryManager),a.addCorrelationId(n),a.addRefreshToken(e.refreshToken),t.config.clientCredentials.clientSecret&&a.addClientSecret(t.config.clientCredentials.clientSecret),t.config.clientCredentials.clientAssertion){const l=t.config.clientCredentials.clientAssertion;a.addClientAssertion(yield _e(l.assertion,t.config.authOptions.clientId,e.resourceRequestUri)),a.addClientAssertionType(l.assertionType)}if(e.authenticationScheme===h.IO.POP){const l=new Ce(t.cryptoUtils,t.performanceClient),i=yield p(l.generateCnf.bind(l),T.MX.PopTokenGenerateCnf,t.logger,t.performanceClient,e.correlationId)(e,t.logger);a.addPopToken(i.reqCnfString)}else if(e.authenticationScheme===h.IO.SSH){if(!e.sshJwk)throw(0,D.aD)(L.LX);a.addSshJwk(e.sshJwk)}if((!z.$.isEmptyObj(e.claims)||t.config.authOptions.clientCapabilities&&t.config.authOptions.clientCapabilities.length>0)&&a.addClaims(e.claims,t.config.authOptions.clientCapabilities),t.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case"home_account_id":try{const l=(0,we.Z)(e.ccsCredential.credential);a.addCcsOid(l)}catch(l){t.logger.verbose("Could not parse home account ID for CCS Header: "+l)}break;case"UPN":a.addCcsUpn(e.ccsCredential.credential)}return e.tokenBodyParameters&&a.addExtraQueryParameters(e.tokenBodyParameters),a.createQueryString()})()}}class Lt extends Ge{constructor(e,t){super(e,t)}acquireToken(e){var t=this;return(0,c.A)(function*(){try{const[n,a]=yield t.acquireCachedToken({...e,scopes:e.scopes?.length?e.scopes:[...h.aZ]});return a===h.Rv.PROACTIVELY_REFRESHED&&(t.logger.info("SilentFlowClient:acquireCachedToken - Cached access token's refreshOn property has been exceeded'. It's not expired, but must be refreshed."),new Le(t.config,t.performanceClient).acquireTokenByRefreshToken(e).catch(()=>{})),n}catch(n){if(n instanceof R.eB&&n.errorCode===O.wb)return new Le(t.config,t.performanceClient).acquireTokenByRefreshToken(e);throw n}})()}acquireCachedToken(e){var t=this;return(0,c.A)(function*(){t.performanceClient?.addQueueMeasurement(T.MX.SilentFlowClientAcquireCachedToken,e.correlationId);let n=h.Rv.NOT_APPLICABLE;if(e.forceRefresh||!t.config.cacheOptions.claimsBasedCachingEnabled&&!z.$.isEmptyObj(e.claims))throw t.setCacheOutcome(h.Rv.FORCE_REFRESH_OR_CLAIMS,e.correlationId),(0,R.SB)(O.wb);if(!e.account)throw(0,R.SB)(O.C2);const a=e.account.tenantId||function P(M){const n=new E.H(M).getUrlComponents().PathSegments.slice(-1)[0]?.toLowerCase();switch(n){case h.v2.COMMON:case h.v2.ORGANIZATIONS:case h.v2.CONSUMERS:return;default:return n}}(e.authority),l=t.cacheManager.getTokenKeys(),i=t.cacheManager.getAccessToken(e.account,e,l,a,t.performanceClient,e.correlationId);if(!i)throw t.setCacheOutcome(h.Rv.NO_CACHED_ACCESS_TOKEN,e.correlationId),(0,R.SB)(O.wb);if((0,ye.XJ)(i.cachedAt)||(0,ye.Hm)(i.expiresOn,t.config.systemOptions.tokenRenewalOffsetSeconds))throw t.setCacheOutcome(h.Rv.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),(0,R.SB)(O.wb);i.refreshOn&&(0,ye.Hm)(i.refreshOn,0)&&(n=h.Rv.PROACTIVELY_REFRESHED);const r=e.authority||t.authority.getPreferredCache(),o={account:t.cacheManager.readAccountFromCache(e.account),accessToken:i,idToken:t.cacheManager.getIdToken(e.account,l,a,t.performanceClient,e.correlationId),refreshToken:null,appMetadata:t.cacheManager.readAppMetadataFromCache(r)};return t.setCacheOutcome(n,e.correlationId),t.config.serverTelemetryManager&&t.config.serverTelemetryManager.incrementCacheHits(),[yield p(t.generateResultFromCacheRecord.bind(t),T.MX.SilentFlowClientGenerateResultFromCacheRecord,t.logger,t.performanceClient,e.correlationId)(o,e),n]})()}setCacheOutcome(e,t){this.serverTelemetryManager?.setCacheOutcome(e),this.performanceClient?.addFields({cacheOutcome:e},t),e!==h.Rv.NOT_APPLICABLE&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}generateResultFromCacheRecord(e,t){var n=this;return(0,c.A)(function*(){let a;if(n.performanceClient?.addQueueMeasurement(T.MX.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId),e.idToken&&(a=(0,ne.My)(e.idToken.secret,n.config.cryptoInterface.base64Decode)),t.maxAge||0===t.maxAge){const l=a?.auth_time;if(!l)throw(0,R.SB)(O.n3);(0,ne.al)(l,t.maxAge)}return Pe.generateAuthenticationResult(n.cryptoUtils,n.authority,e,!0,t,a)})()}}class yt extends ke{acquireToken(e){var t=this;return(0,c.A)(function*(){t.performanceClient.addQueueMeasurement(T.MX.SilentCacheClientAcquireToken,e.correlationId);const n=t.initializeServerTelemetryManager(_.sA.acquireTokenSilent_silentFlow),a=yield p(t.getClientConfiguration.bind(t),T.MX.StandardInteractionClientGetClientConfiguration,t.logger,t.performanceClient,t.correlationId)(n,e.authority,e.azureCloudOptions,e.account),l=new Lt(a,t.performanceClient);t.logger.verbose("Silent auth client created");try{const r=(yield p(l.acquireCachedToken.bind(l),T.MX.SilentFlowClientAcquireCachedToken,t.logger,t.performanceClient,e.correlationId)(e))[0];return t.performanceClient.addFields({fromCache:!0},e.correlationId),r}catch(i){throw i instanceof q.jT&&i.errorCode===V.e0&&t.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),i}})()}logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t?.account)}}class Ne extends ft{constructor(e,t,n,a,l,i,r,o,d,u,m,I){super(e,t,n,a,l,i,o,d,I),this.apiId=r,this.accountId=u,this.nativeMessageHandler=d,this.nativeStorageManager=m,this.silentCacheClient=new yt(e,this.nativeStorageManager,n,a,l,i,o,d,I)}acquireToken(e){var t=this;return(0,c.A)(function*(){t.performanceClient.addQueueMeasurement(T.MX.NativeInteractionClientAcquireToken,e.correlationId),t.logger.trace("NativeInteractionClient - acquireToken called.");const n=t.performanceClient.startMeasurement(T.MX.NativeInteractionClientAcquireToken,e.correlationId),a=ye._C(),l=yield t.initializeNativeRequest(e);try{const d=yield t.acquireTokensFromCache(t.accountId,l);return n.end({success:!0,isNativeBroker:!1,fromCache:!0}),d}catch{t.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}const i={method:_.Ct.GetToken,request:l},r=yield t.nativeMessageHandler.sendMessage(i),o=t.validateNativeResponse(r);return t.handleNativeResponse(o,l,a).then(d=>(n.end({success:!0,isNativeBroker:!0,requestId:d.requestId}),d)).catch(d=>{throw n.end({success:!1,errorCode:d.errorCode,subErrorCode:d.subError,isNativeBroker:!0}),d})})()}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:me.l.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}acquireTokensFromCache(e,t){var n=this;return(0,c.A)(function*(){if(!e)throw n.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),(0,R.SB)(O.rk);const a=n.browserStorage.getBaseAccountInfo({nativeAccountId:e});if(!a)throw(0,R.SB)(O.rk);try{const l=n.createSilentCacheRequest(t,a),i=yield n.silentCacheClient.acquireToken(l),r={...a,idTokenClaims:i?.idTokenClaims,idToken:i?.idToken};return{...i,account:r}}catch(l){throw l}})()}acquireTokenRedirect(e){var t=this;return(0,c.A)(function*(){t.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");const n=yield t.initializeNativeRequest(e),a={method:_.Ct.GetToken,request:n};try{const r=yield t.nativeMessageHandler.sendMessage(a);t.validateNativeResponse(r)}catch(r){if(r instanceof Se&&Ue(r))throw r}t.browserStorage.setTemporaryCache(_._p.NATIVE_REQUEST,JSON.stringify(n),!0);const l={apiId:_.sA.acquireTokenRedirect,timeout:t.config.system.redirectNavigationTimeout,noHistory:!1},i=t.config.auth.navigateToLoginRequestUrl?window.location.href:t.getRedirectUri(e.redirectUri);yield t.navigationClient.navigateExternal(i,l)})()}handleRedirectPromise(e,t){var n=this;return(0,c.A)(function*(){if(n.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!n.browserStorage.isInteractionInProgress(!0))return n.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const a=n.browserStorage.getCachedNativeRequest();if(!a)return n.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&e?.addFields({errorCode:"no_cached_request"},t),null;const{prompt:l,...i}=a;l&&n.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),n.browserStorage.removeItem(n.browserStorage.generateCacheKey(_._p.NATIVE_REQUEST));const r={method:_.Ct.GetToken,request:i},o=ye._C();try{n.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");const d=yield n.nativeMessageHandler.sendMessage(r);n.validateNativeResponse(d);const u=n.handleNativeResponse(d,i,o);return n.browserStorage.setInteractionInProgress(!1),yield u}catch(d){throw n.browserStorage.setInteractionInProgress(!1),d}})()}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}handleNativeResponse(e,t,n){var a=this;return(0,c.A)(function*(){a.logger.trace("NativeInteractionClient - handleNativeResponse called.");const l=ne.My(e.id_token,le.u),i=a.createHomeAccountIdentifier(e,l),r=a.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId})?.homeAccountId;if(i!==r&&e.account.id!==t.accountId)throw ze(Pt);const o=yield a.getDiscoveredAuthority(t.authority),d=rt(a.browserStorage,o,i,l,le.u,e.client_info,void 0,l.tid,void 0,e.account.id,a.logger),u=yield a.generateAuthenticationResult(e,t,l,d,o.canonicalAuthority,n);return a.cacheAccount(d),a.cacheNativeTokens(e,t,i,l,u.accessToken,u.tenantId,n),u})()}createHomeAccountIdentifier(e,t){return k.d.generateHomeAccountId(e.client_info||h.YM.EMPTY_STRING,v.I.Default,this.logger,this.browserCrypto,t)}generateScopes(e,t){return me.l.fromString(e.scope?e.scope:t.scope)}generatePopAccessToken(e,t){var n=this;return(0,c.A)(function*(){if(t.tokenType===h.IO.POP){if(e.shr)return n.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;const a=new Ce(n.browserCrypto),l={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw(0,R.SB)(O.fo);return a.signPopToken(e.access_token,t.keyId,l)}return e.access_token})()}generateAuthenticationResult(e,t,n,a,l,i){var r=this;return(0,c.A)(function*(){const o=r.addTelemetryFromNativeResponse(e),d=me.l.fromString(e.scope?e.scope:t.scope),u=e.account.properties||{},m=u.UID||n.oid||n.sub||h.YM.EMPTY_STRING,I=u.TenantId||n.tid||h.YM.EMPTY_STRING,K=(0,We.o9)(a.getAccountInfo(),void 0,n,e.id_token);K.nativeAccountId!==e.account.id&&(K.nativeAccountId=e.account.id);const Q=yield r.generatePopAccessToken(e,t),ee=t.tokenType===h.IO.POP?h.IO.POP:h.IO.BEARER;return{authority:l,uniqueId:m,tenantId:I,scopes:d.asArray(),account:K,idToken:e.id_token,idTokenClaims:n,accessToken:Q,fromCache:!!o&&r.isResponseFromCache(o),expiresOn:new Date(1e3*Number(i+e.expires_in)),tokenType:ee,correlationId:r.correlationId,state:e.state,fromNativeBroker:!0}})()}cacheAccount(e){this.browserStorage.setAccount(e),this.browserStorage.removeAccountContext(e).catch(t=>{this.logger.error(`Error occurred while removing account context from browser storage. ${t}`)})}cacheNativeTokens(e,t,n,a,l,i,r){const o=b.c_(n,t.authority,e.id_token||"",t.clientId,a.tid||""),u=r+(t.tokenType===h.IO.POP?h.YM.SHR_NONCE_VALIDITY:("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0),m=this.generateScopes(e,t),I=b.Np(n,t.authority,l,t.clientId,a.tid||i,m.printScopes(),u,0,le.u),K=new re(void 0,o,I);this.nativeStorageManager.saveCacheRecord(K,t.storeInCache)}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}validateNativeResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw(0,N.pz)(Ze.W,"Response missing expected properties.")}getMATSFromResponse(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch{this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return typeof e.is_cached>"u"?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}initializeNativeRequest(e){var t=this;return(0,c.A)(function*(){t.logger.trace("NativeInteractionClient - initializeNativeRequest called");const n=e.authority||t.config.auth.authority;e.account&&(yield t.getDiscoveredAuthority(n,e.azureCloudOptions,e.account));const a=new E.H(n);a.validateAsUri();const{scopes:l,...i}=e,r=new me.l(l||[]);r.appendScopes(h.aZ);const d={...i,accountId:t.accountId,clientId:t.config.auth.clientId,authority:a.urlString,scope:r.printScopes(),redirectUri:t.getRedirectUri(e.redirectUri),prompt:(()=>{switch(t.apiId){case _.sA.ssoSilent:case _.sA.acquireTokenSilent_silentFlow:return t.logger.trace("initializeNativeRequest: silent request sets prompt to none"),h._M.NONE}if(e.prompt)switch(e.prompt){case h._M.NONE:case h._M.CONSENT:case h._M.LOGIN:return t.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw t.logger.trace(`initializeNativeRequest: prompt = ${e.prompt} is not compatible with native flow`),(0,q.bD)(V.nF)}else t.logger.trace("initializeNativeRequest: prompt was not provided")})(),correlationId:t.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1};if(t.handleExtraBrokerParams(d),d.extraParameters=d.extraParameters||{},d.extraParameters.telemetry=_.JD.MATS_TELEMETRY,e.authenticationScheme===h.IO.POP){const u={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},m=new Ce(t.browserCrypto),I=yield p(m.generateCnf.bind(m),T.MX.PopTokenGenerateCnf,t.logger,t.performanceClient,t.correlationId)(u,t.logger);d.reqCnf=I.reqCnfHash,d.keyId=I.kid}return d})()}handleExtraBrokerParams(e){if(e.extraParameters&&e.extraParameters.hasOwnProperty("brk_client_id")&&e.extraParameters.hasOwnProperty("brk_redirect_uri")&&e.extraParameters.hasOwnProperty(Oe.U6)){const a=e.extraParameters.brk_redirect_uri;e.extraParameters={child_client_id:e.extraParameters[Oe.U6],child_redirect_uri:e.redirectUri},e.redirectUri=a}}}class Ee{constructor(e,t,n,a){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=a,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=n,this.handshakeEvent=n.startMeasurement(T.MX.NativeMessageHandlerHandshake)}sendMessage(e){var t=this;return(0,c.A)(function*(){t.logger.trace("NativeMessageHandler - sendMessage called.");const n={channel:_.JD.CHANNEL_ID,extensionId:t.extensionId,responseId:(0,ve.Oy)(),body:e};return t.logger.trace("NativeMessageHandler - Sending request to browser extension"),t.logger.tracePii(`NativeMessageHandler - Sending request to browser extension: ${JSON.stringify(n)}`),t.messageChannel.port1.postMessage(n),new Promise((a,l)=>{t.resolvers.set(n.responseId,{resolve:a,reject:l})})})()}static createProvider(e,t,n){return(0,c.A)(function*(){e.trace("NativeMessageHandler - createProvider called.");try{const a=new Ee(e,t,n,_.JD.PREFERRED_EXTENSION_ID);return yield a.sendHandshakeRequest(),a}catch{const l=new Ee(e,t,n);return yield l.sendHandshakeRequest(),l}})()}sendHandshakeRequest(){var e=this;return(0,c.A)(function*(){e.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",e.windowListener,!1);const t={channel:_.JD.CHANNEL_ID,extensionId:e.extensionId,responseId:(0,ve.Oy)(),body:{method:_.Ct.HandshakeRequest}};return e.handshakeEvent.add({extensionId:e.extensionId,extensionHandshakeTimeoutMs:e.handshakeTimeoutMs}),e.messageChannel.port1.onmessage=n=>{e.onChannelMessage(n)},window.postMessage(t,window.origin,[e.messageChannel.port2]),new Promise((n,a)=>{e.handshakeResolvers.set(t.responseId,{resolve:n,reject:a}),e.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",e.windowListener,!1),e.messageChannel.port1.close(),e.messageChannel.port2.close(),e.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),a((0,q.bD)(V.y3)),e.handshakeResolvers.delete(t.responseId)},e.handshakeTimeoutMs)})})()}onWindowMessage(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source!==window)return;const t=e.data;if(t.channel&&t.channel===_.JD.CHANNEL_ID&&(!t.extensionId||t.extensionId===this.extensionId)&&t.body.method===_.Ct.HandshakeRequest){const n=this.handshakeResolvers.get(t.responseId);if(!n)return void this.logger.trace(`NativeMessageHandler.onWindowMessage - resolver can't be found for request ${t.responseId}`);this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),n.reject((0,q.bD)(V.cq))}}onChannelMessage(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");const t=e.data,n=this.resolvers.get(t.responseId),a=this.handshakeResolvers.get(t.responseId);try{const l=t.body.method;if(l===_.Ct.Response){if(!n)return;const i=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii(`NativeMessageHandler - Received response from browser extension: ${JSON.stringify(i)}`),"Success"!==i.status)n.reject(ze(i.code,i.description,i.ext));else{if(!i.result)throw(0,N.pz)(Ze.W,"Event does not contain result.");i.result.code&&i.result.description?n.reject(ze(i.result.code,i.result.description,i.result.ext)):n.resolve(i.result)}this.resolvers.delete(t.responseId)}else if(l===_.Ct.HandshakeResponse){if(!a)return void this.logger.trace(`NativeMessageHandler.onChannelMessage - resolver can't be found for request ${t.responseId}`);clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(`NativeMessageHandler - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),a.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(l){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${l}`),this.logger.errorPii(`Unable to parse ${e}`),n?n.reject(l):a&&a.reject(l)}}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}static isNativeAvailable(e,t,n,a){if(t.trace("isNativeAvailable called"),!e.system.allowNativeBroker)return t.trace("isNativeAvailable: allowNativeBroker is not enabled, returning false"),!1;if(!n)return t.trace("isNativeAvailable: WAM extension provider is not initialized, returning false"),!1;if(a)switch(a){case h.IO.BEARER:case h.IO.POP:return t.trace("isNativeAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isNativeAvailable: authenticationScheme is not supported, returning false"),!1}return!0}}class De{constructor(e,t,n,a,l){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=a,this.performanceClient=l}handleCodeResponse(e,t){var n=this;return(0,c.A)(function*(){let a;n.performanceClient.addQueueMeasurement(T.MX.HandleCodeResponse,t.correlationId);try{a=n.authModule.handleFragmentResponse(e,t.state)}catch(l){throw l instanceof Me.g&&l.subError===V.fN?(0,q.bD)(V.fN):l}return p(n.handleCodeResponseFromServer.bind(n),T.MX.HandleCodeResponseFromServer,n.logger,n.performanceClient,t.correlationId)(a,t)})()}handleCodeResponseFromServer(e,t,n=!0){var a=this;return(0,c.A)(function*(){if(a.performanceClient.addQueueMeasurement(T.MX.HandleCodeResponseFromServer,t.correlationId),a.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),a.authCodeRequest.code=e.code,e.cloud_instance_host_name&&(yield p(a.authModule.updateAuthority.bind(a.authModule),T.MX.UpdateTokenEndpointAuthority,a.logger,a.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId)),n&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)a.authCodeRequest.clientInfo=e.client_info;else{const i=a.createCcsCredentials(t);i&&(a.authCodeRequest.ccsCredential=i)}return yield p(a.authModule.acquireToken.bind(a.authModule),T.MX.AuthClientAcquireToken,a.logger,a.performanceClient,t.correlationId)(a.authCodeRequest,e)})()}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:"home_account_id"}:e.loginHint?{credential:e.loginHint,type:"UPN"}:null}}var Be=g(2718);function at(M,e,t){const n=Be.n(M);if(!n)throw Be.S(M)?(t.error(`A ${e} is present in the iframe but it does not contain known properties. It's likely that the ${e} has been replaced by code running on the redirectUri page.`),t.errorPii(`The ${e} detected is: ${M}`),(0,q.bD)(V.Lm)):(t.error(`The request has returned to the redirectUri but a ${e} is not present. It's likely that the ${e} has been removed or the page has been redirected by code running on the redirectUri page.`),(0,q.bD)(V.wv));return n}class Zt extends ke{constructor(e,t,n,a,l,i,r,o,d,u){super(e,t,n,a,l,i,r,d,u),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=o}acquireToken(e){try{const t=this.generatePopupName(e.scopes||h.aZ,e.authority||this.config.auth.authority),n=e.popupWindowAttributes||{};if(this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,t,n);{this.logger.verbose("asyncPopup set to false, opening popup before acquiring token");const a=this.openSizedPopup("about:blank",t,n);return this.acquireTokenPopupAsync(e,t,n,a)}}catch(t){return Promise.reject(t)}}logout(e){try{this.logger.verbose("logoutPopup called");const t=this.initializeLogoutRequest(e),n=this.generateLogoutPopupName(t),a=e&&e.authority,l=e&&e.mainWindowRedirectUri,i=e?.popupWindowAttributes||{};if(this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,n,i,a,void 0,l);{this.logger.verbose("asyncPopup set to false, opening popup");const r=this.openSizedPopup("about:blank",n,i);return this.logoutPopupAsync(t,n,i,a,r,l)}}catch(t){return Promise.reject(t)}}acquireTokenPopupAsync(e,t,n,a){var l=this;return(0,c.A)(function*(){l.logger.verbose("acquireTokenPopupAsync called");const i=l.initializeServerTelemetryManager(_.sA.acquireTokenPopup),r=yield p(l.initializeAuthorizationRequest.bind(l),T.MX.StandardInteractionClientInitializeAuthorizationRequest,l.logger,l.performanceClient,l.correlationId)(e,_.X8.Popup);(0,oe.kZ)(r.authority);try{const o=yield p(l.initializeAuthorizationCodeRequest.bind(l),T.MX.StandardInteractionClientInitializeAuthorizationCodeRequest,l.logger,l.performanceClient,l.correlationId)(r),d=yield p(l.createAuthCodeClient.bind(l),T.MX.StandardInteractionClientCreateAuthCodeClient,l.logger,l.performanceClient,l.correlationId)(i,r.authority,r.azureCloudOptions,r.account),u=Ee.isNativeAvailable(l.config,l.logger,l.nativeMessageHandler,e.authenticationScheme);let m;u&&(m=l.performanceClient.startMeasurement(T.MX.FetchAccountIdWithNativeBroker,e.correlationId));const I=yield d.getAuthCodeUrl({...r,nativeBroker:u}),K=new De(d,l.browserStorage,o,l.logger,l.performanceClient),ee=l.initiateAuthRequest(I,{popup:a,popupName:t,popupWindowAttributes:n});l.eventHandler.emitEvent(Z.B.POPUP_OPENED,_.X8.Popup,{popupWindow:ee},null);const ae=yield l.monitorPopupForHash(ee),he=X(at,T.MX.DeserializeResponse,l.logger,l.performanceClient,l.correlationId)(ae,l.config.auth.OIDCOptions.serverResponseType,l.logger);if(se.removeThrottle(l.browserStorage,l.config.auth.clientId,o),he.accountId){if(l.logger.verbose("Account id found in hash, calling WAM for token"),m&&m.end({success:!0,isNativeBroker:!0}),!l.nativeMessageHandler)throw(0,q.bD)(V.XC);const He=new Ne(l.config,l.browserStorage,l.browserCrypto,l.logger,l.eventHandler,l.navigationClient,_.sA.acquireTokenPopup,l.performanceClient,l.nativeMessageHandler,he.accountId,l.nativeStorage,r.correlationId),{userRequestState:dt}=W.parseRequestState(l.browserCrypto,r.state);return yield He.acquireToken({...r,state:dt,prompt:void 0})}return yield K.handleCodeResponse(he,r)}catch(o){throw a&&a.close(),o instanceof N.lR&&(o.setCorrelationId(l.correlationId),i.cacheFailedRequest(o)),o}})()}logoutPopupAsync(e,t,n,a,l,i){var r=this;return(0,c.A)(function*(){r.logger.verbose("logoutPopupAsync called"),r.eventHandler.emitEvent(Z.B.LOGOUT_START,_.X8.Popup,e);const o=r.initializeServerTelemetryManager(_.sA.logoutPopup);try{yield r.clearCacheOnLogout(e.account);const u=(yield p(r.createAuthCodeClient.bind(r),T.MX.StandardInteractionClientCreateAuthCodeClient,r.logger,r.performanceClient,r.correlationId)(o,a,void 0,e.account||void 0)).getLogoutUri(e);r.eventHandler.emitEvent(Z.B.LOGOUT_SUCCESS,_.X8.Popup,e);const m=r.openPopup(u,{popupName:t,popupWindowAttributes:n,popup:l});if(r.eventHandler.emitEvent(Z.B.POPUP_OPENED,_.X8.Popup,{popupWindow:m},null),yield r.monitorPopupForHash(m).catch(()=>{}),i){const I={apiId:_.sA.logoutPopup,timeout:r.config.system.redirectNavigationTimeout,noHistory:!1},K=E.H.getAbsoluteUrl(i,(0,oe.Uu)());r.logger.verbose("Redirecting main window to url specified in the request"),r.logger.verbosePii(`Redirecting main window to: ${K}`),yield r.navigationClient.navigateInternal(K,I)}else r.logger.verbose("No main window navigation requested")}catch(d){throw l&&l.close(),d instanceof N.lR&&(d.setCorrelationId(r.correlationId),o.cacheFailedRequest(d)),r.browserStorage.setInteractionInProgress(!1),r.eventHandler.emitEvent(Z.B.LOGOUT_FAILURE,_.X8.Popup,null,d),r.eventHandler.emitEvent(Z.B.LOGOUT_END,_.X8.Popup),d}r.eventHandler.emitEvent(Z.B.LOGOUT_END,_.X8.Popup)})()}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),(0,q.bD)(V.B2)}monitorPopupForHash(e){return new Promise((t,n)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");const a=setInterval(()=>{if(e.closed)return this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(a),void n((0,q.bD)(V.fN));let l="";try{l=e.location.href}catch{}if(!l||"about:blank"===l)return;clearInterval(a);let i="";e&&(i=this.config.auth.OIDCOptions.serverResponseType===h.zL.QUERY?e.location.search:e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),t(i)},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e)})}openPopup(e,t){try{let n;if(t.popup?(n=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),n.location.assign(e)):typeof t.popup>"u"&&(this.logger.verbosePii(`Opening popup window to: ${e}`),n=this.openSizedPopup(e,t.popupName,t.popupWindowAttributes)),!n)throw(0,q.bD)(V.MP);return n.focus&&n.focus(),this.currentWindow=n,window.addEventListener("beforeunload",this.unloadWindow),n}catch(n){throw this.logger.error("error opening popup "+n.message),this.browserStorage.setInteractionInProgress(!1),(0,q.bD)(V.hs)}}openSizedPopup(e,t,n){const a=window.screenLeft?window.screenLeft:window.screenX,l=window.screenTop?window.screenTop:window.screenY,i=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,r=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let o=n.popupSize?.width,d=n.popupSize?.height,u=n.popupPosition?.top,m=n.popupPosition?.left;return(!o||o<0||o>i)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),o=_.Q1.POPUP_WIDTH),(!d||d<0||d>r)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),d=_.Q1.POPUP_HEIGHT),(!u||u<0||u>r)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),u=Math.max(0,r/2-_.Q1.POPUP_HEIGHT/2+l)),(!m||m<0||m>i)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),m=Math.max(0,i/2-_.Q1.POPUP_WIDTH/2+a)),window.open(e,t,`width=${o}, height=${d}, top=${u}, left=${m}, scrollbars=yes`)}unloadWindow(e){this.browserStorage.cleanRequestByInteractionType(_.X8.Popup),this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e){e&&e.close(),window.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)}generatePopupName(e,t){return`${_.Q1.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){return`${_.Q1.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.account&&e.account.homeAccountId}.${this.correlationId}`}}class vt{constructor(e,t,n,a,l){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=a,this.performanceClient=l}initiateAuthRequest(e,t){var n=this;return(0,c.A)(function*(){if(n.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){t.redirectStartPage&&(n.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),n.browserStorage.setTemporaryCache(_._p.ORIGIN_URI,t.redirectStartPage,!0)),n.browserStorage.setTemporaryCache(_._p.CORRELATION_ID,n.authCodeRequest.correlationId,!0),n.browserStorage.cacheCodeRequest(n.authCodeRequest),n.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);const a={apiId:_.sA.acquireTokenRedirect,timeout:t.redirectTimeout,noHistory:!1};return"function"==typeof t.onRedirectNavigate?(n.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),!1!==t.onRedirectNavigate(e)?(n.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),void(yield t.navigationClient.navigateExternal(e,a))):void n.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation")):(n.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),void(yield t.navigationClient.navigateExternal(e,a)))}throw n.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),(0,q.bD)(V.B2)})()}handleCodeResponse(e,t){var n=this;return(0,c.A)(function*(){n.logger.verbose("RedirectHandler.handleCodeResponse called"),n.browserStorage.setInteractionInProgress(!1);const a=n.browserStorage.generateStateKey(t),l=n.browserStorage.getTemporaryCache(a);if(!l)throw(0,R.SB)(O.tQ,"Cached State");let i;try{i=n.authModule.handleFragmentResponse(e,l)}catch(u){throw u instanceof Me.g&&u.subError===V.fN?(0,q.bD)(V.fN):u}const r=n.browserStorage.generateNonceKey(l),o=n.browserStorage.getTemporaryCache(r);if(n.authCodeRequest.code=i.code,i.cloud_instance_host_name&&(yield p(n.authModule.updateAuthority.bind(n.authModule),T.MX.UpdateTokenEndpointAuthority,n.logger,n.performanceClient,n.authCodeRequest.correlationId)(i.cloud_instance_host_name,n.authCodeRequest.correlationId)),i.nonce=o||void 0,i.state=l,i.client_info)n.authCodeRequest.clientInfo=i.client_info;else{const u=n.checkCcsCredentials();u&&(n.authCodeRequest.ccsCredential=u)}const d=yield n.authModule.acquireToken(n.authCodeRequest,i);return n.browserStorage.cleanRequestByState(t),d})()}checkCcsCredentials(){const e=this.browserStorage.getTemporaryCache(_._p.CCS_CREDENTIAL,!0);if(e)try{return JSON.parse(e)}catch{this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii(`Cache credential could not be parsed: ${e}`)}return null}}class _t extends ke{constructor(e,t,n,a,l,i,r,o,d,u){super(e,t,n,a,l,i,r,d,u),this.nativeStorage=o}acquireToken(e){var t=this;return(0,c.A)(function*(){const n=yield p(t.initializeAuthorizationRequest.bind(t),T.MX.StandardInteractionClientInitializeAuthorizationRequest,t.logger,t.performanceClient,t.correlationId)(e,_.X8.Redirect);t.browserStorage.updateCacheEntries(n.state,n.nonce,n.authority,n.loginHint||"",n.account||null);const a=t.initializeServerTelemetryManager(_.sA.acquireTokenRedirect),l=i=>{i.persisted&&(t.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),t.browserStorage.cleanRequestByState(n.state),t.eventHandler.emitEvent(Z.B.RESTORE_FROM_BFCACHE,_.X8.Redirect))};try{const i=yield p(t.initializeAuthorizationCodeRequest.bind(t),T.MX.StandardInteractionClientInitializeAuthorizationCodeRequest,t.logger,t.performanceClient,t.correlationId)(n),r=yield p(t.createAuthCodeClient.bind(t),T.MX.StandardInteractionClientCreateAuthCodeClient,t.logger,t.performanceClient,t.correlationId)(a,n.authority,n.azureCloudOptions,n.account),o=new vt(r,t.browserStorage,i,t.logger,t.performanceClient),d=yield r.getAuthCodeUrl({...n,nativeBroker:Ee.isNativeAvailable(t.config,t.logger,t.nativeMessageHandler,e.authenticationScheme)}),u=t.getRedirectStartPage(e.redirectStartPage);return t.logger.verbosePii(`Redirect start page: ${u}`),window.addEventListener("pageshow",l),yield o.initiateAuthRequest(d,{navigationClient:t.navigationClient,redirectTimeout:t.config.system.redirectNavigationTimeout,redirectStartPage:u,onRedirectNavigate:e.onRedirectNavigate})}catch(i){throw i instanceof N.lR&&(i.setCorrelationId(t.correlationId),a.cacheFailedRequest(i)),window.removeEventListener("pageshow",l),t.browserStorage.cleanRequestByState(n.state),i}})()}handleRedirectPromise(e="",t){var n=this;return(0,c.A)(function*(){const a=n.initializeServerTelemetryManager(_.sA.handleRedirectPromise);try{if(!n.browserStorage.isInteractionInProgress(!0))return n.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const[l,i]=n.getRedirectResponse(e||"");if(!l)return n.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),n.browserStorage.cleanRequestByInteractionType(_.X8.Redirect),t.event.errorCode="no_server_response",null;const r=n.browserStorage.getTemporaryCache(_._p.ORIGIN_URI,!0)||h.YM.EMPTY_STRING;if(E.H.removeHashFromUrl(r)===E.H.removeHashFromUrl(window.location.href)&&n.config.auth.navigateToLoginRequestUrl)return n.logger.verbose("Current page is loginRequestUrl, handling response"),r.indexOf("#")>-1&&(0,oe.nQ)(r),yield n.handleResponse(l,a);if(!n.config.auth.navigateToLoginRequestUrl)return n.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),yield n.handleResponse(l,a);if(!(0,oe.GZ)()||n.config.system.allowRedirectInIframe){n.browserStorage.setTemporaryCache(_._p.URL_HASH,i,!0);const u={apiId:_.sA.handleRedirectPromise,timeout:n.config.system.redirectNavigationTimeout,noHistory:!0};let m=!0;if(r&&"null"!==r)n.logger.verbose(`Navigating to loginRequestUrl: ${r}`),m=yield n.navigationClient.navigateInternal(r,u);else{const I=(0,oe.VX)();n.browserStorage.setTemporaryCache(_._p.ORIGIN_URI,I,!0),n.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),m=yield n.navigationClient.navigateInternal(I,u)}if(!m)return yield n.handleResponse(l,a)}return null}catch(l){throw l instanceof N.lR&&(l.setCorrelationId(n.correlationId),a.cacheFailedRequest(l)),n.browserStorage.cleanRequestByInteractionType(_.X8.Redirect),l}})()}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(t=this.config.auth.OIDCOptions.serverResponseType===h.zL.QUERY?window.location.search:window.location.hash);let n=Be.n(t);if(n){try{!function Bt(M,e,t){if(!M.state)throw(0,q.bD)(V.c$);const n=ce(e,M.state);if(!n)throw(0,q.bD)(V.fA);if(n.interactionType!==t)throw(0,q.bD)(V.oe)}(n,this.browserCrypto,_.X8.Redirect)}catch(l){return l instanceof N.lR&&this.logger.error(`Interaction type validation failed due to ${l.errorCode}: ${l.errorMessage}`),[null,""]}return(0,oe.U2)(window),this.logger.verbose("Hash contains known properties, returning response hash"),[n,t]}const a=this.browserStorage.getTemporaryCache(_._p.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(_._p.URL_HASH)),a&&(n=Be.n(a),n)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[n,a]):[null,""]}handleResponse(e,t){var n=this;return(0,c.A)(function*(){const a=e.state;if(!a)throw(0,q.bD)(V.c$);const l=n.browserStorage.getCachedRequest(a);if(n.logger.verbose("handleResponse called, retrieved cached request"),e.accountId){if(n.logger.verbose("Account id found in hash, calling WAM for token"),!n.nativeMessageHandler)throw(0,q.bD)(V.XC);const d=new Ne(n.config,n.browserStorage,n.browserCrypto,n.logger,n.eventHandler,n.navigationClient,_.sA.acquireTokenPopup,n.performanceClient,n.nativeMessageHandler,e.accountId,n.nativeStorage,l.correlationId),{userRequestState:u}=W.parseRequestState(n.browserCrypto,a);return d.acquireToken({...l,state:u,prompt:void 0}).finally(()=>{n.browserStorage.cleanRequestByState(a)})}const i=n.browserStorage.getCachedAuthority(a);if(!i)throw(0,q.bD)(V.Ne);const r=yield p(n.createAuthCodeClient.bind(n),T.MX.StandardInteractionClientCreateAuthCodeClient,n.logger,n.performanceClient,n.correlationId)(t,i);return se.removeThrottle(n.browserStorage,n.config.auth.clientId,l),new vt(r,n.browserStorage,l,n.logger,n.performanceClient).handleCodeResponse(e,a)})()}logout(e){var t=this;return(0,c.A)(function*(){t.logger.verbose("logoutRedirect called");const n=t.initializeLogoutRequest(e),a=t.initializeServerTelemetryManager(_.sA.logout);try{t.eventHandler.emitEvent(Z.B.LOGOUT_START,_.X8.Redirect,e),yield t.clearCacheOnLogout(n.account);const l={apiId:_.sA.logout,timeout:t.config.system.redirectNavigationTimeout,noHistory:!1},r=(yield p(t.createAuthCodeClient.bind(t),T.MX.StandardInteractionClientCreateAuthCodeClient,t.logger,t.performanceClient,t.correlationId)(a,e&&e.authority,void 0,e&&e.account||void 0)).getLogoutUri(n);if(t.eventHandler.emitEvent(Z.B.LOGOUT_SUCCESS,_.X8.Redirect,n),!e||"function"!=typeof e.onRedirectNavigate)return t.browserStorage.getInteractionInProgress()||t.browserStorage.setInteractionInProgress(!0),void(yield t.navigationClient.navigateExternal(r,l));if(!1!==e.onRedirectNavigate(r))return t.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),t.browserStorage.getInteractionInProgress()||t.browserStorage.setInteractionInProgress(!0),void(yield t.navigationClient.navigateExternal(r,l));t.browserStorage.setInteractionInProgress(!1),t.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation")}catch(l){throw l instanceof N.lR&&(l.setCorrelationId(t.correlationId),a.cacheFailedRequest(l)),t.eventHandler.emitEvent(Z.B.LOGOUT_FAILURE,_.X8.Redirect,null,l),t.eventHandler.emitEvent(Z.B.LOGOUT_END,_.X8.Redirect),l}t.eventHandler.emitEvent(Z.B.LOGOUT_END,_.X8.Redirect)})()}getRedirectStartPage(e){const t=e||window.location.href;return E.H.getAbsoluteUrl(t,(0,oe.Uu)())}}var Te=g(5189);function Ht(M,e,t,n,a){return st.apply(this,arguments)}function st(){return(st=(0,c.A)(function*(M,e,t,n,a){if(e.addQueueMeasurement(T.MX.SilentHandlerInitiateAuthRequest,n),!M)throw t.info("Navigate url is empty"),(0,q.bD)(V.B2);return a?p(xt,T.MX.SilentHandlerLoadFrame,t,e,n)(M,a,e,n):X(Kt,T.MX.SilentHandlerLoadFrameSync,t,e,n)(M)})).apply(this,arguments)}function Ft(M,e,t,n,a,l,i){return ct.apply(this,arguments)}function ct(){return(ct=(0,c.A)(function*(M,e,t,n,a,l,i){return n.addQueueMeasurement(T.MX.SilentHandlerMonitorIframeForHash,l),new Promise((r,o)=>{e<Te.YH&&a.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${e}ms) than the default (${Te.YH}ms). This may result in timeouts.`);const d=window.setTimeout(()=>{window.clearInterval(u),o((0,q.bD)(V.Uf))},e),u=window.setInterval(()=>{let m="";const I=M.contentWindow;try{m=I?I.location.href:""}catch{}if(!m||"about:blank"===m)return;let K="";I&&(K=i===h.zL.QUERY?I.location.search:I.location.hash),window.clearTimeout(d),window.clearInterval(u),r(K)},t)}).finally(()=>{X(Gt,T.MX.RemoveHiddenIframe,a,n,l)(M)})})).apply(this,arguments)}function xt(M,e,t,n){return t.addQueueMeasurement(T.MX.SilentHandlerLoadFrame,n),new Promise((a,l)=>{const i=It();window.setTimeout(()=>{i?(i.src=M,a(i)):l("Unable to load iframe")},e)})}function Kt(M){const e=It();return e.src=M,e}function It(){const M=document.createElement("iframe");return M.className="msalSilentIframe",M.style.visibility="hidden",M.style.position="absolute",M.style.width=M.style.height="0",M.style.border="0",M.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(M),M}function Gt(M){document.body===M.parentNode&&document.body.removeChild(M)}class $t extends ke{constructor(e,t,n,a,l,i,r,o,d,u,m){super(e,t,n,a,l,i,o,u,m),this.apiId=r,this.nativeStorage=d}acquireToken(e){var t=this;return(0,c.A)(function*(){t.performanceClient.addQueueMeasurement(T.MX.SilentIframeClientAcquireToken,e.correlationId),!e.loginHint&&!e.sid&&(!e.account||!e.account.username)&&t.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");const n={...e};n.prompt?n.prompt!==h._M.NONE&&n.prompt!==h._M.NO_SESSION&&(t.logger.warning(`SilentIframeClient. Replacing invalid prompt ${n.prompt} with ${h._M.NONE}`),n.prompt=h._M.NONE):n.prompt=h._M.NONE;const a=yield p(t.initializeAuthorizationRequest.bind(t),T.MX.StandardInteractionClientInitializeAuthorizationRequest,t.logger,t.performanceClient,e.correlationId)(n,_.X8.Silent);(0,oe.kZ)(a.authority);const l=t.initializeServerTelemetryManager(t.apiId);try{const i=yield p(t.createAuthCodeClient.bind(t),T.MX.StandardInteractionClientCreateAuthCodeClient,t.logger,t.performanceClient,e.correlationId)(l,a.authority,a.azureCloudOptions,a.account);return yield p(t.silentTokenHelper.bind(t),T.MX.SilentIframeClientTokenHelper,t.logger,t.performanceClient,e.correlationId)(i,a)}catch(i){throw i instanceof N.lR&&(i.setCorrelationId(t.correlationId),l.cacheFailedRequest(i)),i}})()}logout(){return Promise.reject((0,q.bD)(V.v7))}silentTokenHelper(e,t){var n=this;return(0,c.A)(function*(){const a=t.correlationId;n.performanceClient.addQueueMeasurement(T.MX.SilentIframeClientTokenHelper,a);const l=yield p(n.initializeAuthorizationCodeRequest.bind(n),T.MX.StandardInteractionClientInitializeAuthorizationCodeRequest,n.logger,n.performanceClient,a)(t),i=yield p(e.getAuthCodeUrl.bind(e),T.MX.GetAuthCodeUrl,n.logger,n.performanceClient,a)({...t,nativeBroker:Ee.isNativeAvailable(n.config,n.logger,n.nativeMessageHandler,t.authenticationScheme)}),r=new De(e,n.browserStorage,l,n.logger,n.performanceClient),o=yield p(Ht,T.MX.SilentHandlerInitiateAuthRequest,n.logger,n.performanceClient,a)(i,n.performanceClient,n.logger,a,n.config.system.navigateFrameWait),d=n.config.auth.OIDCOptions.serverResponseType,u=yield p(Ft,T.MX.SilentHandlerMonitorIframeForHash,n.logger,n.performanceClient,a)(o,n.config.system.iframeHashTimeout,n.config.system.pollIntervalMilliseconds,n.performanceClient,n.logger,a,d),m=X(at,T.MX.DeserializeResponse,n.logger,n.performanceClient,n.correlationId)(u,d,n.logger);if(m.accountId){if(n.logger.verbose("Account id found in hash, calling WAM for token"),!n.nativeMessageHandler)throw(0,q.bD)(V.XC);const I=new Ne(n.config,n.browserStorage,n.browserCrypto,n.logger,n.eventHandler,n.navigationClient,n.apiId,n.performanceClient,n.nativeMessageHandler,m.accountId,n.browserStorage,a),{userRequestState:K}=W.parseRequestState(n.browserCrypto,t.state);return p(I.acquireToken.bind(I),T.MX.NativeInteractionClientAcquireToken,n.logger,n.performanceClient,a)({...t,state:K,prompt:t.prompt||h._M.NONE})}return p(r.handleCodeResponse.bind(r),T.MX.HandleCodeResponse,n.logger,n.performanceClient,a)(m,t)})()}}class jt extends ke{acquireToken(e){var t=this;return(0,c.A)(function*(){t.performanceClient.addQueueMeasurement(T.MX.SilentRefreshClientAcquireToken,e.correlationId);const n=yield p(At,T.MX.InitializeBaseRequest,t.logger,t.performanceClient,e.correlationId)(e,t.config,t.performanceClient,t.logger),a={...e,...n};e.redirectUri&&(a.redirectUri=t.getRedirectUri(e.redirectUri));const l=t.initializeServerTelemetryManager(_.sA.acquireTokenSilent_silentFlow),i=yield t.createRefreshTokenClient(l,a.authority,a.azureCloudOptions,a.account);return p(i.acquireTokenByRefreshToken.bind(i),T.MX.RefreshTokenClientAcquireTokenByRefreshToken,t.logger,t.performanceClient,e.correlationId)(a).catch(r=>{throw r.setCorrelationId(t.correlationId),l.cacheFailedRequest(r),r})})()}logout(){return Promise.reject((0,q.bD)(V.v7))}createRefreshTokenClient(e,t,n,a){var l=this;return(0,c.A)(function*(){const i=yield p(l.getClientConfiguration.bind(l),T.MX.StandardInteractionClientGetClientConfiguration,l.logger,l.performanceClient,l.correlationId)(e,t,n,a);return new Le(i,l.performanceClient)})()}}class qt{constructor(e,t,n,a){this.isBrowserEnvironment=typeof window<"u",this.config=e,this.storage=t,this.logger=n,this.cryptoObj=a}loadExternalTokens(e,t,n){if(this.logger.info("TokenCache - loadExternalTokens called"),!t.id_token)throw(0,q.bD)(V.s9);const a=ne.My(t.id_token,le.u);let l,i,r;if(e.account)r=k.d.createFromAccountInfo(e.account),l=new re(r,this.loadIdToken(t.id_token,r.homeAccountId,e.account.environment,e.account.tenantId),this.loadAccessToken(e,t,r.homeAccountId,e.account.environment,e.account.tenantId,n),this.loadRefreshToken(e,t,r.homeAccountId,e.account.environment));else{if(!e.authority)throw(0,q.bD)(V.s9);{const o=w.generateAuthority(e.authority,e.azureCloudOptions);if(i=new w(o,this.config.system.networkClient,this.storage,{protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},this.logger,e.correlationId||(0,ve.Oy)()),n.clientInfo)this.logger.trace("TokenCache - homeAccountId from options"),r=this.loadAccount(a,i,n.clientInfo),l=new re(r,this.loadIdToken(t.id_token,r.homeAccountId,i.hostnameAndPort,i.tenant),this.loadAccessToken(e,t,r.homeAccountId,i.hostnameAndPort,i.tenant,n),this.loadRefreshToken(e,t,r.homeAccountId,i.hostnameAndPort));else{if(!t.client_info)throw(0,q.bD)(V.s9);this.logger.trace("TokenCache - homeAccountId from response"),r=this.loadAccount(a,i,t.client_info),l=new re(r,this.loadIdToken(t.id_token,r.homeAccountId,i.hostnameAndPort,i.tenant),this.loadAccessToken(e,t,r.homeAccountId,i.hostnameAndPort,i.tenant,n),this.loadRefreshToken(e,t,r.homeAccountId,i.hostnameAndPort))}}}return this.generateAuthenticationResult(e,a,l,r,i)}loadAccount(e,t,n,a){if(this.isBrowserEnvironment){let l;if(this.logger.verbose("TokenCache - loading account"),a?l=a:void 0!==t.authorityType&&n&&(l=k.d.generateHomeAccountId(n,t.authorityType,this.logger,this.cryptoObj,e)),!l)throw(0,q.bD)(V.s9);const r=rt(this.storage,t,l,e,le.u,n,t.hostnameAndPort,e.tid,void 0,void 0,this.logger);return this.storage.setAccount(r),r}throw(0,q.bD)(V.s9)}loadIdToken(e,t,n,a){const l=b.c_(t,n,e,this.config.auth.clientId,a);if(this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading id token"),this.storage.setIdTokenCredential(l),l;throw(0,q.bD)(V.s9)}loadAccessToken(e,t,n,a,l,i){if(!t.access_token)return this.logger.verbose("TokenCache - No access token provided for caching"),null;if(!t.expires_in||!i.extendedExpiresOn)throw(0,q.bD)(V.s9);const r=new me.l(e.scopes).printScopes(),o=i.expiresOn||t.expires_in+(new Date).getTime()/1e3,u=b.Np(n,a,t.access_token,this.config.auth.clientId,l,r,o,i.extendedExpiresOn,le.u);if(this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading access token"),this.storage.setAccessTokenCredential(u),u;throw(0,q.bD)(V.s9)}loadRefreshToken(e,t,n,a){if(!t.refresh_token)return this.logger.verbose("TokenCache - No refresh token provided for caching"),null;const l=b.Mg(n,a,t.refresh_token,this.config.auth.clientId);if(this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading refresh token"),this.storage.setRefreshTokenCredential(l),l;throw(0,q.bD)(V.s9)}generateAuthenticationResult(e,t,n,a,l){let d,i=h.YM.EMPTY_STRING,r=[],o=null;return n?.accessToken&&(i=n.accessToken.secret,r=me.l.fromString(n.accessToken.target).asArray(),o=new Date(1e3*Number(n.accessToken.expiresOn)),d=new Date(1e3*Number(n.accessToken.extendedExpiresOn))),{authority:l?l.canonicalAuthority:h.YM.EMPTY_STRING,uniqueId:t.oid||t.sub||h.YM.EMPTY_STRING,tenantId:t.tid||h.YM.EMPTY_STRING,scopes:r,account:a.getAccountInfo(),idToken:n.idToken?.secret||"",idTokenClaims:t||{},accessToken:i,fromCache:!0,expiresOn:o,correlationId:e.correlationId||h.YM.EMPTY_STRING,requestId:h.YM.EMPTY_STRING,extExpiresOn:d,familyId:h.YM.EMPTY_STRING,tokenType:n?.accessToken?.tokenType||h.YM.EMPTY_STRING,state:h.YM.EMPTY_STRING,cloudGraphHostName:a.cloudGraphHostName||h.YM.EMPTY_STRING,msGraphHost:a.msGraphHost||h.YM.EMPTY_STRING,code:void 0,fromNativeBroker:!1}}}class Yt extends Ve{constructor(e){super(e),this.includeRedirectUri=!1}}class zt extends ke{constructor(e,t,n,a,l,i,r,o,d,u){super(e,t,n,a,l,i,o,d,u),this.apiId=r}acquireToken(e){var t=this;return(0,c.A)(function*(){if(!e.code)throw(0,q.bD)(V.R3);const n=yield p(t.initializeAuthorizationRequest.bind(t),T.MX.StandardInteractionClientInitializeAuthorizationRequest,t.logger,t.performanceClient,e.correlationId)(e,_.X8.Silent),a=t.initializeServerTelemetryManager(t.apiId);try{const l={...n,code:e.code},i=yield p(t.getClientConfiguration.bind(t),T.MX.StandardInteractionClientGetClientConfiguration,t.logger,t.performanceClient,e.correlationId)(a,n.authority,n.azureCloudOptions,n.account),r=new Yt(i);t.logger.verbose("Auth code client created");const o=new De(r,t.browserStorage,l,t.logger,t.performanceClient);return yield p(o.handleCodeResponseFromServer.bind(o),T.MX.HandleCodeResponseFromServer,t.logger,t.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},n,!1)}catch(l){throw l instanceof N.lR&&(l.setCorrelationId(t.correlationId),a.cacheFailedRequest(l)),l}})()}logout(){return Promise.reject((0,q.bD)(V.v7))}}function Re(M){const e=M?.idTokenClaims;return e?.tfp||e?.acr?"B2C":e?.tid?"9188040d-6c67-4c5b-b112-36a304b66dad"===e?.tid?"MSA":"AAD":void 0}class lt{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new s.M(this.logger,this.performanceClient):C.j,this.eventHandler=new Xe.J(this.logger,this.browserCrypto),this.browserStorage=this.isBrowserEnvironment?new xe(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,function j(M){const e=M.cloudDiscoveryMetadata;let t;if(e)try{t=JSON.parse(e)}catch{throw(0,D.aD)(L.a_)}return{canonicalAuthority:M.authority?B(M.authority):void 0,knownAuthorities:M.knownAuthorities,cloudDiscoveryMetadata:t}}(this.config.auth),this.performanceClient):((M,e)=>new xe(this.config.auth.clientId,{cacheLocation:_.Al.MemoryStorage,temporaryCacheLocation:_.Al.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1},C.j,this.logger))(),this.nativeInternalStorage=new xe(this.config.auth.clientId,{cacheLocation:_.Al.MemoryStorage,temporaryCacheLocation:_.Al.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1},this.browserCrypto,this.logger,void 0,this.performanceClient),this.tokenCache=new qt(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static createController(e){return(0,c.A)(function*(){const t=new lt(e);return yield t.initialize(),t})()}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}initialize(){var e=this;return(0,c.A)(function*(){if(e.logger.trace("initialize called"),e.initialized)return void e.logger.info("initialize has already been called, exiting early.");const t=e.config.system.allowNativeBroker,n=e.performanceClient.startMeasurement(T.MX.InitializeClientApplication);if(e.eventHandler.emitEvent(Z.B.INITIALIZE_START),t)try{e.nativeExtensionProvider=yield Ee.createProvider(e.logger,e.config.system.nativeBrokerHandshakeTimeout,e.performanceClient)}catch(a){e.logger.verbose(a)}e.config.cache.claimsBasedCachingEnabled||(e.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),yield p(e.browserStorage.clearTokensAndKeysWithClaims.bind(e.browserStorage),T.MX.ClearTokensAndKeysWithClaims,e.logger,e.performanceClient)(e.performanceClient)),e.initialized=!0,e.eventHandler.emitEvent(Z.B.INITIALIZE_END),n.end({allowNativeBroker:t,success:!0})})()}handleRedirectPromise(e){var t=this;return(0,c.A)(function*(){if(t.logger.verbose("handleRedirectPromise called"),(0,oe.uh)(t.initialized),t.isBrowserEnvironment){const n=e||"";let a=t.redirectResponse.get(n);return typeof a>"u"?(a=t.handleRedirectPromiseInternal(e),t.redirectResponse.set(n,a),t.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):t.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),a}return t.logger.verbose("handleRedirectPromise returns null, not browser environment"),null})()}handleRedirectPromiseInternal(e){var t=this;return(0,c.A)(function*(){const n=t.getAllAccounts(),a=t.browserStorage.getCachedNativeRequest(),l=a&&Ee.isNativeAvailable(t.config,t.logger,t.nativeExtensionProvider)&&t.nativeExtensionProvider&&!e,i=l?a?.correlationId:t.browserStorage.getTemporaryCache(_._p.CORRELATION_ID,!0)||"",r=t.performanceClient.startMeasurement("acquireTokenRedirect",i);let o;if(t.eventHandler.emitEvent(Z.B.HANDLE_REDIRECT_START,_.X8.Redirect),l&&t.nativeExtensionProvider){t.logger.trace("handleRedirectPromise - acquiring token from native platform");const d=new Ne(t.config,t.browserStorage,t.browserCrypto,t.logger,t.eventHandler,t.navigationClient,_.sA.handleRedirectPromise,t.performanceClient,t.nativeExtensionProvider,a.accountId,t.nativeInternalStorage,a.correlationId);o=p(d.handleRedirectPromise.bind(d),T.MX.HandleNativeRedirectPromiseMeasurement,t.logger,t.performanceClient,r.event.correlationId)(t.performanceClient,r.event.correlationId)}else{t.logger.trace("handleRedirectPromise - acquiring token from web flow");const d=t.createRedirectClient(i);o=p(d.handleRedirectPromise.bind(d),T.MX.HandleRedirectPromiseMeasurement,t.logger,t.performanceClient,r.event.correlationId)(e,r)}return o.then(d=>(d?(n.length<t.getAllAccounts().length?(t.eventHandler.emitEvent(Z.B.LOGIN_SUCCESS,_.X8.Redirect,d),t.logger.verbose("handleRedirectResponse returned result, login success")):(t.eventHandler.emitEvent(Z.B.ACQUIRE_TOKEN_SUCCESS,_.X8.Redirect,d),t.logger.verbose("handleRedirectResponse returned result, acquire token success")),r.end({success:!0,accountType:Re(d.account)})):r.event.errorCode?r.end({success:!1}):r.discard(),t.eventHandler.emitEvent(Z.B.HANDLE_REDIRECT_END,_.X8.Redirect),d)).catch(d=>{const u=d;throw t.eventHandler.emitEvent(n.length>0?Z.B.ACQUIRE_TOKEN_FAILURE:Z.B.LOGIN_FAILURE,_.X8.Redirect,null,u),t.eventHandler.emitEvent(Z.B.HANDLE_REDIRECT_END,_.X8.Redirect),r.end({success:!1},u),d})})()}acquireTokenRedirect(e){var t=this;return(0,c.A)(function*(){const n=t.getRequestCorrelationId(e);t.logger.verbose("acquireTokenRedirect called",n),(0,oe.Af)(t.initialized,t.config),t.browserStorage.setInteractionInProgress(!0);const a=t.getAllAccounts().length>0;let l;return t.eventHandler.emitEvent(a?Z.B.ACQUIRE_TOKEN_START:Z.B.LOGIN_START,_.X8.Redirect,e),l=t.nativeExtensionProvider&&t.canUseNative(e)?new Ne(t.config,t.browserStorage,t.browserCrypto,t.logger,t.eventHandler,t.navigationClient,_.sA.acquireTokenRedirect,t.performanceClient,t.nativeExtensionProvider,t.getNativeAccountId(e),t.nativeInternalStorage,n).acquireTokenRedirect(e).catch(r=>{if(r instanceof Se&&Ue(r))return t.nativeExtensionProvider=void 0,t.createRedirectClient(n).acquireToken(e);if(r instanceof $.CB)return t.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),t.createRedirectClient(n).acquireToken(e);throw t.browserStorage.setInteractionInProgress(!1),r}):t.createRedirectClient(n).acquireToken(e),l.catch(i=>{throw t.eventHandler.emitEvent(a?Z.B.ACQUIRE_TOKEN_FAILURE:Z.B.LOGIN_FAILURE,_.X8.Redirect,null,i),i})})()}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(T.MX.AcquireTokenPopup,t);n.add({scenarioId:e.scenarioId,accountType:Re(e.account)});try{this.logger.verbose("acquireTokenPopup called",t),(0,oe.Q3)(this.initialized),this.browserStorage.setInteractionInProgress(!0)}catch(i){return Promise.reject(i)}const a=this.getAllAccounts();let l;return this.eventHandler.emitEvent(a.length>0?Z.B.ACQUIRE_TOKEN_START:Z.B.LOGIN_START,_.X8.Popup,e),l=this.canUseNative(e)?this.acquireTokenNative({...e,correlationId:t},_.sA.acquireTokenPopup).then(i=>(this.browserStorage.setInteractionInProgress(!1),n.end({success:!0,isNativeBroker:!0,requestId:i.requestId,accountType:Re(i.account)}),i)).catch(i=>{if(i instanceof Se&&Ue(i))return this.nativeExtensionProvider=void 0,this.createPopupClient(t).acquireToken(e);if(i instanceof $.CB)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),i}):this.createPopupClient(t).acquireToken(e),l.then(i=>(a.length<this.getAllAccounts().length?this.eventHandler.emitEvent(Z.B.LOGIN_SUCCESS,_.X8.Popup,i):this.eventHandler.emitEvent(Z.B.ACQUIRE_TOKEN_SUCCESS,_.X8.Popup,i),n.end({success:!0,requestId:i.requestId,accessTokenSize:i.accessToken.length,idTokenSize:i.idToken.length,accountType:Re(i.account)}),i)).catch(i=>(this.eventHandler.emitEvent(a.length>0?Z.B.ACQUIRE_TOKEN_FAILURE:Z.B.LOGIN_FAILURE,_.X8.Popup,null,i),n.end({success:!1},i),Promise.reject(i)))}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}ssoSilent(e){var t=this;return(0,c.A)(function*(){const n=t.getRequestCorrelationId(e),a={...e,prompt:e.prompt,correlationId:n};let l;return(0,oe.Q3)(t.initialized),t.ssoSilentMeasurement=t.performanceClient.startMeasurement(T.MX.SsoSilent,n),t.ssoSilentMeasurement?.increment({visibilityChangeCount:0}),t.ssoSilentMeasurement?.add({scenarioId:e.scenarioId,accountType:Re(e.account)}),document.addEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement),t.logger.verbose("ssoSilent called",n),t.eventHandler.emitEvent(Z.B.SSO_SILENT_START,_.X8.Silent,a),l=t.canUseNative(a)?t.acquireTokenNative(a,_.sA.ssoSilent).catch(i=>{if(i instanceof Se&&Ue(i))return t.nativeExtensionProvider=void 0,t.createSilentIframeClient(a.correlationId).acquireToken(a);throw i}):t.createSilentIframeClient(a.correlationId).acquireToken(a),l.then(i=>(t.eventHandler.emitEvent(Z.B.SSO_SILENT_SUCCESS,_.X8.Silent,i),t.ssoSilentMeasurement?.end({success:!0,isNativeBroker:i.fromNativeBroker,requestId:i.requestId,accessTokenSize:i.accessToken.length,idTokenSize:i.idToken.length,accountType:Re(i.account)}),i)).catch(i=>{throw t.eventHandler.emitEvent(Z.B.SSO_SILENT_FAILURE,_.X8.Silent,null,i),t.ssoSilentMeasurement?.end({success:!1},i),i}).finally(()=>{document.removeEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement)})})()}acquireTokenByCode(e){var t=this;return(0,c.A)(function*(){const n=t.getRequestCorrelationId(e);t.logger.trace("acquireTokenByCode called",n),(0,oe.Q3)(t.initialized),t.eventHandler.emitEvent(Z.B.ACQUIRE_TOKEN_BY_CODE_START,_.X8.Silent,e);const a=t.performanceClient.startMeasurement(T.MX.AcquireTokenByCode,n);a.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw(0,q.bD)(V.$c);if(e.code){const l=e.code;let i=t.hybridAuthCodeResponses.get(l);return i?(t.logger.verbose("Existing acquireTokenByCode request found",n),a.discard()):(t.logger.verbose("Initiating new acquireTokenByCode request",n),i=t.acquireTokenByCodeAsync({...e,correlationId:n}).then(r=>(t.eventHandler.emitEvent(Z.B.ACQUIRE_TOKEN_BY_CODE_SUCCESS,_.X8.Silent,r),t.hybridAuthCodeResponses.delete(l),a.end({success:!0,isNativeBroker:r.fromNativeBroker,requestId:r.requestId,accessTokenSize:r.accessToken.length,idTokenSize:r.idToken.length,accountType:Re(r.account)}),r)).catch(r=>{throw t.hybridAuthCodeResponses.delete(l),t.eventHandler.emitEvent(Z.B.ACQUIRE_TOKEN_BY_CODE_FAILURE,_.X8.Silent,null,r),a.end({success:!1},r),r}),t.hybridAuthCodeResponses.set(l,i)),yield i}if(e.nativeAccountId){if(t.canUseNative(e,e.nativeAccountId)){const l=yield t.acquireTokenNative({...e,correlationId:n},_.sA.acquireTokenByCode,e.nativeAccountId).catch(i=>{throw i instanceof Se&&Ue(i)&&(t.nativeExtensionProvider=void 0),i});return a.end({accountType:Re(l.account),success:!0}),l}throw(0,q.bD)(V.gU)}throw(0,q.bD)(V.xp)}catch(l){throw t.eventHandler.emitEvent(Z.B.ACQUIRE_TOKEN_BY_CODE_FAILURE,_.X8.Silent,null,l),a.end({success:!1},l),l}})()}acquireTokenByCodeAsync(e){var t=this;return(0,c.A)(function*(){return t.logger.trace("acquireTokenByCodeAsync called",e.correlationId),t.acquireTokenByCodeAsyncMeasurement=t.performanceClient.startMeasurement(T.MX.AcquireTokenByCodeAsync,e.correlationId),t.acquireTokenByCodeAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement),yield t.createSilentAuthCodeClient(e.correlationId).acquireToken(e).then(l=>(t.acquireTokenByCodeAsyncMeasurement?.end({success:!0,fromCache:l.fromCache,isNativeBroker:l.fromNativeBroker,requestId:l.requestId}),l)).catch(l=>{throw t.acquireTokenByCodeAsyncMeasurement?.end({success:!1},l),l}).finally(()=>{document.removeEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement)})})()}acquireTokenFromCache(e,t){var n=this;return(0,c.A)(function*(){switch(n.performanceClient.addQueueMeasurement(T.MX.AcquireTokenFromCache,e.correlationId),t){case _.nN.Default:case _.nN.AccessToken:case _.nN.AccessTokenAndRefreshToken:const a=n.createSilentCacheClient(e.correlationId);return p(a.acquireToken.bind(a),T.MX.SilentCacheClientAcquireToken,n.logger,n.performanceClient,e.correlationId)(e);default:throw(0,R.SB)(O.wb)}})()}acquireTokenByRefreshToken(e,t){var n=this;return(0,c.A)(function*(){switch(n.performanceClient.addQueueMeasurement(T.MX.AcquireTokenByRefreshToken,e.correlationId),t){case _.nN.Default:case _.nN.AccessTokenAndRefreshToken:case _.nN.RefreshToken:case _.nN.RefreshTokenAndNetwork:const a=n.createSilentRefreshClient(e.correlationId);return p(a.acquireToken.bind(a),T.MX.SilentRefreshClientAcquireToken,n.logger,n.performanceClient,e.correlationId)(e);default:throw(0,R.SB)(O.wb)}})()}acquireTokenBySilentIframe(e){var t=this;return(0,c.A)(function*(){t.performanceClient.addQueueMeasurement(T.MX.AcquireTokenBySilentIframe,e.correlationId);const n=t.createSilentIframeClient(e.correlationId);return p(n.acquireToken.bind(n),T.MX.SilentIframeClientAcquireToken,t.logger,t.performanceClient,e.correlationId)(e)})()}logout(e){var t=this;return(0,c.A)(function*(){const n=t.getRequestCorrelationId(e);return t.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",n),t.logoutRedirect({correlationId:n,...e})})()}logoutRedirect(e){var t=this;return(0,c.A)(function*(){const n=t.getRequestCorrelationId(e);return(0,oe.Af)(t.initialized,t.config),t.browserStorage.setInteractionInProgress(!0),t.createRedirectClient(n).logout(e)})()}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return(0,oe.Q3)(this.initialized),this.browserStorage.setInteractionInProgress(!0),this.createPopupClient(t).logout(e)}catch(t){return Promise.reject(t)}}clearCache(e){var t=this;return(0,c.A)(function*(){const n=t.getRequestCorrelationId(e);return t.createSilentCacheClient(n).logout(e)})()}getAllAccounts(e){return this.logger.verbose("getAllAccounts called"),this.isBrowserEnvironment?this.browserStorage.getAllAccounts(e):[]}getAccount(e){if(this.logger.trace("getAccount called"),0===Object.keys(e).length)return this.logger.warning("getAccount: No accountFilter provided"),null;const t=this.browserStorage.getAccountInfoFilteredBy(e);return t?(this.logger.verbose("getAccount: Account matching provided filter found, returning"),t):(this.logger.verbose("getAccount: No matching account found, returning null"),null)}getAccountByUsername(e){if(this.logger.trace("getAccountByUsername called"),!e)return this.logger.warning("getAccountByUsername: No username provided"),null;const t=this.browserStorage.getAccountInfoFilteredBy({username:e});return t?(this.logger.verbose("getAccountByUsername: Account matching username found, returning"),this.logger.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${e}`),t):(this.logger.verbose("getAccountByUsername: No matching account found, returning null"),null)}getAccountByHomeId(e){if(this.logger.trace("getAccountByHomeId called"),!e)return this.logger.warning("getAccountByHomeId: No homeAccountId provided"),null;const t=this.browserStorage.getAccountInfoFilteredBy({homeAccountId:e});return t?(this.logger.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),this.logger.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${e}`),t):(this.logger.verbose("getAccountByHomeId: No matching account found, returning null"),null)}getAccountByLocalId(e){if(this.logger.trace("getAccountByLocalId called"),!e)return this.logger.warning("getAccountByLocalId: No localAccountId provided"),null;const t=this.browserStorage.getAccountInfoFilteredBy({localAccountId:e});return t?(this.logger.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),this.logger.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${e}`),t):(this.logger.verbose("getAccountByLocalId: No matching account found, returning null"),null)}setActiveAccount(e){this.browserStorage.setActiveAccount(e)}getActiveAccount(){return this.browserStorage.getActiveAccount()}hydrateCache(e,t){var n=this;return(0,c.A)(function*(){n.logger.verbose("hydrateCache called");const a=k.d.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return n.browserStorage.setAccount(a),e.fromNativeBroker?(n.logger.verbose("Response was from native broker, storing in-memory"),n.nativeInternalStorage.hydrateCache(e,t)):n.browserStorage.hydrateCache(e,t)})()}acquireTokenNative(e,t,n){var a=this;return(0,c.A)(function*(){if(a.logger.trace("acquireTokenNative called"),!a.nativeExtensionProvider)throw(0,q.bD)(V.XC);return new Ne(a.config,a.browserStorage,a.browserCrypto,a.logger,a.eventHandler,a.navigationClient,t,a.performanceClient,a.nativeExtensionProvider,n||a.getNativeAccountId(e),a.nativeInternalStorage,e.correlationId).acquireToken(e)})()}canUseNative(e,t){if(this.logger.trace("canUseNative called"),!Ee.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUseNative: isNativeAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case h._M.NONE:case h._M.CONSENT:case h._M.LOGIN:this.logger.trace("canUseNative: prompt is compatible with native flow");break;default:return this.logger.trace(`canUseNative: prompt = ${e.prompt} is not compatible with native flow, returning false`),!1}return!(!t&&!this.getNativeAccountId(e)&&(this.logger.trace("canUseNative: nativeAccountId is not available, returning false"),1))}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new Zt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createRedirectClient(e){return new _t(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentIframeClient(e){return new $t(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,_.sA.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentCacheClient(e){return new yt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentRefreshClient(e){return new jt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentAuthCodeClient(e){return new zt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,_.sA.acquireTokenByCode,this.performanceClient,this.nativeExtensionProvider,e)}addEventCallback(e){return this.eventHandler.addEventCallback(e)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){this.eventHandler.enableAccountStorageEvents()}disableAccountStorageEvents(){this.eventHandler.disableAccountStorageEvents()}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getEventHandler(){return this.eventHandler}getRequestCorrelationId(e){return e?.correlationId?e.correlationId:this.isBrowserEnvironment?(0,ve.Oy)():h.YM.EMPTY_STRING}loginRedirect(e){var t=this;return(0,c.A)(function*(){const n=t.getRequestCorrelationId(e);return t.logger.verbose("loginRedirect called",n),t.acquireTokenRedirect({correlationId:n,...e||_.uq})})()}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||_.uq})}acquireTokenSilent(e){var t=this;return(0,c.A)(function*(){const n=t.getRequestCorrelationId(e),a=t.performanceClient.startMeasurement(T.MX.AcquireTokenSilent,n);a.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),(0,oe.Q3)(t.initialized),t.logger.verbose("acquireTokenSilent called",n);const l=e.account||t.getActiveAccount();if(!l)throw(0,q.bD)(V.rR);a.add({accountType:Re(l)});const r=JSON.stringify({clientId:t.config.auth.clientId,authority:e.authority||h.YM.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:l.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,shrOptions:e.shrOptions}),o=t.activeSilentTokenRequests.get(r);if(typeof o>"u"){t.logger.verbose("acquireTokenSilent called for the first time, storing active request",n);const d=p(t.acquireTokenSilentAsync.bind(t),T.MX.AcquireTokenSilentAsync,t.logger,t.performanceClient,n)({...e,correlationId:n},l).then(u=>(t.activeSilentTokenRequests.delete(r),a.end({success:!0,fromCache:u.fromCache,isNativeBroker:u.fromNativeBroker,cacheLookupPolicy:e.cacheLookupPolicy,requestId:u.requestId,accessTokenSize:u.accessToken.length,idTokenSize:u.idToken.length}),u)).catch(u=>{throw t.activeSilentTokenRequests.delete(r),a.end({success:!1},u),u});return t.activeSilentTokenRequests.set(r,d),{...yield d,state:e.state}}return t.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",n),a.discard(),{...yield o,state:e.state}})()}acquireTokenSilentAsync(e,t){var n=this;return(0,c.A)(function*(){n.performanceClient.addQueueMeasurement(T.MX.AcquireTokenSilentAsync,e.correlationId),n.eventHandler.emitEvent(Z.B.ACQUIRE_TOKEN_START,_.X8.Silent,e),e.correlationId&&n.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",()=>n.trackPageVisibility(e.correlationId));const a=yield p(Ie,T.MX.InitializeSilentRequest,n.logger,n.performanceClient,e.correlationId)(e,t,n.config,n.performanceClient,n.logger),l=e.cacheLookupPolicy||_.nN.Default;return n.acquireTokenSilentNoIframe(a,l).catch(function(){var r=(0,c.A)(function*(o){if(function Xt(M,e){const a=!(M instanceof $.CB&&M.subError!==H.j9)&&(M.errorCode===_.Q1.INVALID_GRANT_ERROR||M.errorCode===O.wb)||M.errorCode===H.oF||M.errorCode===H.AG,l=_.JE.includes(e);return a&&l}(o,l)){if(n.activeIframeRequest){if(l!==_.nN.Skip){const[u,m]=n.activeIframeRequest;n.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${m}`,a.correlationId);const I=n.performanceClient.startMeasurement(T.MX.AwaitConcurrentIframe,a.correlationId);I.add({awaitIframeCorrelationId:m});const K=yield u;if(I.end({success:K}),K)return n.logger.verbose(`Parallel iframe request with correlationId: ${m} succeeded. Retrying cache and/or RT redemption`,a.correlationId),n.acquireTokenSilentNoIframe(a,l);throw n.logger.info(`Iframe request with correlationId: ${m} failed. Interaction is required.`),o}return n.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",a.correlationId),p(n.acquireTokenBySilentIframe.bind(n),T.MX.AcquireTokenBySilentIframe,n.logger,n.performanceClient,a.correlationId)(a)}{let u;return n.activeIframeRequest=[new Promise(m=>{u=m}),a.correlationId],n.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",a.correlationId),p(n.acquireTokenBySilentIframe.bind(n),T.MX.AcquireTokenBySilentIframe,n.logger,n.performanceClient,a.correlationId)(a).then(m=>(u(!0),m)).catch(m=>{throw u(!1),m}).finally(()=>{n.activeIframeRequest=void 0})}}throw o});return function(o){return r.apply(this,arguments)}}()).then(r=>(n.eventHandler.emitEvent(Z.B.ACQUIRE_TOKEN_SUCCESS,_.X8.Silent,r),e.correlationId&&n.performanceClient.addFields({fromCache:r.fromCache,isNativeBroker:r.fromNativeBroker,requestId:r.requestId},e.correlationId),r)).catch(r=>{throw n.eventHandler.emitEvent(Z.B.ACQUIRE_TOKEN_FAILURE,_.X8.Silent,null,r),r}).finally(()=>{document.removeEventListener("visibilitychange",()=>n.trackPageVisibility(e.correlationId))})})()}acquireTokenSilentNoIframe(e,t){var n=this;return(0,c.A)(function*(){return Ee.isNativeAvailable(n.config,n.logger,n.nativeExtensionProvider,e.authenticationScheme)&&e.account.nativeAccountId?(n.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),n.acquireTokenNative(e,_.sA.acquireTokenSilent_silentFlow).catch(function(){var a=(0,c.A)(function*(l){throw l instanceof Se&&Ue(l)?(n.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),n.nativeExtensionProvider=void 0,(0,R.SB)(O.wb)):l});return function(l){return a.apply(this,arguments)}}())):(n.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),p(n.acquireTokenFromCache.bind(n),T.MX.AcquireTokenFromCache,n.logger,n.performanceClient,e.correlationId)(e,t).catch(a=>{if(t===_.nN.AccessToken)throw a;return n.eventHandler.emitEvent(Z.B.ACQUIRE_TOKEN_NETWORK_START,_.X8.Silent,e),p(n.acquireTokenByRefreshToken.bind(n),T.MX.AcquireTokenByRefreshToken,n.logger,n.performanceClient,e.correlationId)(e,t)}))})()}}},1510:(J,F,g)=>{g.d(F,{Oy:()=>N,RI:()=>L,RW:()=>G,TZ:()=>b,UY:()=>p,W6:()=>P,YZ:()=>k,_S:()=>j,sI:()=>T});var c=g(467),s=g(6810),C=g(4561),v=g(7554),y=g(8576),E=g(6588);const h="SHA-256",D=new Uint8Array([1,0,1]),S="0123456789abcdef",U=new Uint32Array(1),Y={name:"RSASSA-PKCS1-v1_5",hash:h,modulusLength:2048,publicExponent:D};function G(x){if(!("crypto"in window))throw x.error("BrowserCrypto: crypto interface is unavailable"),(0,s.bD)(E.rc);x.verbose("BrowserCrypto: modern crypto interface available")}function T(x,z,W){return X.apply(this,arguments)}function X(){return(X=(0,c.A)(function*(x,z,W){z?.addQueueMeasurement(C.MX.Sha256Digest,W);const ne=(new TextEncoder).encode(x);return window.crypto.subtle.digest(h,ne)})).apply(this,arguments)}function p(x){return window.crypto.getRandomValues(x)}function A(){return window.crypto.getRandomValues(U),U[0]}function N(){const x=Date.now(),z=1024*A()+(1023&A()),W=new Uint8Array(16),te=Math.trunc(z/2**30),ne=z&2**30-1,re=A();W[0]=x/2**40,W[1]=x/2**32,W[2]=x/2**24,W[3]=x/65536,W[4]=x/256,W[5]=x,W[6]=112|te>>>8,W[7]=te,W[8]=128|ne>>>24,W[9]=ne>>>16,W[10]=ne>>>8,W[11]=ne,W[12]=re>>>24,W[13]=re>>>16,W[14]=re>>>8,W[15]=re;let de="";for(let q=0;q<W.length;q++)de+=S.charAt(W[q]>>>4),de+=S.charAt(15&W[q]),(3===q||5===q||7===q||9===q)&&(de+="-");return de}function b(x,z){return O.apply(this,arguments)}function O(){return(O=(0,c.A)(function*(x,z){return window.crypto.subtle.generateKey(Y,x,z)})).apply(this,arguments)}function L(x){return w.apply(this,arguments)}function w(){return(w=(0,c.A)(function*(x){return window.crypto.subtle.exportKey(v.jb,x)})).apply(this,arguments)}function P(x,z,W){return B.apply(this,arguments)}function B(){return(B=(0,c.A)(function*(x,z,W){return window.crypto.subtle.importKey(v.jb,x,Y,z,W)})).apply(this,arguments)}function j(x,z){return $.apply(this,arguments)}function $(){return($=(0,c.A)(function*(x,z){return window.crypto.subtle.sign(Y,x,z)})).apply(this,arguments)}function k(x){return H.apply(this,arguments)}function H(){return(H=(0,c.A)(function*(x){const z=yield T(x),W=new Uint8Array(z);return(0,y.dB)(W)})).apply(this,arguments)}},6888:(J,F,g)=>{g.d(F,{M:()=>b});var c=g(467),s=g(4561),C=g(3461);const v="missing_kid_error",y="missing_alg_error",E={[v]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[y]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class R extends C.lR{constructor(w,P){super(w,P),this.name="JoseHeaderError",Object.setPrototypeOf(this,R.prototype)}}function h(L){return new R(L,E[L])}var f=g(7635);class D{constructor(w){this.typ=w.typ,this.alg=w.alg,this.kid=w.kid}static getShrHeaderString(w){if(!w.kid)throw h(v);if(!w.alg)throw h(y);const P=new D({typ:w.typ||f.Lz.Pop,kid:w.kid,alg:w.alg});return JSON.stringify(P)}}var S=g(8576),U=g(379),Y=g(1510),G=g(6810),T=g(7554),X=g(6588);class p{constructor(){this.dbName=T.$u,this.version=T.G8,this.tableName=T.WJ,this.dbOpen=!1}open(){var w=this;return(0,c.A)(function*(){return new Promise((P,B)=>{const j=window.indexedDB.open(w.dbName,w.version);j.addEventListener("upgradeneeded",$=>{$.target.result.createObjectStore(w.tableName)}),j.addEventListener("success",$=>{w.db=$.target.result,w.dbOpen=!0,P()}),j.addEventListener("error",()=>B((0,G.bD)(X.MG)))})})()}closeConnection(){const w=this.db;w&&this.dbOpen&&(w.close(),this.dbOpen=!1)}validateDbIsOpen(){var w=this;return(0,c.A)(function*(){if(!w.dbOpen)return w.open()})()}getItem(w){var P=this;return(0,c.A)(function*(){return yield P.validateDbIsOpen(),new Promise((B,j)=>{if(!P.db)return j((0,G.bD)(X.rn));const H=P.db.transaction([P.tableName],"readonly").objectStore(P.tableName).get(w);H.addEventListener("success",x=>{const z=x;P.closeConnection(),B(z.target.result)}),H.addEventListener("error",x=>{P.closeConnection(),j(x)})})})()}setItem(w,P){var B=this;return(0,c.A)(function*(){return yield B.validateDbIsOpen(),new Promise((j,$)=>{if(!B.db)return $((0,G.bD)(X.rn));const x=B.db.transaction([B.tableName],"readwrite").objectStore(B.tableName).put(P,w);x.addEventListener("success",()=>{B.closeConnection(),j()}),x.addEventListener("error",z=>{B.closeConnection(),$(z)})})})()}removeItem(w){var P=this;return(0,c.A)(function*(){return yield P.validateDbIsOpen(),new Promise((B,j)=>{if(!P.db)return j((0,G.bD)(X.rn));const H=P.db.transaction([P.tableName],"readwrite").objectStore(P.tableName).delete(w);H.addEventListener("success",()=>{P.closeConnection(),B()}),H.addEventListener("error",x=>{P.closeConnection(),j(x)})})})()}getKeys(){var w=this;return(0,c.A)(function*(){return yield w.validateDbIsOpen(),new Promise((P,B)=>{if(!w.db)return B((0,G.bD)(X.rn));const k=w.db.transaction([w.tableName],"readonly").objectStore(w.tableName).getAllKeys();k.addEventListener("success",H=>{const x=H;w.closeConnection(),P(x.target.result)}),k.addEventListener("error",H=>{w.closeConnection(),B(H)})})})()}containsKey(w){var P=this;return(0,c.A)(function*(){return yield P.validateDbIsOpen(),new Promise((B,j)=>{if(!P.db)return j((0,G.bD)(X.rn));const H=P.db.transaction([P.tableName],"readonly").objectStore(P.tableName).count(w);H.addEventListener("success",x=>{const z=x;P.closeConnection(),B(1===z.target.result)}),H.addEventListener("error",x=>{P.closeConnection(),j(x)})})})()}deleteDatabase(){var w=this;return(0,c.A)(function*(){return w.db&&w.dbOpen&&w.closeConnection(),new Promise((P,B)=>{const j=window.indexedDB.deleteDatabase(T.$u),$=setTimeout(()=>B(!1),200);j.addEventListener("success",()=>(clearTimeout($),P(!0))),j.addEventListener("blocked",()=>(clearTimeout($),P(!0))),j.addEventListener("error",()=>(clearTimeout($),B(!1)))})})()}}var A=g(8390);class N{constructor(w){this.inMemoryCache=new A.X,this.indexedDBCache=new p,this.logger=w}handleDatabaseAccessError(w){if(!(w instanceof G.jT&&w.errorCode===X.MG))throw w;this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.")}getItem(w){var P=this;return(0,c.A)(function*(){const B=P.inMemoryCache.getItem(w);if(!B)try{return P.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),yield P.indexedDBCache.getItem(w)}catch(j){P.handleDatabaseAccessError(j)}return B})()}setItem(w,P){var B=this;return(0,c.A)(function*(){B.inMemoryCache.setItem(w,P);try{yield B.indexedDBCache.setItem(w,P)}catch(j){B.handleDatabaseAccessError(j)}})()}removeItem(w){var P=this;return(0,c.A)(function*(){P.inMemoryCache.removeItem(w);try{yield P.indexedDBCache.removeItem(w)}catch(B){P.handleDatabaseAccessError(B)}})()}getKeys(){var w=this;return(0,c.A)(function*(){const P=w.inMemoryCache.getKeys();if(0===P.length)try{return w.logger.verbose("In-memory cache is empty, now querying persistent storage."),yield w.indexedDBCache.getKeys()}catch(B){w.handleDatabaseAccessError(B)}return P})()}containsKey(w){var P=this;return(0,c.A)(function*(){const B=P.inMemoryCache.containsKey(w);if(!B)try{return P.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),yield P.indexedDBCache.containsKey(w)}catch(j){P.handleDatabaseAccessError(j)}return B})()}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}clearPersistent(){var w=this;return(0,c.A)(function*(){try{w.logger.verbose("Deleting persistent keystore");const P=yield w.indexedDBCache.deleteDatabase();return P&&w.logger.verbose("Persistent keystore deleted"),P}catch(P){return w.handleDatabaseAccessError(P),!1}})()}}let b=(()=>{class L{constructor(P,B){this.logger=P,(0,Y.RW)(P),this.cache=new N(this.logger),this.performanceClient=B}createNewGuid(){return(0,Y.Oy)()}base64Encode(P){return(0,S.KA)(P)}base64Decode(P){return(0,U.u)(P)}getPublicKeyThumbprint(P){var B=this;return(0,c.A)(function*(){const j=B.performanceClient?.startMeasurement(s.MX.CryptoOptsGetPublicKeyThumbprint,P.correlationId),$=yield(0,Y.TZ)(L.EXTRACTABLE,L.POP_KEY_USAGES),k=yield(0,Y.RI)($.publicKey),x=O({e:k.e,kty:k.kty,n:k.n}),z=yield B.hashString(x),W=yield(0,Y.RI)($.privateKey),te=yield(0,Y.W6)(W,!1,["sign"]);return yield B.cache.setItem(z,{privateKey:te,publicKey:$.publicKey,requestMethod:P.resourceRequestMethod,requestUri:P.resourceRequestUri}),j&&j.end({success:!0}),z})()}removeTokenBindingKey(P){var B=this;return(0,c.A)(function*(){return yield B.cache.removeItem(P),!(yield B.cache.containsKey(P))})()}clearKeystore(){var P=this;return(0,c.A)(function*(){P.cache.clearInMemory();try{return yield P.cache.clearPersistent(),!0}catch(B){return B instanceof Error?P.logger.error(`Clearing keystore failed with error: ${B.message}`):P.logger.error("Clearing keystore failed with unknown error"),!1}})()}signJwt(P,B,j,$){var k=this;return(0,c.A)(function*(){const H=k.performanceClient?.startMeasurement(s.MX.CryptoOptsSignJwt,$),x=yield k.cache.getItem(B);if(!x)throw(0,G.bD)(X.e0);const z=yield(0,Y.RI)(x.publicKey),W=O(z),te=(0,S.u4)(JSON.stringify({kid:B})),ne=D.getShrHeaderString({...j?.header,alg:z.alg,kid:te}),re=(0,S.u4)(ne);P.cnf={jwk:JSON.parse(W)};const q=`${re}.${(0,S.u4)(JSON.stringify(P))}`,pe=(new TextEncoder).encode(q),fe=yield(0,Y._S)(x.privateKey,pe),ge=`${q}.${(0,S.dB)(new Uint8Array(fe))}`;return H&&H.end({success:!0}),ge})()}hashString(P){return(0,c.A)(function*(){return(0,Y.YZ)(P)})()}}return L.POP_KEY_USAGES=["sign","verify"],L.EXTRACTABLE=!0,L})();function O(L){return JSON.stringify(L,Object.keys(L).sort())}},379:(J,F,g)=>{g.d(F,{u:()=>C});var c=g(6810),s=g(6588);function C(y){return(new TextDecoder).decode(function v(y){let E=y.replace(/-/g,"+").replace(/_/g,"/");switch(E.length%4){case 0:break;case 2:E+="==";break;case 3:E+="=";break;default:throw(0,c.bD)(s._t)}const R=atob(E);return Uint8Array.from(R,h=>h.codePointAt(0)||0)}(y))}},8576:(J,F,g)=>{function c(y){return encodeURIComponent(C(y).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function s(y){return v(y).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function C(y){return v((new TextEncoder).encode(y))}function v(y){const E=Array.from(y,R=>String.fromCodePoint(R)).join("");return btoa(E)}g.d(F,{KA:()=>C,dB:()=>s,u4:()=>c})},6810:(J,F,g)=>{g.d(F,{bD:()=>R,jT:()=>E});var c=g(3461),s=g(6588);const C="For more visit: aka.ms/msaljs/browser-errors",v={[s.p5]:"The PKCE code challenge and verifier could not be generated.",[s.rc]:"The crypto object or function is not available.",[s.B2]:"Navigation URI is empty. Please check stack trace for more info.",[s.wv]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${C}`,[s.c$]:"Hash does not contain state. Please verify that the request originated from msal.",[s.Lm]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${C}`,[s.fA]:"Unable to parse state. Please verify that the request originated from msal.",[s.oe]:"Hash contains state but the interaction type does not match the caller.",[s.b]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${C}`,[s.hs]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[s.MP]:"window.open returned null or undefined window object.",[s.fN]:"User cancelled the flow.",[s.OM]:`Token acquisition in popup failed due to timeout.  ${C}`,[s.Uf]:`Token acquisition in iframe failed due to timeout.  ${C}`,[s.OT]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[s.tZ]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${C}`,[s.aH]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[s.lg]:"The iframe being monitored was closed prematurely.",[s.v7]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[s.rR]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[s.hZ]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[s.y6]:"No token request found in cache.",[s.ot]:"The cached token request could not be parsed.",[s.Ne]:"No cached authority found.",[s.LW]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[s.Mm]:"Invalid cache type",[s.tI]:"Login and token requests are not supported in non-browser environments.",[s.rn]:"Database is not open!",[s.l7]:"No network connectivity. Check your internet connection.",[s.zv]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[s.Zw]:"Network request failed. Please check the network trace to determine root cause.",[s.db]:"Failed to parse network response. Check network trace.",[s.s9]:"Error loading token to cache.",[s.e0]:"Cryptographic Key or Keypair not found in browser storage.",[s.R3]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[s.xp]:"An authorization code or nativeAccountId must be provided to this flow.",[s.$c]:"Request cannot contain both spa code and native account id.",[s.MG]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[s.gU]:`Unable to acquire token from native platform.  ${C}`,[s.y3]:"Timed out while attempting to establish connection to browser extension",[s.cq]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[s.XC]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${C}`,[s.IR]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${C}`,[s.nF]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[s._t]:"Invalid base64 encoded string."};class E extends c.lR{constructor(f){super(f,v[f]),Object.setPrototypeOf(this,E.prototype),this.name="BrowserAuthError"}}function R(h){return new E(h)}},6588:(J,F,g)=>{g.d(F,{$c:()=>q,B2:()=>C,IR:()=>ce,LW:()=>B,Lm:()=>E,MG:()=>_,MP:()=>S,Mm:()=>j,Ne:()=>P,OM:()=>Y,OT:()=>T,R3:()=>re,Uf:()=>G,XC:()=>ge,Zw:()=>z,_t:()=>Fe,aH:()=>p,b:()=>f,c$:()=>y,cq:()=>ue,db:()=>W,e0:()=>ne,fA:()=>R,fN:()=>U,gU:()=>pe,hZ:()=>O,hs:()=>D,l7:()=>H,lg:()=>A,nF:()=>le,oe:()=>h,ot:()=>w,p5:()=>c,rR:()=>b,rc:()=>s,rn:()=>k,s9:()=>te,tI:()=>$,tZ:()=>X,v7:()=>N,wv:()=>v,xp:()=>de,y3:()=>fe,y6:()=>L,zv:()=>x});const c="pkce_not_created",s="crypto_nonexistent",C="empty_navigate_uri",v="hash_empty_error",y="no_state_in_hash",E="hash_does_not_contain_known_properties",R="unable_to_parse_state",h="state_interaction_type_mismatch",f="interaction_in_progress",D="popup_window_error",S="empty_window_error",U="user_cancelled",Y="monitor_popup_timeout",G="monitor_window_timeout",T="redirect_in_iframe",X="block_iframe_reload",p="block_nested_popups",A="iframe_closed_prematurely",N="silent_logout_unsupported",b="no_account_error",O="silent_prompt_value_error",L="no_token_request_cache_error",w="unable_to_parse_token_request_cache_error",P="no_cached_authority_error",B="auth_request_not_set_error",j="invalid_cache_type",$="non_browser_environment",k="database_not_open",H="no_network_connectivity",x="post_request_failed",z="get_request_failed",W="failed_to_parse_response",te="unable_to_load_token",ne="crypto_key_not_found",re="auth_code_required",de="auth_code_or_nativeAccountId_required",q="spa_code_and_nativeAccountId_present",_="database_unavailable",pe="unable_to_acquire_token_from_native_platform",fe="native_handshake_timeout",ue="native_extension_not_installed",ge="native_connection_not_established",ce="uninitialized_public_client_application",le="native_prompt_not_supported",Fe="invalid_base64_string"},4064:(J,F,g)=>{g.d(F,{XX:()=>y,jz:()=>E});var c=g(3461),s=g(3578);const C={[s.xz]:"Given storage configuration option was not supported.",[s.dg]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[s.jE]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};class y extends c.lR{constructor(h,f){super(h,f),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,y.prototype)}}function E(R){return new y(R,C[R])}},3578:(J,F,g)=>{g.d(F,{dg:()=>s,jE:()=>C,xz:()=>c});const c="storage_not_supported",s="stubbed_public_client_application_called",C="in_mem_redirect_unavailable"},1036:(J,F,g)=>{g.d(F,{J:()=>E});var c=g(7635),s=g(1175),C=g(8864),v=g(3212),y=g(1510);class E{constructor(h,f){this.eventCallbacks=new Map,this.logger=h,this.browserCrypto=f,this.listeningToStorageEvents=!1,this.handleAccountCacheChange=this.handleAccountCacheChange.bind(this)}addEventCallback(h){if(typeof window<"u"){const f=(0,y.Oy)();return this.eventCallbacks.set(f,h),this.logger.verbose(`Event callback registered with id: ${f}`),f}return null}removeEventCallback(h){this.eventCallbacks.delete(h),this.logger.verbose(`Event callback ${h} removed.`)}enableAccountStorageEvents(){typeof window>"u"||(this.listeningToStorageEvents?this.logger.verbose("Account storage listener already registered."):(this.logger.verbose("Adding account storage listener."),this.listeningToStorageEvents=!0,window.addEventListener("storage",this.handleAccountCacheChange)))}disableAccountStorageEvents(){typeof window>"u"||(this.listeningToStorageEvents?(this.logger.verbose("Removing account storage listener."),window.removeEventListener("storage",this.handleAccountCacheChange),this.listeningToStorageEvents=!1):this.logger.verbose("No account storage listener registered."))}emitEvent(h,f,D,S){if(typeof window<"u"){const U={eventType:h,interactionType:f||null,payload:D||null,error:S||null,timestamp:Date.now()};this.logger.info(`Emitting event: ${h}`),this.eventCallbacks.forEach((Y,G)=>{this.logger.verbose(`Emitting event to callback ${G}: ${h}`),Y.apply(null,[U])})}}handleAccountCacheChange(h){try{h.key?.includes(c.Gd.ACTIVE_ACCOUNT_FILTERS)&&this.emitEvent(v.B.ACTIVE_ACCOUNT_CHANGED);const f=h.newValue||h.oldValue;if(!f)return;const D=JSON.parse(f);if("object"!=typeof D||!s.d.isAccountEntity(D))return;const U=C.G.toObject(new s.d,D).getAccountInfo();!h.oldValue&&h.newValue?(this.logger.info("Account was added to cache in a different window"),this.emitEvent(v.B.ACCOUNT_ADDED,void 0,U)):!h.newValue&&h.oldValue&&(this.logger.info("Account was removed from cache in a different window"),this.emitEvent(v.B.ACCOUNT_REMOVED,void 0,U))}catch{return}}}},3212:(J,F,g)=>{g.d(F,{B:()=>c});const c={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache"}},7306:(J,F,g)=>{g.d(F,{U:()=>c,r:()=>s});const c="@azure/msal-browser",s="3.14.0"},7554:(J,F,g)=>{g.d(F,{$u:()=>X,Al:()=>y,CC:()=>E,Ct:()=>v,G8:()=>p,H3:()=>f,JD:()=>C,JE:()=>b,L$:()=>O,P3:()=>L,Q1:()=>s,T$:()=>U,WJ:()=>A,X8:()=>S,_p:()=>R,dh:()=>h,f7:()=>T,jb:()=>G,nN:()=>N,sA:()=>D,uq:()=>Y});var c=g(7635);const s={INTERACTION_IN_PROGRESS_VALUE:"interaction_in_progress",INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},C={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS"},v={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},y={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},E={GET:"GET",POST:"POST"},R={AUTHORITY:"authority",ACQUIRE_TOKEN_ACCOUNT:"acquireToken.account",SESSION_STATE:"session.state",REQUEST_STATE:"request.state",NONCE_IDTOKEN:"nonce.id_token",ORIGIN_URI:"request.origin",RENEW_STATUS:"token.renew.status",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",SCOPES:"scopes",INTERACTION_STATUS_KEY:"interaction.status",CCS_CREDENTIAL:"ccs.credential",CORRELATION_ID:"request.correlationId",NATIVE_REQUEST:"request.native",REDIRECT_CONTEXT:"request.redirect.context"},h={ACCOUNT_KEYS:"msal.account.keys",TOKEN_KEYS:"msal.token.keys"},f={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},D={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962};var S=function(P){return P.Redirect="redirect",P.Popup="popup",P.Silent="silent",P.None="none",P}(S||{});const U={Startup:"startup",Login:"login",Logout:"logout",AcquireToken:"acquireToken",SsoSilent:"ssoSilent",HandleRedirect:"handleRedirect",None:"none"},Y={scopes:c.aZ},G="jwk",T={React:"@azure/msal-react",Angular:"@azure/msal-angular"},X="msal.db",p=1,A=`${X}.keys`,N={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},b=[N.Default,N.Skip,N.RefreshTokenAndNetwork],O="msal.browser.log.level",L="msal.browser.log.pii"},1474:(J,F,g)=>{g.d(F,{Af:()=>N,GZ:()=>f,Q3:()=>A,U2:()=>R,Uu:()=>S,VX:()=>U,kZ:()=>b,nQ:()=>h,uh:()=>p});var c=g(1564),s=g(6810),C=g(7554),v=g(4064),y=g(6588),E=g(3578);function R(L){L.location.hash="","function"==typeof L.history.replaceState&&L.history.replaceState(null,"",`${L.location.origin}${L.location.pathname}${L.location.search}`)}function h(L){const w=L.split("#");w.shift(),window.location.hash=w.length>0?w.join("#"):""}function f(){return window.parent!==window}function S(){return window.location.href.split("?")[0].split("#")[0]}function U(){const w=new c.H(window.location.href).getUrlComponents();return`${w.Protocol}//${w.HostNameAndPort}/`}function p(L){if(!L)throw(0,s.bD)(y.IR)}function A(L){(function X(){if(typeof window>"u")throw(0,s.bD)(y.tI)})(),function Y(){if(c.H.hashContainsKnownProperties(window.location.hash)&&f())throw(0,s.bD)(y.tZ)}(),function T(){if(function D(){return typeof window<"u"&&!!window.opener&&window.opener!==window&&"string"==typeof window.name&&0===window.name.indexOf(`${C.Q1.POPUP_NAME_PREFIX}.`)}())throw(0,s.bD)(y.aH)}(),p(L)}function N(L,w){if(A(L),function G(L){if(f()&&!L)throw(0,s.bD)(y.OT)}(w.system.allowRedirectInIframe),w.cache.cacheLocation===C.Al.MemoryStorage&&!w.cache.storeAuthStateInCookie)throw(0,v.jz)(E.jE)}function b(L){const w=document.createElement("link");w.rel="preconnect",w.href=new URL(L).origin,w.crossOrigin="anonymous",document.head.appendChild(w),window.setTimeout(()=>{try{document.head.removeChild(w)}catch{}},1e4)}},495:(J,F,g)=>{function c(v,y){return!!v&&!!y&&v===y.split(".")[1]}function s(v,y){const{oid:E,sub:R,tid:h,name:f,tfp:D,acr:S}=y,U=h||D||S||"";return{tenantId:U,localAccountId:E||R||"",name:f,isHomeTenant:c(U,v)}}function C(v,y,E,R){let h=v;if(y){const{isHomeTenant:f,...D}=y;h={...v,...D}}if(E){const{isHomeTenant:f,...D}=s(v.homeAccountId,E);return h={...h,...D,idTokenClaims:E,idToken:R},h}return h}g.d(F,{aB:()=>c,bi:()=>s,o9:()=>C})},2895:(J,F,g)=>{g.d(F,{My:()=>C,al:()=>y});var c=g(3986),s=g(7172);function C(E,R){const h=function v(E){if(!E)throw(0,c.SB)(s.Bh);const h=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(E);if(!h||h.length<4)throw(0,c.SB)(s.gR);return h[2]}(E);try{const f=R(h);return JSON.parse(f)}catch{throw(0,c.SB)(s.gR)}}function y(E,R){if(0===R||Date.now()-3e5>E+R)throw(0,c.SB)(s.Yh)}},7388:(J,F,g)=>{g.d(F,{Z:()=>y,k:()=>v});var c=g(3986),s=g(7635),C=g(7172);function v(E,R){if(!E)throw(0,c.SB)(C.fY);try{const h=R(E);return JSON.parse(h)}catch{throw(0,c.SB)(C.lP)}}function y(E){if(!E)throw(0,c.SB)(C.lP);const R=E.split(s.LR.CLIENT_INFO_SEPARATOR,2);return{uid:R[0],utid:R.length<2?s.YM.EMPTY_STRING:R[1]}}},8266:(J,F,g)=>{function c(s){return s&&(s.tid||s.tfp||s.acr)||null}g.d(F,{r:()=>c})},2144:(J,F,g)=>{g.d(F,{Bt:()=>R,FI:()=>v,Jr:()=>E,ao:()=>D,hD:()=>f});var c=g(1564),s=g(7635);const v={"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},y={tenant_discovery_endpoint:"https://{canonicalAuthority}/v2.0/.well-known/openid-configuration",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},E=new Set;function R(S,U){let Y;const G=S.canonicalAuthority;if(G){const T=new c.H(G).getUrlComponents().HostNameAndPort;Y=h(T,S.cloudDiscoveryMetadata?.metadata,s.E_.CONFIG,U)||h(T,y.metadata,s.E_.HARDCODED_VALUES,U)||S.knownAuthorities}return Y||[]}function h(S,U,Y,G){if(G?.trace(`getAliasesFromMetadata called with source: ${Y}`),S&&U){const T=D(U,S);if(T)return G?.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${Y}, returning aliases`),T.aliases;G?.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${Y}`)}return null}function f(S){return D(y.metadata,S)}function D(S,U){for(let Y=0;Y<S.length;Y++){const G=S[Y];if(G.aliases.includes(U))return G}return null}y.metadata.forEach(S=>{S.aliases.forEach(U=>{E.add(U)})})},4719:(J,F,g)=>{g.d(F,{_:()=>c});const c={None:"none",AzurePublic:"https://login.microsoftonline.com",AzurePpe:"https://login.windows-ppe.net",AzureChina:"https://login.chinacloudapi.cn",AzureGermany:"https://login.microsoftonline.de",AzureUsGovernment:"https://login.microsoftonline.us"}},6211:(J,F,g)=>{g.d(F,{I:()=>c});const c={Default:0,Adfs:1,Dsts:2,Ciam:3}},2729:(J,F,g)=>{g.d(F,{e:()=>c});const c={AAD:"AAD",OIDC:"OIDC"}},8864:(J,F,g)=>{g.d(F,{G:()=>G,R:()=>T});var c=g(467),s=g(7635),C=g(2376),v=g(6812),y=g(1175),E=g(3986),R=g(495),h=g(2895),f=g(4481),D=g(2144),S=g(6987),U=g(7172),Y=g(1827);class G{constructor(p,A,N,b){this.clientId=p,this.cryptoImpl=A,this.commonLogger=N.clone(f.U,f.r),this.staticAuthorityOptions=b}getAllAccounts(p){return this.buildTenantProfiles(this.getAccountsFilteredBy(p||{}),p)}getAccountInfoFilteredBy(p){const A=this.getAllAccounts(p);return A.length>1?A.sort(b=>b.idTokenClaims?-1:1)[0]:1===A.length?A[0]:null}getBaseAccountInfo(p){const A=this.getAccountsFilteredBy(p);return A.length>0?A[0].getAccountInfo():null}buildTenantProfiles(p,A){return p.flatMap(N=>this.getAccountInfoForTenantProfiles(N,A))}getAccountInfoForTenantProfiles(p,A){return this.getTenantProfilesFromAccountEntity(p,A?.tenantId,A)}getTenantedAccountInfoByFilter(p,A,N,b){let L,O=null;if(b&&!this.tenantProfileMatchesFilter(N,b))return null;const w=this.getIdToken(p,A,N.tenantId);return w&&(L=(0,h.My)(w.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(L,b))?null:(O=(0,R.o9)(p,N,L,w?.secret),O)}getTenantProfilesFromAccountEntity(p,A,N){const b=p.getAccountInfo();let O=b.tenantProfiles||new Map;const L=this.getTokenKeys();if(A){const P=O.get(A);if(!P)return[];O=new Map([[A,P]])}const w=[];return O.forEach(P=>{const B=this.getTenantedAccountInfoByFilter(b,L,P,N);B&&w.push(B)}),w}tenantProfileMatchesFilter(p,A){return!(A.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(p,A.localAccountId)||A.name&&p.name!==A.name||void 0!==A.isHomeTenant&&p.isHomeTenant!==A.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(p,A){return!(A&&(A.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(p,A.localAccountId)||A.loginHint&&!this.matchLoginHintFromTokenClaims(p,A.loginHint)||A.username&&!this.matchUsername(p.preferred_username,A.username)||A.name&&!this.matchName(p,A.name)||A.sid&&!this.matchSid(p,A.sid)))}saveCacheRecord(p,A,N){var b=this;return(0,c.A)(function*(){if(!p)throw(0,E.SB)(U.n4);try{p.account&&b.setAccount(p.account),p.idToken&&!1!==A?.idToken&&b.setIdTokenCredential(p.idToken),p.accessToken&&!1!==A?.accessToken&&(yield b.saveAccessToken(p.accessToken)),p.refreshToken&&!1!==A?.refreshToken&&b.setRefreshTokenCredential(p.refreshToken),p.appMetadata&&b.setAppMetadata(p.appMetadata)}catch(O){throw b.commonLogger?.error("CacheManager.saveCacheRecord: failed"),O instanceof Error?(b.commonLogger?.errorPii(`CacheManager.saveCacheRecord: ${O.message}`,N),"QuotaExceededError"===O.name||"NS_ERROR_DOM_QUOTA_REACHED"===O.name||O.message.includes("exceeded the quota")?(b.commonLogger?.error("CacheManager.saveCacheRecord: exceeded storage quota",N),new S.xA(Y.Z)):new S.xA(O.name,O.message)):(b.commonLogger?.errorPii(`CacheManager.saveCacheRecord: ${O}`,N),new S.xA(Y.Y))}})()}saveAccessToken(p){var A=this;return(0,c.A)(function*(){const N={clientId:p.clientId,credentialType:p.credentialType,environment:p.environment,homeAccountId:p.homeAccountId,realm:p.realm,tokenType:p.tokenType,requestedClaimsHash:p.requestedClaimsHash},b=A.getTokenKeys(),O=v.l.fromString(p.target),L=[];b.accessToken.forEach(w=>{if(!A.accessTokenKeyMatchesFilter(w,N,!1))return;const P=A.getAccessTokenCredential(w);P&&A.credentialMatchesFilter(P,N)&&v.l.fromString(P.target).intersectingScopeSets(O)&&L.push(A.removeAccessToken(w))}),yield Promise.all(L),A.setAccessTokenCredential(p)})()}getAccountsFilteredBy(p){const A=this.getAccountKeys(),N=[];return A.forEach(b=>{if(!this.isAccountKey(b,p.homeAccountId))return;const O=this.getAccount(b,this.commonLogger);if(!O||p.homeAccountId&&!this.matchHomeAccountId(O,p.homeAccountId)||p.username&&!this.matchUsername(O.username,p.username)||p.environment&&!this.matchEnvironment(O,p.environment)||p.realm&&!this.matchRealm(O,p.realm)||p.nativeAccountId&&!this.matchNativeAccountId(O,p.nativeAccountId)||p.authorityType&&!this.matchAuthorityType(O,p.authorityType))return;const L={localAccountId:p?.localAccountId,name:p?.name},w=O.tenantProfiles?.filter(P=>this.tenantProfileMatchesFilter(P,L));w&&0===w.length||N.push(O)}),N}isAccountKey(p,A,N){return!(p.split(s.LR.CACHE_KEY_SEPARATOR).length<3||A&&!p.toLowerCase().includes(A.toLowerCase())||N&&!p.toLowerCase().includes(N.toLowerCase()))}isCredentialKey(p){if(p.split(s.LR.CACHE_KEY_SEPARATOR).length<6)return!1;const A=p.toLowerCase();if(-1===A.indexOf(s.aG.ID_TOKEN.toLowerCase())&&-1===A.indexOf(s.aG.ACCESS_TOKEN.toLowerCase())&&-1===A.indexOf(s.aG.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())&&-1===A.indexOf(s.aG.REFRESH_TOKEN.toLowerCase()))return!1;if(A.indexOf(s.aG.REFRESH_TOKEN.toLowerCase())>-1){const b=`${s.aG.REFRESH_TOKEN}${s.LR.CACHE_KEY_SEPARATOR}${s.hB}${s.LR.CACHE_KEY_SEPARATOR}`;if(-1===A.indexOf(`${s.aG.REFRESH_TOKEN}${s.LR.CACHE_KEY_SEPARATOR}${this.clientId}${s.LR.CACHE_KEY_SEPARATOR}`.toLowerCase())&&-1===A.indexOf(b.toLowerCase()))return!1}else if(-1===A.indexOf(this.clientId.toLowerCase()))return!1;return!0}credentialMatchesFilter(p,A){return!(A.clientId&&!this.matchClientId(p,A.clientId)||A.userAssertionHash&&!this.matchUserAssertionHash(p,A.userAssertionHash)||"string"==typeof A.homeAccountId&&!this.matchHomeAccountId(p,A.homeAccountId)||A.environment&&!this.matchEnvironment(p,A.environment)||A.realm&&!this.matchRealm(p,A.realm)||A.credentialType&&!this.matchCredentialType(p,A.credentialType)||A.familyId&&!this.matchFamilyId(p,A.familyId)||A.target&&!this.matchTarget(p,A.target)||(A.requestedClaimsHash||p.requestedClaimsHash)&&p.requestedClaimsHash!==A.requestedClaimsHash||p.credentialType===s.aG.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(A.tokenType&&!this.matchTokenType(p,A.tokenType)||A.tokenType===s.IO.SSH&&A.keyId&&!this.matchKeyId(p,A.keyId)))}getAppMetadataFilteredBy(p){const A=this.getKeys(),N={};return A.forEach(b=>{if(!this.isAppMetadata(b))return;const O=this.getAppMetadata(b);O&&(p.environment&&!this.matchEnvironment(O,p.environment)||p.clientId&&!this.matchClientId(O,p.clientId)||(N[b]=O))}),N}getAuthorityMetadataByAlias(p){const A=this.getAuthorityMetadataKeys();let N=null;return A.forEach(b=>{if(!this.isAuthorityMetadata(b)||-1===b.indexOf(this.clientId))return;const O=this.getAuthorityMetadata(b);O&&-1!==O.aliases.indexOf(p)&&(N=O)}),N}removeAllAccounts(){var p=this;return(0,c.A)(function*(){const A=p.getAccountKeys(),N=[];A.forEach(b=>{N.push(p.removeAccount(b))}),yield Promise.all(N)})()}removeAccount(p){var A=this;return(0,c.A)(function*(){const N=A.getAccount(p,A.commonLogger);N&&(yield A.removeAccountContext(N),A.removeItem(p))})()}removeAccountContext(p){var A=this;return(0,c.A)(function*(){const N=A.getTokenKeys(),b=p.generateAccountId(),O=[];N.idToken.forEach(L=>{0===L.indexOf(b)&&A.removeIdToken(L)}),N.accessToken.forEach(L=>{0===L.indexOf(b)&&O.push(A.removeAccessToken(L))}),N.refreshToken.forEach(L=>{0===L.indexOf(b)&&A.removeRefreshToken(L)}),yield Promise.all(O)})()}updateOutdatedCachedAccount(p,A,N){if(A&&A.isSingleTenant()){this.commonLogger?.verbose("updateOutdatedCachedAccount: Found a single-tenant (outdated) account entity in the cache, migrating to multi-tenant account entity");const b=this.getAccountKeys().filter(B=>B.startsWith(A.homeAccountId)),O=[];b.forEach(B=>{const j=this.getCachedAccountEntity(B);j&&O.push(j)});const L=O.find(B=>(0,R.aB)(B.realm,B.homeAccountId))||O[0];L.tenantProfiles=O.map(B=>({tenantId:B.realm,localAccountId:B.localAccountId,name:B.name,isHomeTenant:(0,R.aB)(B.realm,B.homeAccountId)}));const w=G.toObject(new y.d,{...L}),P=w.generateAccountKey();return b.forEach(B=>{B!==P&&this.removeOutdatedAccount(p)}),this.setAccount(w),N?.verbose("Updated an outdated account entity in the cache"),w}return A}removeAccessToken(p){var A=this;return(0,c.A)(function*(){const N=A.getAccessTokenCredential(p);if(N){if(N.credentialType.toLowerCase()===s.aG.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&N.tokenType===s.IO.POP){const O=N.keyId;if(O)try{yield A.cryptoImpl.removeTokenBindingKey(O)}catch{throw(0,E.SB)(U.QE)}}return A.removeItem(p)}})()}removeAppMetadata(){return this.getKeys().forEach(A=>{this.isAppMetadata(A)&&this.removeItem(A)}),!0}readAccountFromCache(p){const A=y.d.generateAccountCacheKey(p);return this.getAccount(A,this.commonLogger)}getIdToken(p,A,N,b,O){this.commonLogger.trace("CacheManager - getIdToken called");const w=this.getIdTokensByFilter({homeAccountId:p.homeAccountId,environment:p.environment,credentialType:s.aG.ID_TOKEN,clientId:this.clientId,realm:N},A),P=w.size;if(P<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(P>1){let B=w;if(!N){const j=new Map;w.forEach((k,H)=>{k.realm===p.tenantId&&j.set(H,k)});const $=j.size;if($<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),w.values().next().value;if(1===$)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),j.values().next().value;B=j}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),B.forEach((j,$)=>{this.removeIdToken($)}),b&&O&&b.addFields({multiMatchedID:w.size},O),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),w.values().next().value}getIdTokensByFilter(p,A){const N=A&&A.idToken||this.getTokenKeys().idToken,b=new Map;return N.forEach(O=>{if(!this.idTokenKeyMatchesFilter(O,{clientId:this.clientId,...p}))return;const L=this.getIdTokenCredential(O);L&&this.credentialMatchesFilter(L,p)&&b.set(O,L)}),b}idTokenKeyMatchesFilter(p,A){const N=p.toLowerCase();return!(A.clientId&&-1===N.indexOf(A.clientId.toLowerCase())||A.homeAccountId&&-1===N.indexOf(A.homeAccountId.toLowerCase()))}removeIdToken(p){this.removeItem(p)}removeRefreshToken(p){this.removeItem(p)}getAccessToken(p,A,N,b,O,L){this.commonLogger.trace("CacheManager - getAccessToken called");const w=v.l.createSearchScopes(A.scopes),P=A.authenticationScheme||s.IO.BEARER,B=P&&P.toLowerCase()!==s.IO.BEARER.toLowerCase()?s.aG.ACCESS_TOKEN_WITH_AUTH_SCHEME:s.aG.ACCESS_TOKEN,j={homeAccountId:p.homeAccountId,environment:p.environment,credentialType:B,clientId:this.clientId,realm:b||p.tenantId,target:w,tokenType:P,keyId:A.sshKid,requestedClaimsHash:A.requestedClaimsHash},$=N&&N.accessToken||this.getTokenKeys().accessToken,k=[];$.forEach(x=>{if(this.accessTokenKeyMatchesFilter(x,j,!0)){const z=this.getAccessTokenCredential(x);z&&this.credentialMatchesFilter(z,j)&&k.push(z)}});const H=k.length;return H<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found"),null):H>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them"),k.forEach(x=>{this.removeAccessToken((0,C.og)(x))}),O&&L&&O.addFields({multiMatchedAT:k.length},L),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),k[0])}accessTokenKeyMatchesFilter(p,A,N){const b=p.toLowerCase();if(A.clientId&&-1===b.indexOf(A.clientId.toLowerCase())||A.homeAccountId&&-1===b.indexOf(A.homeAccountId.toLowerCase())||A.realm&&-1===b.indexOf(A.realm.toLowerCase())||A.requestedClaimsHash&&-1===b.indexOf(A.requestedClaimsHash.toLowerCase()))return!1;if(A.target){const O=A.target.asArray();for(let L=0;L<O.length;L++){if(N&&!b.includes(O[L].toLowerCase()))return!1;if(!N&&b.includes(O[L].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(p){const A=this.getTokenKeys(),N=[];return A.accessToken.forEach(b=>{if(!this.accessTokenKeyMatchesFilter(b,p,!0))return;const O=this.getAccessTokenCredential(b);O&&this.credentialMatchesFilter(O,p)&&N.push(O)}),N}getRefreshToken(p,A,N,b,O){this.commonLogger.trace("CacheManager - getRefreshToken called");const w={homeAccountId:p.homeAccountId,environment:p.environment,credentialType:s.aG.REFRESH_TOKEN,clientId:this.clientId,familyId:A?s.hB:void 0},P=N&&N.refreshToken||this.getTokenKeys().refreshToken,B=[];P.forEach($=>{if(this.refreshTokenKeyMatchesFilter($,w)){const k=this.getRefreshTokenCredential($);k&&this.credentialMatchesFilter(k,w)&&B.push(k)}});const j=B.length;return j<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(j>1&&b&&O&&b.addFields({multiMatchedRT:j},O),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),B[0])}refreshTokenKeyMatchesFilter(p,A){const N=p.toLowerCase();return!(A.familyId&&-1===N.indexOf(A.familyId.toLowerCase())||!A.familyId&&A.clientId&&-1===N.indexOf(A.clientId.toLowerCase())||A.homeAccountId&&-1===N.indexOf(A.homeAccountId.toLowerCase()))}readAppMetadataFromCache(p){const N=this.getAppMetadataFilteredBy({environment:p,clientId:this.clientId}),b=Object.keys(N).map(L=>N[L]),O=b.length;if(O<1)return null;if(O>1)throw(0,E.SB)(U.oV);return b[0]}isAppMetadataFOCI(p){const A=this.readAppMetadataFromCache(p);return!(!A||A.familyId!==s.hB)}matchHomeAccountId(p,A){return"string"==typeof p.homeAccountId&&A===p.homeAccountId}matchLocalAccountIdFromTokenClaims(p,A){return A===(p.oid||p.sub)}matchLocalAccountIdFromTenantProfile(p,A){return p.localAccountId===A}matchName(p,A){return A.toLowerCase()===p.name?.toLowerCase()}matchUsername(p,A){return!(!p||"string"!=typeof p||A?.toLowerCase()!==p.toLowerCase())}matchUserAssertionHash(p,A){return!(!p.userAssertionHash||A!==p.userAssertionHash)}matchEnvironment(p,A){if(this.staticAuthorityOptions){const b=(0,D.Bt)(this.staticAuthorityOptions,this.commonLogger);if(b.includes(A)&&b.includes(p.environment))return!0}const N=this.getAuthorityMetadataByAlias(A);return!!(N&&N.aliases.indexOf(p.environment)>-1)}matchCredentialType(p,A){return p.credentialType&&A.toLowerCase()===p.credentialType.toLowerCase()}matchClientId(p,A){return!(!p.clientId||A!==p.clientId)}matchFamilyId(p,A){return!(!p.familyId||A!==p.familyId)}matchRealm(p,A){return p.realm?.toLowerCase()===A.toLowerCase()}matchNativeAccountId(p,A){return!(!p.nativeAccountId||A!==p.nativeAccountId)}matchLoginHintFromTokenClaims(p,A){return p.login_hint===A||p.preferred_username===A||p.upn===A}matchSid(p,A){return p.sid===A}matchAuthorityType(p,A){return!(!p.authorityType||A.toLowerCase()!==p.authorityType.toLowerCase())}matchTarget(p,A){return!(p.credentialType!==s.aG.ACCESS_TOKEN&&p.credentialType!==s.aG.ACCESS_TOKEN_WITH_AUTH_SCHEME||!p.target)&&v.l.fromString(p.target).containsScopeSet(A)}matchTokenType(p,A){return!(!p.tokenType||p.tokenType!==A)}matchKeyId(p,A){return!(!p.keyId||p.keyId!==A)}isAppMetadata(p){return-1!==p.indexOf(s.GU)}isAuthorityMetadata(p){return-1!==p.indexOf(s.u0.CACHE_KEY)}generateAuthorityMetadataCacheKey(p){return`${s.u0.CACHE_KEY}-${this.clientId}-${p}`}static toObject(p,A){for(const N in A)p[N]=A[N];return p}}class T extends G{setAccount(){throw(0,E.SB)(U.R9)}getAccount(){throw(0,E.SB)(U.R9)}getCachedAccountEntity(){throw(0,E.SB)(U.R9)}setIdTokenCredential(){throw(0,E.SB)(U.R9)}getIdTokenCredential(){throw(0,E.SB)(U.R9)}setAccessTokenCredential(){throw(0,E.SB)(U.R9)}getAccessTokenCredential(){throw(0,E.SB)(U.R9)}setRefreshTokenCredential(){throw(0,E.SB)(U.R9)}getRefreshTokenCredential(){throw(0,E.SB)(U.R9)}setAppMetadata(){throw(0,E.SB)(U.R9)}getAppMetadata(){throw(0,E.SB)(U.R9)}setServerTelemetry(){throw(0,E.SB)(U.R9)}getServerTelemetry(){throw(0,E.SB)(U.R9)}setAuthorityMetadata(){throw(0,E.SB)(U.R9)}getAuthorityMetadata(){throw(0,E.SB)(U.R9)}getAuthorityMetadataKeys(){throw(0,E.SB)(U.R9)}setThrottlingCache(){throw(0,E.SB)(U.R9)}getThrottlingCache(){throw(0,E.SB)(U.R9)}removeItem(){throw(0,E.SB)(U.R9)}getKeys(){throw(0,E.SB)(U.R9)}getAccountKeys(){throw(0,E.SB)(U.R9)}getTokenKeys(){throw(0,E.SB)(U.R9)}clear(){return(0,c.A)(function*(){throw(0,E.SB)(U.R9)})()}updateCredentialCacheKey(){throw(0,E.SB)(U.R9)}removeOutdatedAccount(){throw(0,E.SB)(U.R9)}}},1175:(J,F,g)=>{g.d(F,{d:()=>f});var c=g(7635),s=g(7388),C=g(495),v=g(3986),y=g(6211),E=g(8266),R=g(2729),h=g(7172);class f{generateAccountId(){return[this.homeAccountId,this.environment].join(c.LR.CACHE_KEY_SEPARATOR).toLowerCase()}generateAccountKey(){return f.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})}getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(S=>[S.tenantId,S]))}}isSingleTenant(){return!this.tenantProfiles}static generateAccountCacheKey(S){const U=S.homeAccountId.split(".")[1];return[S.homeAccountId,S.environment||"",U||S.tenantId||""].join(c.LR.CACHE_KEY_SEPARATOR).toLowerCase()}static createAccount(S,U,Y){const G=new f;let T;G.authorityType=U.authorityType===y.I.Adfs?c.Qd.ADFS_ACCOUNT_TYPE:U.protocolMode===R.e.AAD?c.Qd.MSSTS_ACCOUNT_TYPE:c.Qd.GENERIC_ACCOUNT_TYPE,S.clientInfo&&Y&&(T=(0,s.k)(S.clientInfo,Y)),G.clientInfo=S.clientInfo,G.homeAccountId=S.homeAccountId,G.nativeAccountId=S.nativeAccountId;const X=S.environment||U&&U.getPreferredCache();if(!X)throw(0,v.SB)(h.l3);if(G.environment=X,G.realm=T?.utid||(0,E.r)(S.idTokenClaims)||"",G.localAccountId=T?.uid||S.idTokenClaims.oid||S.idTokenClaims.sub||"",G.username=S.idTokenClaims.preferred_username||S.idTokenClaims.upn||(S.idTokenClaims.emails?S.idTokenClaims.emails[0]:null)||"",G.name=S.idTokenClaims.name,G.cloudGraphHostName=S.cloudGraphHostName,G.msGraphHost=S.msGraphHost,S.tenantProfiles)G.tenantProfiles=S.tenantProfiles;else{const N=[];if(S.idTokenClaims){const b=(0,C.bi)(S.homeAccountId,S.idTokenClaims);N.push(b)}G.tenantProfiles=N}return G}static createFromAccountInfo(S,U,Y){const G=new f;return G.authorityType=S.authorityType||c.Qd.GENERIC_ACCOUNT_TYPE,G.homeAccountId=S.homeAccountId,G.localAccountId=S.localAccountId,G.nativeAccountId=S.nativeAccountId,G.realm=S.tenantId,G.environment=S.environment,G.username=S.username,G.name=S.name,G.cloudGraphHostName=U,G.msGraphHost=Y,G.tenantProfiles=Array.from(S.tenantProfiles?.values()||[]),G}static generateHomeAccountId(S,U,Y,G,T){if(U!==y.I.Adfs&&U!==y.I.Dsts){if(S)try{const X=(0,s.k)(S,G.base64Decode);if(X.uid&&X.utid)return`${X.uid}.${X.utid}`}catch{}Y.warning("No client info in response")}return T?.sub||""}static isAccountEntity(S){return!!S&&S.hasOwnProperty("homeAccountId")&&S.hasOwnProperty("environment")&&S.hasOwnProperty("realm")&&S.hasOwnProperty("localAccountId")&&S.hasOwnProperty("username")&&S.hasOwnProperty("authorityType")}static accountInfoIsEqual(S,U,Y){if(!S||!U)return!1;let G=!0;if(Y){const T=S.idTokenClaims||{},X=U.idTokenClaims||{};G=T.iat===X.iat&&T.nonce===X.nonce}return S.homeAccountId===U.homeAccountId&&S.localAccountId===U.localAccountId&&S.username===U.username&&S.tenantId===U.tenantId&&S.environment===U.environment&&S.nativeAccountId===U.nativeAccountId&&G}}},2376:(J,F,g)=>{g.d(F,{Ir:()=>j,JP:()=>O,Kx:()=>U,Mg:()=>f,Np:()=>h,WB:()=>Y,br:()=>B,c_:()=>R,dj:()=>S,ey:()=>w,gl:()=>$,ki:()=>L,og:()=>E,p7:()=>P,r1:()=>b,ur:()=>N});var c=g(2895),s=g(3986),C=g(7635),v=g(6134),y=g(7172);function E(k){return[G(k),T(k),X(k),p(k),A(k)].join(C.LR.CACHE_KEY_SEPARATOR).toLowerCase()}function R(k,H,x,z,W){return{credentialType:C.aG.ID_TOKEN,homeAccountId:k,environment:H,clientId:z,secret:x,realm:W}}function h(k,H,x,z,W,te,ne,re,de,q,_,pe,fe,ue,ge){const ce={homeAccountId:k,credentialType:C.aG.ACCESS_TOKEN,secret:x,cachedAt:(0,v._C)().toString(),expiresOn:ne.toString(),extendedExpiresOn:re.toString(),environment:H,clientId:z,realm:W,target:te,tokenType:_||C.IO.BEARER};if(pe&&(ce.userAssertionHash=pe),q&&(ce.refreshOn=q.toString()),ue&&(ce.requestedClaims=ue,ce.requestedClaimsHash=ge),ce.tokenType?.toLowerCase()!==C.IO.BEARER.toLowerCase())switch(ce.credentialType=C.aG.ACCESS_TOKEN_WITH_AUTH_SCHEME,ce.tokenType){case C.IO.POP:const le=(0,c.My)(x,de);if(!le?.cnf?.kid)throw(0,s.SB)(y.FA);ce.keyId=le.cnf.kid;break;case C.IO.SSH:ce.keyId=fe}return ce}function f(k,H,x,z,W,te,ne){const re={credentialType:C.aG.REFRESH_TOKEN,homeAccountId:k,environment:H,clientId:z,secret:x};return te&&(re.userAssertionHash=te),W&&(re.familyId=W),ne&&(re.expiresOn=ne.toString()),re}function D(k){return k.hasOwnProperty("homeAccountId")&&k.hasOwnProperty("environment")&&k.hasOwnProperty("credentialType")&&k.hasOwnProperty("clientId")&&k.hasOwnProperty("secret")}function S(k){return!!k&&D(k)&&k.hasOwnProperty("realm")&&k.hasOwnProperty("target")&&(k.credentialType===C.aG.ACCESS_TOKEN||k.credentialType===C.aG.ACCESS_TOKEN_WITH_AUTH_SCHEME)}function U(k){return!!k&&D(k)&&k.hasOwnProperty("realm")&&k.credentialType===C.aG.ID_TOKEN}function Y(k){return!!k&&D(k)&&k.credentialType===C.aG.REFRESH_TOKEN}function G(k){return[k.homeAccountId,k.environment].join(C.LR.CACHE_KEY_SEPARATOR).toLowerCase()}function T(k){return[k.credentialType,k.credentialType===C.aG.REFRESH_TOKEN&&k.familyId||k.clientId,k.realm||""].join(C.LR.CACHE_KEY_SEPARATOR).toLowerCase()}function X(k){return(k.target||"").toLowerCase()}function p(k){return(k.requestedClaimsHash||"").toLowerCase()}function A(k){return k.tokenType&&k.tokenType.toLowerCase()!==C.IO.BEARER.toLowerCase()?k.tokenType.toLowerCase():""}function N(k,H){const x=0===k.indexOf(C.gT.CACHE_KEY);let z=!0;return H&&(z=H.hasOwnProperty("failedRequests")&&H.hasOwnProperty("errors")&&H.hasOwnProperty("cacheHits")),x&&z}function b(k,H){let x=!1;k&&(x=0===k.indexOf(C.Xw.THROTTLING_PREFIX));let z=!0;return H&&(z=H.hasOwnProperty("throttleTime")),x&&z}function O({environment:k,clientId:H}){return[C.GU,k,H].join(C.LR.CACHE_KEY_SEPARATOR).toLowerCase()}function L(k,H){return!!H&&0===k.indexOf(C.GU)&&H.hasOwnProperty("clientId")&&H.hasOwnProperty("environment")}function w(k,H){return!!H&&0===k.indexOf(C.u0.CACHE_KEY)&&H.hasOwnProperty("aliases")&&H.hasOwnProperty("preferred_cache")&&H.hasOwnProperty("preferred_network")&&H.hasOwnProperty("canonical_authority")&&H.hasOwnProperty("authorization_endpoint")&&H.hasOwnProperty("token_endpoint")&&H.hasOwnProperty("issuer")&&H.hasOwnProperty("aliasesFromNetwork")&&H.hasOwnProperty("endpointsFromNetwork")&&H.hasOwnProperty("expiresAt")&&H.hasOwnProperty("jwks_uri")}function P(){return(0,v._C)()+C.u0.REFRESH_TIME_SECONDS}function B(k,H,x){k.authorization_endpoint=H.authorization_endpoint,k.token_endpoint=H.token_endpoint,k.end_session_endpoint=H.end_session_endpoint,k.issuer=H.issuer,k.endpointsFromNetwork=x,k.jwks_uri=H.jwks_uri}function j(k,H,x){k.aliases=H.aliases,k.preferred_cache=H.preferred_cache,k.preferred_network=H.preferred_network,k.aliasesFromNetwork=x}function $(k){return k.expiresAt<=(0,v._C)()}},6964:(J,F,g)=>{g.d(F,{GF:()=>N,J1:()=>S,hf:()=>O});var c=g(467),s=g(2506),C=g(8173),v=g(7635),y=g(4481),E=g(4719),R=g(8864),h=g(2729),f=g(3986),D=g(7172);const S={tokenRenewalOffsetSeconds:v.F0,preventCorsPreflight:!1},U={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:C.$.Info,correlationId:v.YM.EMPTY_STRING},Y={claimsBasedCachingEnabled:!1},G={sendGetRequestAsync:()=>(0,c.A)(function*(){throw(0,f.SB)(D.R9)})(),sendPostRequestAsync:()=>(0,c.A)(function*(){throw(0,f.SB)(D.R9)})()},T={sku:v.YM.SKU,version:y.r,cpu:v.YM.EMPTY_STRING,os:v.YM.EMPTY_STRING},X={clientSecret:v.YM.EMPTY_STRING,clientAssertion:void 0},p={azureCloudInstance:E._.None,tenant:`${v.YM.DEFAULT_COMMON_TENANT}`},A={application:{appName:"",appVersion:""}};function N({authOptions:L,systemOptions:w,loggerOptions:P,cacheOptions:B,storageInterface:j,networkInterface:$,cryptoInterface:k,clientCredentials:H,libraryInfo:x,telemetry:z,serverTelemetryManager:W,persistencePlugin:te,serializableCache:ne}){const re={...U,...P};return{authOptions:b(L),systemOptions:{...S,...w},loggerOptions:re,cacheOptions:{...Y,...B},storageInterface:j||new R.R(L.clientId,s.j,new C.V(re)),networkInterface:$||G,cryptoInterface:k||s.j,clientCredentials:H||X,libraryInfo:{...T,...x},telemetry:{...A,...z},serverTelemetryManager:W||null,persistencePlugin:te||null,serializableCache:ne||null}}function b(L){return{clientCapabilities:[],azureCloudOptions:p,skipAuthorityMetadataCache:!1,...L}}function O(L){return L.authOptions.authority.options.protocolMode===h.e.OIDC}},1586:(J,F,g)=>{g.d(F,{$n:()=>de,A3:()=>P,AG:()=>re,Am:()=>y,Az:()=>x,C$:()=>k,E0:()=>O,H5:()=>ce,IF:()=>E,Ns:()=>te,PM:()=>W,R3:()=>z,R_:()=>ue,SP:()=>Xe,Sq:()=>b,Tq:()=>fe,U6:()=>c,Xs:()=>w,Zn:()=>ne,_q:()=>s,aZ:()=>U,ag:()=>v,ai:()=>H,au:()=>X,c4:()=>T,dF:()=>Z,dn:()=>C,hF:()=>p,hx:()=>R,ir:()=>xe,oE:()=>pe,p$:()=>q,pG:()=>oe,pe:()=>j,pg:()=>B,rg:()=>Me,sg:()=>$,uP:()=>L,yF:()=>ge,yj:()=>Ke,z1:()=>_});const c="client_id",s="redirect_uri",C="response_type",v="response_mode",y="grant_type",E="claims",R="scope",U="refresh_token",T="state",X="nonce",p="prompt",b="code",O="code_challenge",L="code_challenge_method",w="code_verifier",P="client-request-id",B="x-client-SKU",j="x-client-VER",$="x-client-OS",k="x-client-CPU",H="x-client-current-telemetry",x="x-client-last-telemetry",z="x-ms-lib-capability",W="x-app-name",te="x-app-ver",ne="post_logout_redirect_uri",re="id_token_hint",de="device_code",q="client_secret",_="client_assertion",pe="client_assertion_type",fe="token_type",ue="req_cnf",ge="assertion",ce="requested_token_use",xe="return_spa_code",Ke="nativebroker",oe="logout_hint",Z="sid",Xe="login_hint",Me="domain_hint"},2506:(J,F,g)=>{g.d(F,{j:()=>v});var c=g(467),s=g(3986),C=g(7172);const v={createNewGuid:()=>{throw(0,s.SB)(C.R9)},base64Decode:()=>{throw(0,s.SB)(C.R9)},base64Encode:()=>{throw(0,s.SB)(C.R9)},getPublicKeyThumbprint:()=>(0,c.A)(function*(){throw(0,s.SB)(C.R9)})(),removeTokenBindingKey:()=>(0,c.A)(function*(){throw(0,s.SB)(C.R9)})(),clearKeystore:()=>(0,c.A)(function*(){throw(0,s.SB)(C.R9)})(),signJwt:()=>(0,c.A)(function*(){throw(0,s.SB)(C.R9)})(),hashString:()=>(0,c.A)(function*(){throw(0,s.SB)(C.R9)})()}},3461:(J,F,g)=>{g.d(F,{lR:()=>y,pz:()=>E});var c=g(7635),s=g(6213);const C={[s.W]:"Unexpected error in authentication.",[s.z]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};class y extends Error{constructor(h,f,D){super(f?`${h}: ${f}`:h),Object.setPrototypeOf(this,y.prototype),this.errorCode=h||c.YM.EMPTY_STRING,this.errorMessage=f||c.YM.EMPTY_STRING,this.subError=D||c.YM.EMPTY_STRING,this.name="AuthError"}setCorrelationId(h){this.correlationId=h}}function E(R,h){return new y(R,h?`${C[R]} ${h}`:C[R])}},6213:(J,F,g)=>{g.d(F,{W:()=>c,z:()=>s});const c="unexpected_error",s="post_request_failed"},6987:(J,F,g)=>{g.d(F,{xA:()=>C});var c=g(1827);const s={[c.Z]:"Exceeded cache storage capacity.",[c.Y]:"Unexpected error occurred when using cache storage."};class C extends Error{constructor(y,E){const R=E||(s[y]?s[y]:s[c.Y]);super(`${y}: ${R}`),Object.setPrototypeOf(this,C.prototype),this.name="CacheError",this.errorCode=y,this.errorMessage=R}}},1827:(J,F,g)=>{g.d(F,{Y:()=>s,Z:()=>c});const c="cache_quota_exceeded",s="cache_error_unknown"},3986:(J,F,g)=>{g.d(F,{SB:()=>E,eB:()=>y});var c=g(3461),s=g(7172);const C={[s.lP]:"The client info could not be parsed/decoded correctly",[s.fY]:"The client info was empty",[s.gR]:"Token cannot be parsed",[s.Bh]:"The token is null or empty",[s.s1]:"Endpoints cannot be resolved",[s.x6]:"Network request failed",[s.Ej]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[s.hJ]:"The hash parameters could not be deserialized",[s.f$]:"State was not the expected format",[s.Cl]:"State mismatch error",[s.tQ]:"State not found",[s.aQ]:"Nonce mismatch error",[s.n3]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[s.Yh]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[s.s9]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[s.gg]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[s.oV]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[s.$P]:"Token request cannot be made without authorization code or refresh token.",[s.f5]:"Cannot remove null or empty scope from ScopeSet",[s.Wf]:"Cannot append ScopeSet",[s.UA]:"Empty input ScopeSet cannot be processed",[s.u4]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[s.dL]:"Device code is expired.",[s.ax]:"Device code stopped polling for unknown reasons.",[s.C2]:"Please pass an account object, silent flow is not supported without account information",[s.n4]:"Cache record object was null or undefined.",[s.l3]:"Invalid environment when attempting to create cache entry",[s.rk]:"No account found in cache for given key.",[s.oL]:"No crypto object detected.",[s.Zj]:"Unexpected credential type.",[s.qM]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[s.Q8]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[s.wb]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[s.Fs]:"User defined timeout for device code polling reached",[s.FA]:"Cannot generate a POP jwt if the token_claims are not populated",[s.Re]:"Server response does not contain an authorization code to proceed",[s.QE]:"Could not remove the credential's binding key from storage.",[s.yX]:"The provided authority does not support logout",[s.fo]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[s.l7]:"No network connectivity. Check your internet connection.",[s.fn]:"User cancelled the flow.",[s.ik]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[s.R9]:"This method has not been implemented",[s.CN]:"The nested app auth bridge is disabled"};class y extends c.lR{constructor(h,f){super(h,f?`${C[h]}: ${f}`:C[h]),this.name="ClientAuthError",Object.setPrototypeOf(this,y.prototype)}}function E(R,h){return new y(R,h)}},7172:(J,F,g)=>{g.d(F,{$P:()=>A,Bh:()=>v,C2:()=>B,CN:()=>le,Cl:()=>D,Ej:()=>R,FA:()=>re,Fs:()=>ne,Q8:()=>W,QE:()=>q,R9:()=>ce,Re:()=>de,UA:()=>O,Wf:()=>b,Yh:()=>G,Zj:()=>x,aQ:()=>U,ax:()=>P,dL:()=>w,f$:()=>f,f5:()=>N,fY:()=>s,fn:()=>ue,fo:()=>pe,gR:()=>C,gg:()=>X,hJ:()=>h,ik:()=>ge,l3:()=>$,l7:()=>fe,lP:()=>c,n3:()=>Y,n4:()=>j,oL:()=>H,oV:()=>p,qM:()=>z,rk:()=>k,s1:()=>y,s9:()=>T,tQ:()=>S,u4:()=>L,wb:()=>te,x6:()=>E,yX:()=>_});const c="client_info_decoding_error",s="client_info_empty_error",C="token_parsing_error",v="null_or_empty_token",y="endpoints_resolution_error",E="network_error",R="openid_config_error",h="hash_not_deserialized",f="invalid_state",D="state_mismatch",S="state_not_found",U="nonce_mismatch",Y="auth_time_not_found",G="max_age_transpired",T="multiple_matching_tokens",X="multiple_matching_accounts",p="multiple_matching_appMetadata",A="request_cannot_be_made",N="cannot_remove_empty_scope",b="cannot_append_scopeset",O="empty_input_scopeset",L="device_code_polling_cancelled",w="device_code_expired",P="device_code_unknown_error",B="no_account_in_silent_request",j="invalid_cache_record",$="invalid_cache_environment",k="no_account_found",H="no_crypto_object",x="unexpected_credential_type",z="invalid_assertion",W="invalid_client_credential",te="token_refresh_required",ne="user_timeout_reached",re="token_claims_cnf_required_for_signedjwt",de="authorization_code_missing_from_server_response",q="binding_key_not_removed",_="end_session_endpoint_not_supported",pe="key_id_missing",fe="no_network_connectivity",ue="user_canceled",ge="missing_tenant_id_error",ce="method_not_implemented",le="nested_app_auth_bridge_disabled"},7806:(J,F,g)=>{g.d(F,{aD:()=>E});var c=g(3461),s=g(5424);const C={[s.gO]:"A redirect URI is required for all calls, and none has been set.",[s.hL]:"Could not parse the given claims request object.",[s.oY]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[s.$N]:"URL could not be parsed into appropriate segments.",[s.$A]:"URL was empty or null.",[s.zg]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[s.Pc]:"Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest",[s.bj]:"Given claims parameter must be a stringified JSON object.",[s.Ub]:"Token request was empty and not found in cache.",[s.pi]:"The logout request was null or undefined.",[s.b0]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[s.qz]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[s.a_]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[s.uk]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[s.E0]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[s.LX]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[s.rB]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[s.ze]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[s.hk]:"Invalid authentication header provided",[s.bg]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[s.J6]:"Cannot set allowNativeBroker parameter to true when not in AAD protocol mode.",[s.K3]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."};class y extends c.lR{constructor(h){super(h,C[h]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,y.prototype)}}function E(R){return new y(R)}},5424:(J,F,g)=>{g.d(F,{$A:()=>y,$N:()=>v,E0:()=>T,J6:()=>O,K3:()=>L,LX:()=>X,Pc:()=>R,Ub:()=>f,a_:()=>Y,b0:()=>S,bg:()=>b,bj:()=>h,gO:()=>c,hL:()=>s,hk:()=>N,oY:()=>C,pi:()=>D,qz:()=>U,rB:()=>p,uk:()=>G,ze:()=>A,zg:()=>E});const c="redirect_uri_empty",s="claims_request_parsing_error",C="authority_uri_insecure",v="url_parse_error",y="empty_url_error",E="empty_input_scopes_error",R="invalid_prompt_value",h="invalid_claims",f="token_request_empty",D="logout_request_empty",S="invalid_code_challenge_method",U="pkce_params_missing",Y="invalid_cloud_discovery_metadata",G="invalid_authority_metadata",T="untrusted_authority",X="missing_ssh_jwk",p="missing_ssh_kid",A="missing_nonce_authentication_header",N="invalid_authentication_header",b="cannot_set_OIDCOptions",O="cannot_allow_native_broker",L="authority_mismatch"},194:(J,F,g)=>{g.d(F,{CB:()=>h,IE:()=>D,a:()=>f});var c=g(7635),s=g(3461),C=g(6564);const v=[C.mP,C.CY,C.Zv,C.j9],y=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],E={[C.oF]:"No refresh token found in the cache. Please sign-in.",[C.B]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[C.AG]:"Refresh token has expired.",[C.j9]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve."};class h extends s.lR{constructor(U,Y,G,T,X,p,A,N){super(U,Y,G),Object.setPrototypeOf(this,h.prototype),this.timestamp=T||c.YM.EMPTY_STRING,this.traceId=X||c.YM.EMPTY_STRING,this.correlationId=p||c.YM.EMPTY_STRING,this.claims=A||c.YM.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=N}}function f(S,U,Y){const G=!!S&&v.indexOf(S)>-1,T=!!Y&&y.indexOf(Y)>-1,X=!!U&&v.some(p=>U.indexOf(p)>-1);return G||X||T}function D(S){return new h(S,E[S])}},6564:(J,F,g)=>{g.d(F,{AG:()=>C,B:()=>s,CY:()=>y,Zv:()=>E,j9:()=>R,mP:()=>v,oF:()=>c});const c="no_tokens_found",s="native_account_unavailable",C="refresh_token_expired",v="interaction_required",y="consent_required",E="login_required",R="bad_token"},6708:(J,F,g)=>{g.d(F,{g:()=>s});var c=g(3461);class s extends c.lR{constructor(v,y,E,R){super(v,y,E),this.name="ServerError",this.errorNo=R,Object.setPrototypeOf(this,s.prototype)}}},8173:(J,F,g)=>{g.d(F,{$:()=>s,V:()=>C});var c=g(7635),s=function(v){return v[v.Error=0]="Error",v[v.Warning=1]="Warning",v[v.Info=2]="Info",v[v.Verbose=3]="Verbose",v[v.Trace=4]="Trace",v}(s||{});class C{constructor(y,E,R){this.level=s.Info;const f=y||C.createDefaultLoggerOptions();this.localCallback=f.loggerCallback||(()=>{}),this.piiLoggingEnabled=f.piiLoggingEnabled||!1,this.level="number"==typeof f.logLevel?f.logLevel:s.Info,this.correlationId=f.correlationId||c.YM.EMPTY_STRING,this.packageName=E||c.YM.EMPTY_STRING,this.packageVersion=R||c.YM.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:s.Info}}clone(y,E,R){return new C({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:R||this.correlationId},y,E)}logMessage(y,E){if(E.logLevel>this.level||!this.piiLoggingEnabled&&E.containsPii)return;const f=`[${(new Date).toUTCString()}] : [${E.correlationId||this.correlationId||""}] : ${this.packageName}@${this.packageVersion} : ${s[E.logLevel]} - ${y}`;this.executeCallback(E.logLevel,f,E.containsPii||!1)}executeCallback(y,E,R){this.localCallback&&this.localCallback(y,E,R)}error(y,E){this.logMessage(y,{logLevel:s.Error,containsPii:!1,correlationId:E||c.YM.EMPTY_STRING})}errorPii(y,E){this.logMessage(y,{logLevel:s.Error,containsPii:!0,correlationId:E||c.YM.EMPTY_STRING})}warning(y,E){this.logMessage(y,{logLevel:s.Warning,containsPii:!1,correlationId:E||c.YM.EMPTY_STRING})}warningPii(y,E){this.logMessage(y,{logLevel:s.Warning,containsPii:!0,correlationId:E||c.YM.EMPTY_STRING})}info(y,E){this.logMessage(y,{logLevel:s.Info,containsPii:!1,correlationId:E||c.YM.EMPTY_STRING})}infoPii(y,E){this.logMessage(y,{logLevel:s.Info,containsPii:!0,correlationId:E||c.YM.EMPTY_STRING})}verbose(y,E){this.logMessage(y,{logLevel:s.Verbose,containsPii:!1,correlationId:E||c.YM.EMPTY_STRING})}verbosePii(y,E){this.logMessage(y,{logLevel:s.Verbose,containsPii:!0,correlationId:E||c.YM.EMPTY_STRING})}trace(y,E){this.logMessage(y,{logLevel:s.Trace,containsPii:!1,correlationId:E||c.YM.EMPTY_STRING})}tracePii(y,E){this.logMessage(y,{logLevel:s.Trace,containsPii:!0,correlationId:E||c.YM.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}},4481:(J,F,g)=>{g.d(F,{U:()=>c,r:()=>s});const c="@azure/msal-common",s="14.10.0"},845:(J,F,g)=>{g.d(F,{W:()=>R});var c=g(7635),s=g(1586),C=g(6812),v=g(7806),y=g(5503),E=g(5424);class R{constructor(){this.parameters=new Map}addResponseTypeCode(){this.parameters.set(s.dn,encodeURIComponent(c.YM.CODE_RESPONSE_TYPE))}addResponseTypeForTokenAndIdToken(){this.parameters.set(s.dn,encodeURIComponent(`${c.YM.TOKEN_RESPONSE_TYPE} ${c.YM.ID_TOKEN_RESPONSE_TYPE}`))}addResponseMode(f){this.parameters.set(s.ag,encodeURIComponent(f||c.p.QUERY))}addNativeBroker(){this.parameters.set(s.yj,encodeURIComponent("1"))}addScopes(f,D=!0,S=c.aZ){D&&!S.includes("openid")&&!f.includes("openid")&&S.push("openid");const U=D?[...f||[],...S]:f||[],Y=new C.l(U);this.parameters.set(s.hx,encodeURIComponent(Y.printScopes()))}addClientId(f){this.parameters.set(s.U6,encodeURIComponent(f))}addRedirectUri(f){y.M.validateRedirectUri(f),this.parameters.set(s._q,encodeURIComponent(f))}addPostLogoutRedirectUri(f){y.M.validateRedirectUri(f),this.parameters.set(s.Zn,encodeURIComponent(f))}addIdTokenHint(f){this.parameters.set(s.AG,encodeURIComponent(f))}addDomainHint(f){this.parameters.set(s.rg,encodeURIComponent(f))}addLoginHint(f){this.parameters.set(s.SP,encodeURIComponent(f))}addCcsUpn(f){this.parameters.set(c.OK.CCS_HEADER,encodeURIComponent(`UPN:${f}`))}addCcsOid(f){this.parameters.set(c.OK.CCS_HEADER,encodeURIComponent(`Oid:${f.uid}@${f.utid}`))}addSid(f){this.parameters.set(s.dF,encodeURIComponent(f))}addClaims(f,D){const S=this.addClientCapabilitiesToClaims(f,D);y.M.validateClaims(S),this.parameters.set(s.IF,encodeURIComponent(S))}addCorrelationId(f){this.parameters.set(s.A3,encodeURIComponent(f))}addLibraryInfo(f){this.parameters.set(s.pg,f.sku),this.parameters.set(s.pe,f.version),f.os&&this.parameters.set(s.sg,f.os),f.cpu&&this.parameters.set(s.C$,f.cpu)}addApplicationTelemetry(f){f?.appName&&this.parameters.set(s.PM,f.appName),f?.appVersion&&this.parameters.set(s.Ns,f.appVersion)}addPrompt(f){y.M.validatePrompt(f),this.parameters.set(`${s.hF}`,encodeURIComponent(f))}addState(f){f&&this.parameters.set(s.c4,encodeURIComponent(f))}addNonce(f){this.parameters.set(s.au,encodeURIComponent(f))}addCodeChallengeParams(f,D){if(y.M.validateCodeChallengeParams(f,D),!f||!D)throw(0,v.aD)(E.qz);this.parameters.set(s.E0,encodeURIComponent(f)),this.parameters.set(s.uP,encodeURIComponent(D))}addAuthorizationCode(f){this.parameters.set(s.Sq,encodeURIComponent(f))}addDeviceCode(f){this.parameters.set(s.$n,encodeURIComponent(f))}addRefreshToken(f){this.parameters.set(s.aZ,encodeURIComponent(f))}addCodeVerifier(f){this.parameters.set(s.Xs,encodeURIComponent(f))}addClientSecret(f){this.parameters.set(s.p$,encodeURIComponent(f))}addClientAssertion(f){f&&this.parameters.set(s.z1,encodeURIComponent(f))}addClientAssertionType(f){f&&this.parameters.set(s.oE,encodeURIComponent(f))}addOboAssertion(f){this.parameters.set(s.yF,encodeURIComponent(f))}addRequestTokenUse(f){this.parameters.set(s.H5,encodeURIComponent(f))}addGrantType(f){this.parameters.set(s.Am,encodeURIComponent(f))}addClientInfo(){this.parameters.set(c.JR,"1")}addExtraQueryParameters(f){const D=y.M.sanitizeEQParams(f,this.parameters);Object.keys(D).forEach(S=>{this.parameters.set(S,f[S])})}addClientCapabilitiesToClaims(f,D){let S;if(f)try{S=JSON.parse(f)}catch{throw(0,v.aD)(E.bj)}else S={};return D&&D.length>0&&(S.hasOwnProperty(c.Fq.ACCESS_TOKEN)||(S[c.Fq.ACCESS_TOKEN]={}),S[c.Fq.ACCESS_TOKEN][c.Fq.XMS_CC]={values:D}),JSON.stringify(S)}addUsername(f){this.parameters.set(c.Tq.username,encodeURIComponent(f))}addPassword(f){this.parameters.set(c.Tq.password,encodeURIComponent(f))}addPopToken(f){f&&(this.parameters.set(s.Tq,c.IO.POP),this.parameters.set(s.R_,encodeURIComponent(f)))}addSshJwk(f){f&&(this.parameters.set(s.Tq,c.IO.SSH),this.parameters.set(s.R_,encodeURIComponent(f)))}addServerTelemetry(f){this.parameters.set(s.ai,f.generateCurrentRequestHeaderValue()),this.parameters.set(s.Az,f.generateLastRequestHeaderValue())}addThrottling(){this.parameters.set(s.R3,c.Xw.X_MS_LIB_CAPABILITY_VALUE)}addLogoutHint(f){this.parameters.set(s.pG,encodeURIComponent(f))}createQueryString(){const f=new Array;return this.parameters.forEach((D,S)=>{f.push(`${S}=${D}`)}),f.join("&")}}},5503:(J,F,g)=>{g.d(F,{M:()=>v});var c=g(7806),s=g(7635),C=g(5424);class v{static validateRedirectUri(E){if(!E)throw(0,c.aD)(C.gO)}static validatePrompt(E){const R=[];for(const h in s._M)R.push(s._M[h]);if(R.indexOf(E)<0)throw(0,c.aD)(C.Pc)}static validateClaims(E){try{JSON.parse(E)}catch{throw(0,c.aD)(C.bj)}}static validateCodeChallengeParams(E,R){if(!E||!R)throw(0,c.aD)(C.qz);this.validateCodeChallengeMethod(R)}static validateCodeChallengeMethod(E){if([s.iF.PLAIN,s.iF.S256].indexOf(E)<0)throw(0,c.aD)(C.b0)}static sanitizeEQParams(E,R){return E?(R.forEach((h,f)=>{E[f]&&delete E[f]}),Object.fromEntries(Object.entries(E).filter(h=>""!==h[1]))):{}}}},6812:(J,F,g)=>{g.d(F,{l:()=>R});var c=g(7806),s=g(2030),C=g(3986),v=g(7635),y=g(5424),E=g(7172);class R{constructor(f){const D=f?s.$.trimArrayEntries([...f]):[],S=D?s.$.removeEmptyStringsFromArray(D):[];this.validateInputScopes(S),this.scopes=new Set,S.forEach(U=>this.scopes.add(U))}static fromString(f){const S=(f||v.YM.EMPTY_STRING).split(" ");return new R(S)}static createSearchScopes(f){const D=new R(f);return D.containsOnlyOIDCScopes()?D.removeScope(v.YM.OFFLINE_ACCESS_SCOPE):D.removeOIDCScopes(),D}validateInputScopes(f){if(!f||f.length<1)throw(0,c.aD)(y.zg)}containsScope(f){const D=this.printScopesLowerCase().split(" "),S=new R(D);return!!f&&S.scopes.has(f.toLowerCase())}containsScopeSet(f){return!(!f||f.scopes.size<=0)&&this.scopes.size>=f.scopes.size&&f.asArray().every(D=>this.containsScope(D))}containsOnlyOIDCScopes(){let f=0;return v._A.forEach(D=>{this.containsScope(D)&&(f+=1)}),this.scopes.size===f}appendScope(f){f&&this.scopes.add(f.trim())}appendScopes(f){try{f.forEach(D=>this.appendScope(D))}catch{throw(0,C.SB)(E.Wf)}}removeScope(f){if(!f)throw(0,C.SB)(E.f5);this.scopes.delete(f.trim())}removeOIDCScopes(){v._A.forEach(f=>{this.scopes.delete(f)})}unionScopeSets(f){if(!f)throw(0,C.SB)(E.UA);const D=new Set;return f.scopes.forEach(S=>D.add(S.toLowerCase())),this.scopes.forEach(S=>D.add(S.toLowerCase())),D}intersectingScopeSets(f){if(!f)throw(0,C.SB)(E.UA);f.containsOnlyOIDCScopes()||f.removeOIDCScopes();const D=this.unionScopeSets(f),S=f.getScopeCount(),U=this.getScopeCount();return D.size<U+S}getScopeCount(){return this.scopes.size}asArray(){const f=[];return this.scopes.forEach(D=>f.push(D)),f}printScopes(){return this.scopes?this.asArray().join(" "):v.YM.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}},4561:(J,F,g)=>{g.d(F,{MX:()=>c,hU:()=>C});const c={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",AwaitConcurrentIframe:"awaitConcurrentIframe",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",StandardInteractionClientInitializeAuthorizationCodeRequest:"standardInteractionClientInitializeAuthorizationCodeRequest",GetAuthCodeUrl:"getAuthCodeUrl",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",AuthClientCreateQueryString:"authClientCreateQueryString",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues"},C={NotStarted:0,InProgress:1,Completed:2}},1564:(J,F,g)=>{g.d(F,{H:()=>E});var c=g(7806),s=g(2030),C=g(7635),v=g(2718),y=g(5424);class E{get urlString(){return this._urlString}constructor(h){if(this._urlString=h,!this._urlString)throw(0,c.aD)(y.$A);h.includes("#")||(this._urlString=E.canonicalizeUri(h))}static canonicalizeUri(h){if(h){let f=h.toLowerCase();return s.$.endsWith(f,"?")?f=f.slice(0,-1):s.$.endsWith(f,"?/")&&(f=f.slice(0,-2)),s.$.endsWith(f,"/")||(f+="/"),f}return h}validateAsUri(){let h;try{h=this.getUrlComponents()}catch{throw(0,c.aD)(y.$N)}if(!h.HostNameAndPort||!h.PathSegments)throw(0,c.aD)(y.$N);if(!h.Protocol||"https:"!==h.Protocol.toLowerCase())throw(0,c.aD)(y.oY)}static appendQueryString(h,f){return f?h.indexOf("?")<0?`${h}?${f}`:`${h}&${f}`:h}static removeHashFromUrl(h){return E.canonicalizeUri(h.split("#")[0])}replaceTenantPath(h){const f=this.getUrlComponents(),D=f.PathSegments;return h&&0!==D.length&&(D[0]===C.v2.COMMON||D[0]===C.v2.ORGANIZATIONS)&&(D[0]=h),E.constructAuthorityUriFromObject(f)}getUrlComponents(){const h=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),f=this.urlString.match(h);if(!f)throw(0,c.aD)(y.$N);const D={Protocol:f[1],HostNameAndPort:f[4],AbsolutePath:f[5],QueryString:f[7]};let S=D.AbsolutePath.split("/");return S=S.filter(U=>U&&U.length>0),D.PathSegments=S,D.QueryString&&D.QueryString.endsWith("/")&&(D.QueryString=D.QueryString.substring(0,D.QueryString.length-1)),D}static getDomainFromUrl(h){const f=RegExp("^([^:/?#]+://)?([^/?#]*)"),D=h.match(f);if(!D)throw(0,c.aD)(y.$N);return D[2]}static getAbsoluteUrl(h,f){if(h[0]===C.YM.FORWARD_SLASH){const S=new E(f).getUrlComponents();return S.Protocol+"//"+S.HostNameAndPort+h}return h}static constructAuthorityUriFromObject(h){return new E(h.Protocol+"//"+h.HostNameAndPort+"/"+h.PathSegments.join("/"))}static hashContainsKnownProperties(h){return!!(0,v.n)(h)}}},7635:(J,F,g)=>{g.d(F,{$x:()=>Y,E_:()=>L,F0:()=>ne,Fq:()=>h,GU:()=>A,Gd:()=>E,I:()=>j,IO:()=>P,JR:()=>N,Kk:()=>k,LR:()=>T,Lz:()=>W,OK:()=>y,Qd:()=>G,Rv:()=>z,Tq:()=>$,Xw:()=>B,YM:()=>c,_2:()=>x,_A:()=>v,_M:()=>f,aG:()=>X,aZ:()=>C,gT:()=>w,hB:()=>b,iF:()=>D,jZ:()=>H,p:()=>U,t3:()=>s,u0:()=>O,v2:()=>R,zL:()=>S});const c={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},s={SUCCESS:200,SUCCESS_RANGE_START:200,SUCCESS_RANGE_END:299,REDIRECT:302,CLIENT_ERROR:400,CLIENT_ERROR_RANGE_START:400,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,REQUEST_TIMEOUT:408,TOO_MANY_REQUESTS:429,CLIENT_ERROR_RANGE_END:499,SERVER_ERROR:500,SERVER_ERROR_RANGE_START:500,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,SERVER_ERROR_RANGE_END:599,MULTI_SIDED_ERROR:600},C=[c.OPENID_SCOPE,c.PROFILE_SCOPE,c.OFFLINE_ACCESS_SCOPE],v=[...C,c.EMAIL_SCOPE],y={CONTENT_TYPE:"Content-Type",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},E={ID_TOKEN:"idtoken",CLIENT_INFO:"client.info",ADAL_ID_TOKEN:"adal.idtoken",ERROR:"error",ERROR_DESC:"error.description",ACTIVE_ACCOUNT:"active-account",ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},R={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},h={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},f={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},D={PLAIN:"plain",S256:"S256"},S={QUERY:"query",FRAGMENT:"fragment"},U={...S,FORM_POST:"form_post"},Y={IMPLICIT_GRANT:"implicit",AUTHORIZATION_CODE_GRANT:"authorization_code",CLIENT_CREDENTIALS_GRANT:"client_credentials",RESOURCE_OWNER_PASSWORD_GRANT:"password",REFRESH_TOKEN_GRANT:"refresh_token",DEVICE_CODE_GRANT:"device_code",JWT_BEARER:"urn:ietf:params:oauth:grant-type:jwt-bearer"},G={MSSTS_ACCOUNT_TYPE:"MSSTS",ADFS_ACCOUNT_TYPE:"ADFS",MSAV1_ACCOUNT_TYPE:"MSA",GENERIC_ACCOUNT_TYPE:"Generic"},T={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},X={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},A="appmetadata",N="client_info",b="1",O={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:86400},L={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},w={SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},P={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},B={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},j={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},$={username:"username",password:"password"},k={httpSuccess:200,httpBadRequest:400},H={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},x={CONFIGURED_MATCHES_DETECTED:"1",CONFIGURED_NO_AUTO_DETECTION:"2",CONFIGURED_NOT_DETECTED:"3",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},z={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},W={Jwt:"JWT",Jwk:"JWK",Pop:"pop"},ne=300},2030:(J,F,g)=>{g.d(F,{$:()=>c});class c{static isEmptyObj(C){if(C)try{const v=JSON.parse(C);return 0===Object.keys(v).length}catch{}return!0}static startsWith(C,v){return 0===C.indexOf(v)}static endsWith(C,v){return C.length>=v.length&&C.lastIndexOf(v)===C.length-v.length}static queryStringToObject(C){const v={},y=C.split("&"),E=R=>decodeURIComponent(R.replace(/\+/g," "));return y.forEach(R=>{if(R.trim()){const[h,f]=R.split(/=(.+)/g,2);h&&f&&(v[E(h)]=E(f))}}),v}static trimArrayEntries(C){return C.map(v=>v.trim())}static removeEmptyStringsFromArray(C){return C.filter(v=>!!v)}static jsonParseHelper(C){try{return JSON.parse(C)}catch{return null}}static matchPattern(C,v){return new RegExp(C.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(v)}}},6134:(J,F,g)=>{function c(){return Math.round((new Date).getTime()/1e3)}function s(y,E){const R=Number(y)||0;return c()+E>R}function C(y){return Number(y)>c()}g.d(F,{Hm:()=>s,XJ:()=>C,_C:()=>c})},2718:(J,F,g)=>{g.d(F,{S:()=>C,n:()=>v});var c=g(3986),s=g(7172);function C(y){return y.startsWith("#/")?y.substring(2):y.startsWith("#")||y.startsWith("?")?y.substring(1):y}function v(y){if(!y||y.indexOf("=")<0)return null;try{const E=C(y),R=Object.fromEntries(new URLSearchParams(E));if(R.code||R.error||R.error_description||R.state)return R}catch{throw(0,c.SB)(s.hJ)}return null}}}]);